!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===e(r)?r:String(r)}function r(e,r,n){return(r=t(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function n(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function s(e){n(i,o,a,s,u,"next",e)}function u(e){n(i,o,a,s,u,"throw",e)}s(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,t(o.key),o)}}function s(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=l(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},c.apply(this,arguments)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function d(t,r){if(r&&("object"===e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},m={exports:{}},g={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(g),function(e){var t=g.exports.default;function r(){e.exports=r=function(){return o},e.exports.__esModule=!0,e.exports.default=e.exports;var n,o={},a=Object.prototype,i=a.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},u="function"==typeof Symbol?Symbol:{},l=u.iterator||"@@iterator",c=u.asyncIterator||"@@asyncIterator",h=u.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(n){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o=t&&t.prototype instanceof _?t:_,a=Object.create(o.prototype),i=new T(n||[]);return s(a,"_invoke",{value:M(e,r,i)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=d;var m="suspendedStart",g="executing",y="completed",v={};function _(){}function w(){}function k(){}var b={};f(b,l,(function(){return this}));var x=Object.getPrototypeOf,L=x&&x(x(F([])));L&&L!==a&&i.call(L,l)&&(b=L);var E=k.prototype=_.prototype=Object.create(b);function C(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,r){function n(o,a,s,u){var l=p(e[o],e,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==t(h)&&i.call(h,"__await")?r.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):r.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var o;s(this,"_invoke",{value:function(e,t){function a(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(a,a):a()}})}function M(e,t,r){var o=m;return function(a,i){if(o===g)throw new Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:n,done:!0}}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var u=S(s,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===m)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=g;var l=p(e,t,r);if("normal"===l.type){if(o=r.done?y:"suspendedYield",l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=y,r.method="throw",r.arg=l.arg)}}}function S(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=p(o,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function F(e){if(e||""===e){var r=e[l];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}throw new TypeError(t(e)+" is not iterable")}return w.prototype=k,s(E,"constructor",{value:k,configurable:!0}),s(k,"constructor",{value:w,configurable:!0}),w.displayName=f(k,h,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,f(e,h,"GeneratorFunction")),e.prototype=Object.create(E),e},o.awrap=function(e){return{__await:e}},C(D.prototype),f(D.prototype,c,(function(){return this})),o.AsyncIterator=D,o.async=function(e,t,r,n,a){void 0===a&&(a=Promise);var i=new D(d(e,t,r,n),a);return o.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(E),f(E,h,"Generator"),f(E,l,(function(){return this})),f(E,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},o.values=F,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return s.type="throw",s.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:F(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),v}},o}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(m);var y=m.exports(),v=y;try{regeneratorRuntime=y}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=y:Function("r","regeneratorRuntime = r")(y)}var _={},w={};Object.defineProperty(w,"__esModule",{value:!0});var k=function(){function e(){}return e.CHANNEL="mf_profiler",e}();w.default=k;var b,x,L={};b=L,Object.defineProperty(b,"__esModule",{value:!0}),b.EventStage=void 0,(x=b.EventStage||(b.EventStage={}))[x.START=0]="START",x[x.TRACK_START=1]="TRACK_START",x[x.TRACK_END=2]="TRACK_END",x[x.BOX_INFERENCE_START=3]="BOX_INFERENCE_START",x[x.BOX_INFERENCE_END=4]="BOX_INFERENCE_END",x[x.INFERENCE_START=5]="INFERENCE_START",x[x.INFERENCE_END=6]="INFERENCE_END",x[x.RENDER_START=7]="RENDER_START",x[x.RENDER_END=8]="RENDER_END",x[x.RESOURCE=9]="RESOURCE";var E={};Object.defineProperty(E,"__esModule",{value:!0}),E.safeBroadcastChannel=void 0;var C=function(){function e(){}return e.prototype.postMessage=function(e){},e.prototype.addEventListener=function(e,t){},e.prototype.close=function(){},e}();E.safeBroadcastChannel=function(e,t){void 0===t&&(t="PROD");var r=new C;return"undefined"!=typeof BroadcastChannel?r=new BroadcastChannel(e):"DEV"===t&&void 0!==console.info&&console.info("WebProfiler is not supported on your browser"),r};var D=(p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(w),M=L,S=E.safeBroadcastChannel(D.default.CHANNEL);function P(e,t){if(Object.values(M.EventStage).includes(e)){var r={time:performance.now(),stage:e,url:t};S.postMessage(r)}else console.log(e+" is not a valid event")}function A(e){return T.apply(this,arguments)}function T(){return(T=o(v.mark((function e(t){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}function O(e){throw console.error(e),e}function I(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=document.createElement("canvas");if(n.width=e,n.height=t,n.style.background="rgb(255,255,255,0)",r){var o=n.getContext("2d");o.fillStyle=r,o.fillRect(0,0,e,t)}return n}void 0===window.mfBroadcast&&(window.mfBroadcast=function(e){},window.mfEnableProfiling=function(e,t,r){void 0===t&&(t="PROD"),window.mfBroadcast=P;var n={time:performance.now(),stage:M.EventStage.START,model:r,env:t,timer:e};S.postMessage(n)}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=w;Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}});var r=L;Object.defineProperty(e,"EventStage",{enumerable:!0,get:function(){return r.EventStage}});var n=E;Object.defineProperty(e,"safeBroadcastChannel",{enumerable:!0,get:function(){return n.safeBroadcastChannel}})}(_);const R=(e,t=null)=>{if(!e)throw console.error(t),new Error(`Assertion failed: ${t}`)},N=Math.pow(1,-10);class j{constructor(e=0,t=0){this.x=e,this.y=t}static fromObject(e){return e?new j(e.x||0,e.y||0):new j}add(e){return new j(this.x+e.x,this.y+e.y)}sub(e){return new j(this.x-e.x,this.y-e.y)}neg(){return new j(-this.x,-this.y)}multScalar(e){return new j(this.x*e,this.y*e)}divScalar(e){if(Math.abs(e)<N)throw new Error("divScalar: scalar is too close to 0.");return new j(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}normalized(){const e=this.norm();return e<N?new j(0,0):new j(this.x/e,this.y/e)}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}clone(){return new j(this.x,this.y)}setTo(e){this.x=e.x,this.y=e.y}}function B(e){let t=0,r=0;return e.forEach((({x:e,y:n})=>{t+=e,r+=n})),new j(t/e.length,r/e.length)}class z{constructor(){this.data=[]}writeZeroes(e){for(let t=0;t<e;t+=1)this.data.push(0)}write(e){this.data.push(e||0)}writeNumArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(t);for(let t=0;t<e.length;t+=1)this.write(e[t]);const r=t-e.length;this.writeZeroes(r)}writePoint(e){this.write(e.x),this.write(e.y)}writePointArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(2*t);for(let t=0;t<e.length;t+=1)this.writePoint(e[t]);const r=t-e.length;this.writeZeroes(2*r)}toFloat32(){return new Float32Array(this.data)}toFloat64(){return new Float64Array(this.data)}}class W{constructor(){this.outerMouth=null,this.innerMouth=null,this.leftEye=null,this.rightEye=null,this.leftBrow=null,this.rightBrow=null,this.nose=null,this.contour=null,this.foreheadPt=null,this.rightEye3D=[65.9,25.8,200.7],this.leftEye3D=[-65.9,25.8,200.7],this.nose3D=[0,-69.7,259.8],this.mouth3D=[0,-132.5,215.1],this.rightEyeInnerCorner3D=[32.6,27.1,196.5],this.leftEyeInnerCorner3D=[-32.6,27.1,196.5],this.rightEyeOuterCorner3D=[105.638,26.872,185.49],this.leftEyeOuterCorner3D=[-105.638,26.872,185.49],this.rightNose3D=[32.559,-20.731,206.171],this.leftNose3D=[-32.559,-20.731,206.171],this.modelMatrix=null,this.projectionViewMatrix=null,this.modelViewProjectionMatrix=null,this.faceRotation=[0,0,0],this.faceTranslation=[0,0,0]}static serialize(e){const t=new z;return t.writePointArray(e.outerMouth,13),t.writePointArray(e.innerMouth,8),t.writePointArray(e.leftEye,10),t.writePointArray(e.rightEye,10),t.writePointArray(e.leftBrow,7),t.writePointArray(e.rightBrow,7),t.writePointArray(e.nose,7),t.writePointArray(e.contour,3),t.writeNumArray([e.foreheadPt.x,e.foreheadPt.y],2),t.writeNumArray(e.faceRotation,3),t.writeNumArray(e.faceTranslation,3),t.writeNumArray(e.modelViewProjectionMatrix,12),t.writeNumArray(e.modelMatrix,16),t.writeNumArray(e.projectionViewMatrix,12),t.writeNumArray(e.rightEye3D,3),t.writeNumArray(e.leftEye3D,3),t.writeNumArray(e.nose3D,3),t.writeNumArray(e.mouth3D,3),t.writeNumArray(e.rightEyeInnerCorner3D,3),t.writeNumArray(e.leftEyeInnerCorner3D,3),t.writeNumArray(e.rightEyeOuterCorner3D,3),t.writeNumArray(e.leftEyeOuterCorner3D,3),t.writeNumArray(e.rightNose3D,3),t.writeNumArray(e.leftNose3D,3),new Uint8Array(t.toFloat32().buffer)}pose2DPoints(){const e=B(this.rightEye),t=B(this.leftEye),r=B(this.nose),n=B(this.outerMouth);return[e.x,e.y,t.x,t.y,r.x,r.y,n.x,n.y,this.rightEye[0].x,this.rightEye[0].y,this.leftEye[5].x,this.leftEye[5].y,this.rightEye[5].x,this.rightEye[5].y,this.leftEye[0].x,this.leftEye[0].y,this.nose[6].x,this.nose[6].y,this.nose[0].x,this.nose[0].y]}pose3DPoints(){return this.rightEye3D.concat(this.leftEye3D,this.nose3D,this.mouth3D,this.rightEyeInnerCorner3D,this.leftEyeInnerCorner3D,this.rightEyeOuterCorner3D,this.leftEyeOuterCorner3D,this.rightNose3D,this.leftNose3D)}}class H{constructor(){this.skinSmoothing=0,this.skinBrightening=0,this.skinGlow=0,this.shouldApplySkinEffectsToBaseLook=!1,this.intensity=1,this.nostrilThinning=0,this.noseBridgeThinning=0,this.jawSlimming=0,this.eyeHeightEnlarge=0,this.eyeWidthEnlarge=0,this.lipVolume=0,this.eyeEraseExpandFactor=.95}}class V{constructor(e,t,r,n,o){const a=(e,t)=>void 0!==e?e:t;this.r=a(e,0),this.g=a(t,0),this.b=a(r,0),this.a=255,this.amount=a(n,1),this.useIntenseDynamicColorParameters=!1,this.gloss=a(o,0),this.glitter=0,this.glitterDensity=1,this.glitterColorR=255,this.glitterColorG=255,this.glitterColorB=255,this.useDynamicColor=!0,this.contrastBoost=0,this.skinClearing=0,this.skinGlow=0,this.isSkinGlowDynamicByRotation=!0,this.glitterSize=1,this.glitterBaseReflectivity=.3,this.glitterColorVariation=0,this.glitterSizeVariation=0,this.useLegacyGlitter=!1,this.glossDetail=0,this.envMappingIntensity=0,this.envMappingR=255,this.envMappingG=255,this.envMappingB=255,this.envMappingRotationY=0,this.envMappingCurve=2.3,this.envMappingBumpIntensity=0,this.metallicIntensity=0,this.specularShininess=.8,this.matteness=0,this.vinylIntensity=0,this.textureBoost=0,this.lustre=0,this.opaqueness=0,this.specularCoarseness=0,this.blushGlow=0,this.isGlowOnlyOnBlush=!1,this.sparkleGlowSize=.3,this.sparkleGlowR=255,this.sparkleGlowG=255,this.sparkleGlowB=255,this.twinkleIntensity=0,this.twinkleDensity=.5,this.twinkleR=255,this.twinkleG=255,this.twinkleB=255,this.twinkleSize=1,this.twinkleSizeVariation=0,this.twinkleColorVariation=0}}const U={data:{blush:["apple","apple2","apple2_intense","apple_blended","apple_blended_intense","apple_intense","cheekbone","cheekbone_intense","contour","default_intense","full_cheek","full_cheek_intense","lower_cheek","lower_cheek_intense","none","upper_cheek","upper_cheek_intense","default"],brow:["default"],concealer:["default"],contour:["default2","default3","default4","forehead_side","forehead_side2","forehead_side3","forehead_side4","highlight","inner_eyebrow2","default","inner_eyebrow"],cushion:["default"],eyeliner:["angular_both","angular_top","Bold_eyeliner_both","Bold_eyeliner_top","butterfly_liner_both","butterfly_liner_top","butterfly_mask_both","butterfly_mask_top","cateye2_both","cateye2_top","cateye_both","cateye_top","cheetah_mask_both","cheetah_mask_top","cheetah_winged_both","cheetah_winged_top","Confident_eyeliner_both","Confident_eyeliner_top","crease_box_both","crease_box_top","crease_flare_both","crease_flare_top","crease_simple_long_both","crease_simple_long_top","crease_simple_short_both","crease_simple_short_top","double_winged_both","double_winged_top","elongated_bottom_both","elongated_bottom_top","extrasmallwinged_both","extrasmallwinged_top","fashion_look2_eyeliner_both","fashion_look2_eyeliner_top","GetTheLook_look1_eyeliner_both","GetTheLook_look1_eyeliner_top","GetTheLook_look3_eyeliner_both","GetTheLook_look3_eyeliner_top","halloween1_both","halloween1_top","halloween2_both","halloween2_top","halloween3_both","halloween3_top","halloween4_both","halloween4_top","halloween5_both","halloween5_top","innermid_crease_both","innermid_crease_top","kaja_both","kaja_top","kohl_both","kohl_top","la_inner_winged_both","la_inner_winged_top","la_mask_both","la_mask_top","la_middle_winged_both","la_middle_winged_top","la_outer_winged_both","la_outer_winged_top","MNY_FashionWeek_look1_liner1_both","MNY_FashionWeek_look1_liner1_top","MNY_FashionWeek_look1_liner2_both","MNY_FashionWeek_look1_liner2_top","MNY_FashionWeek_look1_liner3_both","MNY_FashionWeek_look1_liner3_top","MNY_Holiday_look1_eyeliner_crease_both","MNY_Holiday_look1_eyeliner_crease_top","MNY_Holiday_look2_eyeliner_outer_both","MNY_Holiday_look2_eyeliner_outer_top","MNY_Holiday_look2_eyeliner_under_both","MNY_Holiday_look2_eyeliner_under_top","natural","natural2_both","natural2_top","natural_both","natural_top","none_both","none_top","OAP_Halloween2020_look1_both","OAP_Halloween2020_look1_top","OAP_Halloween2020_look2_both","OAP_Halloween2020_look2_top","OAP_Halloween2020_look3_both","OAP_Halloween2020_look3_top","OAP_Halloween2020_look4_both","OAP_Halloween2020_look4_top","Powerful_eyeliner_both","Powerful_eyeliner_top","prima_ballerina_liner_both","prima_ballerina_liner_top","puppyeye_both","puppyeye_top","sharpwinged_inner_both","sharpwinged_inner_top","sharpwinged_outer_both","sharpwinged_outer_top","smallwinged_both","smallwinged_top","smokeyfull_both","smokeyfull_top","smoky2_both","smoky2_top","smokynautral_both","smokynautral_top","smoky_both","smoky_top","smudged_bottom_both","smudged_bottom_top","smudged_winged_both","smudged_winged_top","subtle_both","subtle_top","swoop_winged_liner_both","swoop_winged_liner_top","tear_both","tear_top","thick_winged_crease_both","thick_winged_crease_top","top_both","top_top","waterline_both","waterline_thick_both","waterline_thick_top","waterline_top","winged2_both","winged2_top","wingedsimple_both","wingedsimple_top","wingedthick_both","wingedthick_top","wingedthin_both","wingedthin_top","winged_both","winged_crease2_both","winged_crease2_top","winged_crease_both","winged_crease_top","winged_top"],eyeshadow:["angular_full","angular_liner","angular_overlay","Asian_1color","Asian_2color_A1","Asian_2color_A2","Asian_2color_B1","Asian_2color_B2","Asian_3color_A1","Asian_3color_A2","Asian_3color_A3","Asian_3color_B1","Asian_3color_B2","Asian_3color_B3","Azuki_Look_1","Azuki_Look_2","below_iris","black","bluelook1_a","bluelook1_b","bluelook1_b1","bluelook1_b2","bluelook1_c","bluelook2_a","bluelook2_b","bluelook2_c","bluelook2_eyebrow","bluelook3_a","bluelook3_b","bluelook3_c","bronze","browline2","butterfly_inner","center","centre_lid","cheetah_lid","cleopatra2_liner","colourqueenlook1_part1","colourqueenlook1_part2","colourqueenlook3_part1","colourqueenlook3_part2","Confident_eyeshadow","contour","crease3","deep_aqua","deep_blue","deep_blue_2","deep_blue_fade","dramatic_glam_part1","dramatic_glam_part2","dramatic_glam_part3","dramatic_glam_part4","elongated_bottom_liner","elongated_lid","energeticorange_part1","energeticorange_part2","energeticorange_part3","energeticorange_part4","eyegowild_look2_lower","eyegowild_look2_upper","eyegowild_look4","eyegowild_look4_liner","eyegowild_look5_liner","eyegowild_look5_lower","eyegowild_look5_upper","eyegowild_look6","eyegowild_look6_liner","eyeshadow_blue","eyeshadow_orange","eyeshadow_white","fashion_look1_part1","fashion_look1_part2","fashion_look2_part1","fashion_look2_part2","fashion_look3_part1","fashion_look3_part2","fashion_look4_part1","fashion_look4_part2","framed","full_lid3","GetTheLook_look1_eyeshadow1","GetTheLook_look1_eyeshadow2","GetTheLook_look1_eyeshadow3","GetTheLook_look1_eyeshadow4","GetTheLook_look2_eyeshadow1","GetTheLook_look2_eyeshadow2","GetTheLook_look3_eyeshadow","gold","Graphic_3_Liner","green","half_inner_lid","halloween1","halloween2","halloween3","indigomotion_part1","indigomotion_part2","indigomotion_part3","indigomotion_part4","innercorner","innermid_crease_liner","Kinu1_fadeliner","la_tear","light_blue","lowerlash2","lowerlash_thick","MNY_FashionWeek_look1_shadow1","MNY_FashionWeek_look1_shadow2","MNY_FashionWeek_look1_shadow3","MNY_Holiday_look1_eyeshadow_crease","MNY_Holiday_look2_eyeshadow_outer","MNY_Holiday_look2_eyeshadow_under","natural_liner","none","OP_look1_CS1","OP_look1_M3","OP_look1_ME5","OP_look1_ME6","OP_look2_CS1","OP_look2_P1","OP_look3_CS1","OP_look3_ME4","OP_look3_P1","OP_look4_ME6","OP_look4_P2","OP_look5_CS1","OP_look5_M3","OP_look5_M5","OP_look5_P4","OP_look6_CS1","OP_look6_M4","OP_look6_ME5","OP_look6_P3","OP_look7_G1","OP_look7_P1","OP_look7_PR1","OP_look8_G1","OP_look8_ME2","OP_look8_ME4","orangelook4_a","orangelook4_b","orangelook4_c","orangelook5_a","orangelook5_b","orangelook5_c","orangelook5_eyebrow","orangelook6_a","orangelook6_b","orangelook6_c","outer_corner_framed","outer_half_top","Powerful_eyeshadow_part1","Powerful_eyeshadow_part2","prima_ballerina_shadow","RisingStar","RisingStar_star","sharplid_full","sharp_lid2","side_crease","side_lid","SoftFever_part1","SoftFever_part2","sportykick_part1","sportykick_part2","sportykick_part3","sportykick_part4","stars_1a","stars_1b","stars_2a","stars_2c","stars_3a","stars_3b","stars_3c","summerpunch_part1","summerpunch_part2","summerpunch_part3","summerpunch_part4","tokyosunrise_part1","tokyosunrise_part2","tokyosunrise_part3","tokyosunrise_part4","wingedthin","winged_crease","default","full_lid","outer","inner","crease","brow_highlight","full_lid2","outer2","tear","crease2","browline","lowerlash","innerhalf","outerhalf","rectangular","smokycateye","fullcateye","cleopatra1","cleopatra2","full_smoky_lid","full_smoky_winged","fulllid_winged","innerlid","sharp_crease","sharp_lid","sharpinner_lid","sharpouter_corner","sharpwinged_inner","sharpwinged_outer"],foundation:["default"],highlight:["cheek1","cheek2","cheek3","cheek4","cheek5","cheek6","chin","chin2","contour","cupidsbow","eyebrow","eyebrow2","forehead","forehead_side","forehead_side4","glow1_cherie","glow2_monamour","glow3_lavieenglow","glow3_lavieenglow2","glow4_sorbet","nose1","nose2","nose3","nose4","triangle1","undereye","upperlip","default"],lipcolor:["inner_horizontal","inner_vertical","outer_horizontal","outer_vertical","default"],lipliner:["default"],mascara:["doll","doll_2","doll_2_full","drama","drama_full","extreme","extreme_full","fashion_look2_lash","FA_Asia_2_4","FA_Asia_2_5","grandiose","grandiose_full","idole_lash","length","lower","natural","naturallength","naturallength_2","naturalvolume","naturalvolumelength","naturalvolumelength_lower","naturalvolume_lower","naturalwhispy","naturalwhispy_lower","natural_2","natural_2_full","none","prima_ballerina_bottom_mascara","prima_ballerina_top_mascara","subtle","subtle_full","volume","volumelength","volume_2","volume_2_full","wicked_lash"],primer:["default"],settingspray:["default"]}};function G(e,t){return`https://d3bu57wgd5zjfz.cloudfront.net/cmswebservice-linux/production/data/mask_images/cross/${e}_${t}.png`}function q(e,t,r){const n=function(e,t){return U.data[e].indexOf(t)>-1}(e,t);return n?G(e,t):(console.warn(`Invalid placement: '${t}' is given, \n    using default placement '${r}' instead!`),G(e,r))}class Y{constructor(e){this.product=e||null}}class $ extends Y{constructor(e,t,r){super(e),this.blendMode="makeup",this.targetSide="both",this.maskImagePath=t,this.maskImageSize=r}}class J extends Y{constructor(e,t="default",r="full"){super(e),this.presetStyle="default",this.placement="full",this.blurFactor=.7,this.blurFactorInnerTop=.7,this.blurFactorInnerBottom=.7,this.lipMeshNumRowsUpper=0,this.lipMeshNumColsUpper=0,this.lipMeshNumRowsLower=0,this.lipMeshNumColsLower=0,this.upperLipXFillRange={fadeInStart:0,fadeInEnd:0,fadeOutStart:1,fadeOutEnd:1},this.lowerLipXFillRange={fadeInStart:0,fadeInEnd:0,fadeOutStart:1,fadeOutEnd:1},this.upperLipYFillRange={fadeInStart:0,fadeInEnd:0,fadeOutStart:1,fadeOutEnd:1},this.lowerLipYFillRange={fadeInStart:0,fadeInEnd:0,fadeOutStart:1,fadeOutEnd:1},this.presetStyle=t,this.placement=r}}class X extends ${constructor(e,t,r=null,n={width:250,height:188}){let o=r;o||(o=q("eyeliner",t,"natural_top")),super(e,o,n),this.presetStyle=t,this.referenceEyePoints=[new j(78,120),new j(136,103),new j(191,136),new j(138,137)]}}class K extends ${constructor(e,t,r=null,n={width:200,height:131}){let o=r;o||(o=q("mascara",t,"natural")),super(e,o,n),this.presetStyle=t,this.referenceEyePoints=[new j(53,75),new j(117,55),new j(182,93),new j(117,91)]}}class Z extends ${constructor(e,t,r=null,n={width:250,height:188}){let o=r;o||(o=q("eyeshadow",t,"full_lid")),super(e,o,n),this.presetStyle=t,this.referenceEyePoints=[new j(78,118),new j(136,102),new j(199,133),new j(138,143)],this.referenceBrowPoints=[new j(14,65),new j(84,38),new j(215,65)],this.referenceFullBrowPoints=[new j(11,31),new j(64,2),new j(156,19),new j(212,42),new j(162,56),new j(76,24),new j(204,63)],this.deformationAreaFactor=2}}class Q extends ${constructor(e,t,r=null,n={width:180,height:195}){let o=r;o||(o=q("blush",t,"default")),super(e,o,n),this.presetStyle=t}}class ee extends ${constructor(e,t,r=null,n={width:180,height:195}){let o=r;o||(o=q("concealer",t,"default")),super(e,o,n),this.presetStyle=t}}class te extends ${constructor(e,t,r){super(e,t,{width:0,height:0}),this.maskJSONPath=r}}class re extends te{constructor(e,t,r){super(e,t,r),this.eraseAmount=1}}class ne{constructor(e){this.outerAlign=0,this.outerVertAlign=0,this.innerAlign=0,this.innerVertAlign=0,this.localArchPull=0,this.localArchPullPointiness=0,this.globalArchPull=0,this.innerThickness=0,this.middleThickness=0,this.outerThickness=0,this.cleaningTop=0,this.cleaningBottom=0,this.cleaningInnerVertical=0,this.cleaningInnerRoundness=0,this.horizontalShift=0,this.verticalShift=0,e&&(e.outer_alignment_hor&&(this.outerAlign=e.outer_alignment_hor),e.outer_alignment_ver&&(this.outerVertAlign=e.outer_alignment_ver),e.inner_alignment_hor&&(this.innerAlign=e.inner_alignment_hor),e.inner_alignment_ver&&(this.innerVertAlign=e.inner_alignment_ver),e.arch_pull&&(this.localArchPull=e.arch_pull),e.j_pull&&(this.globalArchPull=e.j_pull),e.inner_thickness&&(this.innerThickness=e.inner_thickness),e.middle_thickness&&(this.middleThickness=e.middle_thickness),e.outer_thickness&&(this.outerThickness=e.outer_thickness),e.cleaning_top&&(this.cleaningTop=e.cleaning_top),e.cleaning_bottom&&(this.cleaningBottom=e.cleaning_bottom),e.cleaning_vertical&&(this.cleaningInnerVertical=e.cleaning_vertical),e.cleaning_inner_roundness&&(this.cleaningInnerRoundness=e.cleaning_inner_roundness))}}class oe{constructor(e){if(this.colorR=0,this.colorG=0,this.colorB=0,this.colorAmount=0,this.sparkleIntensity=0,this.sparkleR=255,this.sparkleG=255,this.sparkleB=255,this.sparkleDensity=.5,this.sparkleSize=1,this.sparkleColorVariation=0,this.sparkleSizeVariation=0,this.sparkleBaseReflectivity=.3,this.useLegacyGlitter=!1,e&&(e.color_r&&(this.colorR=e.color_r),e.color_g&&(this.colorG=e.color_g),e.color_b&&(this.colorB=e.color_b),e.color_a)){const t=e.color_a/255,r=(e.intensity-e.intensity_lower)/(e.intensity_upper-e.intensity_lower);this.colorAmount=t*r}}}class ae{constructor(e){this.overlayAmount=0,this.topExpansion=0,this.bottomExpansion=0,this.side="left",e&&e.overlay&&(e.overlay.mask&&(this.overlayImagePath=`brow_overlay/${e.overlay.mask}`),e.overlay.points&&(this.referenceBrowPoints=e.overlay.points),e.overlay_amount&&(this.overlayAmount=e.overlay_amount))}}class ie{constructor(e){this.powderIntensity=0,this.coloringParams=new oe(e),this.warpingParams=new ne(e),this.fillOverlayParams=new ae(e)}}class se extends te{}class ue extends Y{}var le="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ce={};!function(e,t){var r="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",a="[object Boolean]",i="[object Date]",s="[object Function]",u="[object GeneratorFunction]",l="[object Map]",c="[object Number]",h="[object Object]",f="[object Promise]",d="[object RegExp]",p="[object Set]",m="[object String]",g="[object Symbol]",y="[object WeakMap]",v="[object ArrayBuffer]",_="[object DataView]",w="[object Float32Array]",k="[object Float64Array]",b="[object Int8Array]",x="[object Int16Array]",L="[object Int32Array]",E="[object Uint8Array]",C="[object Uint8ClampedArray]",D="[object Uint16Array]",M="[object Uint32Array]",S=/\w*$/,P=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,T={};T[o]=T["[object Array]"]=T[v]=T[_]=T[a]=T[i]=T[w]=T[k]=T[b]=T[x]=T[L]=T[l]=T[c]=T[h]=T[d]=T[p]=T[m]=T[g]=T[E]=T[C]=T[D]=T[M]=!0,T["[object Error]"]=T[s]=T[y]=!1;var F="object"==typeof le&&le&&le.Object===Object&&le,O="object"==typeof self&&self&&self.Object===Object&&self,I=F||O||Function("return this")(),R=t&&!t.nodeType&&t,N=R&&e&&!e.nodeType&&e,j=N&&N.exports===R;function B(e,t){return e.set(t[0],t[1]),e}function z(e,t){return e.add(t),e}function W(e,t,r,n){var o=-1,a=e?e.length:0;for(n&&a&&(r=e[++o]);++o<a;)r=t(r,e[o],o,e);return r}function H(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function V(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function U(e,t){return function(r){return e(t(r))}}function G(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var q,Y=Array.prototype,$=Function.prototype,J=Object.prototype,X=I["__core-js_shared__"],K=(q=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"",Z=$.toString,Q=J.hasOwnProperty,ee=J.toString,te=RegExp("^"+Z.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),re=j?I.Buffer:void 0,ne=I.Symbol,oe=I.Uint8Array,ae=U(Object.getPrototypeOf,Object),ie=Object.create,se=J.propertyIsEnumerable,ue=Y.splice,ce=Object.getOwnPropertySymbols,he=re?re.isBuffer:void 0,fe=U(Object.keys,Object),de=Re(I,"DataView"),pe=Re(I,"Map"),me=Re(I,"Promise"),ge=Re(I,"Set"),ye=Re(I,"WeakMap"),ve=Re(Object,"create"),_e=We(de),we=We(pe),ke=We(me),be=We(ge),xe=We(ye),Le=ne?ne.prototype:void 0,Ee=Le?Le.valueOf:void 0;function Ce(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function De(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Me(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Se(e){this.__data__=new De(e)}function Pe(e,t,r){var n=e[t];Q.call(e,t)&&He(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function Ae(e,t){for(var r=e.length;r--;)if(He(e[r][0],t))return r;return-1}function Te(e,t,r,n,f,y,P){var A;if(n&&(A=y?n(e,f,y,P):n(e)),void 0!==A)return A;if(!Ye(e))return e;var F=Ve(e);if(F){if(A=function(e){var t=e.length,r=e.constructor(t);return t&&"string"==typeof e[0]&&Q.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!t)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,A)}else{var O=je(e),I=O==s||O==u;if(Ge(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if(O==h||O==o||I&&!y){if(H(e))return y?e:{};if(A=function(e){return"function"!=typeof e.constructor||ze(e)?{}:Ye(t=ae(e))?ie(t):{};var t}(I?{}:e),!t)return function(e,t){return Oe(e,Ne(e),t)}(e,function(e,t){return e&&Oe(t,$e(t),e)}(A,e))}else{if(!T[O])return y?e:{};A=function(e,t,r,n){var o,s=e.constructor;switch(t){case v:return Fe(e);case a:case i:return new s(+e);case _:return function(e,t){var r=t?Fe(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case w:case k:case b:case x:case L:case E:case C:case D:case M:return function(e,t){var r=t?Fe(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case l:return function(e,t,r){return W(t?r(V(e),!0):V(e),B,new e.constructor)}(e,n,r);case c:case m:return new s(e);case d:return function(e){var t=new e.constructor(e.source,S.exec(e));return t.lastIndex=e.lastIndex,t}(e);case p:return function(e,t,r){return W(t?r(G(e),!0):G(e),z,new e.constructor)}(e,n,r);case g:return o=e,Ee?Object(Ee.call(o)):{}}}(e,O,Te,t)}}P||(P=new Se);var R=P.get(e);if(R)return R;if(P.set(e,A),!F)var N=r?function(e){return function(e,t,r){var n=t(e);return Ve(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,$e,Ne)}(e):$e(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r););}(N||e,(function(o,a){N&&(o=e[a=o]),Pe(A,a,Te(o,t,r,n,a,e,P))})),A}function Fe(e){var t=new e.constructor(e.byteLength);return new oe(t).set(new oe(e)),t}function Oe(e,t,r,n){r||(r={});for(var o=-1,a=t.length;++o<a;){var i=t[o],s=n?n(r[i],e[i],i,r,e):void 0;Pe(r,i,void 0===s?e[i]:s)}return r}function Ie(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function Re(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Ye(e)||(t=e,K&&K in t))&&(qe(e)||H(e)?te:P).test(We(e));var t}(r)?r:void 0}Ce.prototype.clear=function(){this.__data__=ve?ve(null):{}},Ce.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Ce.prototype.get=function(e){var t=this.__data__;if(ve){var n=t[e];return n===r?void 0:n}return Q.call(t,e)?t[e]:void 0},Ce.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:Q.call(t,e)},Ce.prototype.set=function(e,t){return this.__data__[e]=ve&&void 0===t?r:t,this},De.prototype.clear=function(){this.__data__=[]},De.prototype.delete=function(e){var t=this.__data__,r=Ae(t,e);return!(r<0||(r==t.length-1?t.pop():ue.call(t,r,1),0))},De.prototype.get=function(e){var t=this.__data__,r=Ae(t,e);return r<0?void 0:t[r][1]},De.prototype.has=function(e){return Ae(this.__data__,e)>-1},De.prototype.set=function(e,t){var r=this.__data__,n=Ae(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},Me.prototype.clear=function(){this.__data__={hash:new Ce,map:new(pe||De),string:new Ce}},Me.prototype.delete=function(e){return Ie(this,e).delete(e)},Me.prototype.get=function(e){return Ie(this,e).get(e)},Me.prototype.has=function(e){return Ie(this,e).has(e)},Me.prototype.set=function(e,t){return Ie(this,e).set(e,t),this},Se.prototype.clear=function(){this.__data__=new De},Se.prototype.delete=function(e){return this.__data__.delete(e)},Se.prototype.get=function(e){return this.__data__.get(e)},Se.prototype.has=function(e){return this.__data__.has(e)},Se.prototype.set=function(e,t){var r=this.__data__;if(r instanceof De){var n=r.__data__;if(!pe||n.length<199)return n.push([e,t]),this;r=this.__data__=new Me(n)}return r.set(e,t),this};var Ne=ce?U(ce,Object):function(){return[]},je=function(e){return ee.call(e)};function Be(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||A.test(e))&&e>-1&&e%1==0&&e<t}function ze(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||J)}function We(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function He(e,t){return e===t||e!=e&&t!=t}(de&&je(new de(new ArrayBuffer(1)))!=_||pe&&je(new pe)!=l||me&&je(me.resolve())!=f||ge&&je(new ge)!=p||ye&&je(new ye)!=y)&&(je=function(e){var t=ee.call(e),r=t==h?e.constructor:void 0,n=r?We(r):void 0;if(n)switch(n){case _e:return _;case we:return l;case ke:return f;case be:return p;case xe:return y}return t});var Ve=Array.isArray;function Ue(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!qe(e)}var Ge=he||function(){return!1};function qe(e){var t=Ye(e)?ee.call(e):"";return t==s||t==u}function Ye(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function $e(e){return Ue(e)?function(e,t){var r=Ve(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ue(e)}(e)&&Q.call(e,"callee")&&(!se.call(e,"callee")||ee.call(e)==o)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,a=!!n;for(var i in e)!t&&!Q.call(e,i)||a&&("length"==i||Be(i,n))||r.push(i);return r}(e):function(e){if(!ze(e))return fe(e);var t=[];for(var r in Object(e))Q.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return Te(e,!0,!0)}}({get exports(){return ce},set exports(e){ce=e}},ce);var he,fe=ce;function de(e,t,r){void 0!==e[t]&&(e[r]=e[t],delete e[t])}function pe(e){return"number"==typeof e}function me(e,t,r,n,o="overwrite"){const a=e[t];pe(a)&&(r[n]&&"max"===o?r[n]=Math.max(r[n],a):r[n]=a)}function ge(e,t){if(!e)return t;const r=e.indexOf("Style");if(-1===r)return console.warn(`presetStyle '${e}' cannot be converted`),t;const n=e.substring(r+5);return n.charAt(0).toLowerCase()+n.slice(1)}function ye(e,t,r){return t&&t in e?e[t]:r}function ve(e,t){return e&&e.includes("|")?"both":ye({MFEMakeupLayerSideNone:"none",MFEMakeupLayerSideLeft:"left",MFEMakeupLayerSideRight:"right",MFEMakeupLayerSideBoth:"both"},e,t)}function _e(e){return e?{fadeInStart:e.fadeInStart,fadeInEnd:e.fadeInEnd,fadeOutStart:e.fadeOutStart,fadeOutEnd:e.fadeOutEnd}:null}function we(e){if(!e)return null;const t=new V;return Object.assign(t,e),de(t,"colorR","r"),de(t,"colorG","g"),de(t,"colorB","b"),de(t,"colorA","a"),de(t,"intensity","amount"),de(t,"sparkleIntensity","glitter"),de(t,"sparkleDensity","glitterDensity"),de(t,"sparkleR","glitterColorR"),de(t,"sparkleG","glitterColorG"),de(t,"sparkleB","glitterColorB"),de(t,"sparkleSize","glitterSize"),de(t,"sparkleBaseReflectivity","glitterBaseReflectivity"),de(t,"sparkleColorVariation","glitterColorVariation"),de(t,"sparkleSizeVariation","glitterSizeVariation"),t}function ke(e){if(!e)return null;const t=new ae;return Object.assign(t,e),t.side=ye({Left:"left",Right:"right"},e.side,"left"),t}function be(e){const t=new ie;return e&&e.params?(t.warpingParams=function(e){if(!e)return null;const t=new ne;return Object.assign(t,e),t}(e.params.warpingParams),t.coloringParams=function(e){if(!e)return null;const t=new oe;return Object.assign(t,e),e.colorA&&(t.colorAmount=e.colorA/255),t}(e.params.coloringParams),t.overlayParams=ke(e.params.overlayParams),t.fillOverlayParams=ke(e.params.fillOverlayParams),"powderIntensity"in e.params&&(t.powderIntensity=e.params.powderIntensity),t):t}function xe(e,t="custom",r="MakeupLayer"){var n;if(!e)return null;const o=(e,t)=>{t.blendMode=ye({MFEMakeupLayerBlendModeMakeup:"makeup",MFEMakeupLayerBlendModeAlphaBlend:"alphaBlend",MFEMakeupLayerBlendModeMakeupBlend:"makeupBlend",MFEMakeupLayerBlendModeSolidColorBlend:"solidColorBlend"},e.blendMode,"makeup"),t.sourceSide=ve(e.sourceSide,"left"),t.targetSide=ve(e.targetSide,"both"),t.glitterMaskImage=e.glitterMaskImage,t.glitterSurfaceNormalImage=e.glitterSurfaceNormalImage};function a(e,t,r){void 0!==e[r]&&(t[r]=e[r].map((e=>new j(e.x,e.y))))}const i=we(e.product);switch(null!==(n=e.class)&&void 0!==n?n:r){case"MakeupLayer":return new Y(i);case"MakeupMaskLayer":{const t=e,r=new $(i,t.maskImagePath,t.maskImageSize);return o(t,r),r}case"MakeupLipLayer":{const r=e,n=new J(i,ge(r.presetStyle,t),ye({MFEMakeupLipstickPlacementFull:"full",MFEMakeupLipstickPlacementInnerHorizontal:"innerHorizontal",MFEMakeupLipstickPlacementOuterHorizontal:"outerHorizontal",MFEMakeupLipstickPlacementInnerVertical:"innerVertical",MFEMakeupLipstickPlacementOuterVertical:"outerVertical"},r.placement,"full"));return s=r,(u=n).upperLipXFillRange=_e(s.upperLipXFillRange),u.lowerLipXFillRange=_e(s.lowerLipXFillRange),u.upperLipYFillRange=_e(s.upperLipYFillRange),u.lowerLipYFillRange=_e(s.lowerLipYFillRange),me(r,"blurFactor",n,"blurFactor"),me(r,"blurFactorInnerTop",n,"blurFactorInnerTop"),me(r,"blurFactorInnerBottom",n,"blurFactorInnerBottom"),n}case"MakeupEyeLinerLayer":{const r=e,n=new X(i,ge(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return o(r,n),void 0!==r.referenceEyePoints?(delete n.referenceEyePointsFull,a(r,n,"referenceEyePoints")):void 0!==r.referenceEyePointsFull&&(delete n.referenceEyePoints,a(r,n,"referenceEyePointsFull")),n}case"MakeupMascaraLayer":{const r=e,n=new K(i,ge(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return o(r,n),a(r,n,"referenceEyePoints"),n}case"MakeupEyeShadowLayer":{const r=e,n=new Z(i,ge(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return o(r,n),me(r,"deformationAreaFactor",n,"deformationAreaFactor"),a(r,n,"referenceEyePoints"),a(r,n,"referenceBrowPoints"),a(r,n,"referenceFullBrowPoints"),n}case"MakeupBlushLayer":{const r=e,n=new Q(i,ge(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return o(r,n),me(r,"offsetX",n,"offsetX"),me(r,"offsetY",n,"offsetY"),me(r,"scaleX",n,"scaleX"),me(r,"scaleY",n,"scaleY"),n}case"MakeupConcealerLayer":{const r=e,n=new ee(i,ge(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return o(r,n),me(r,"offsetX",n,"offsetX"),me(r,"offsetY",n,"offsetY"),me(r,"scaleX",n,"scaleX"),me(r,"scaleY",n,"scaleY"),n}case"MakeupDeformableFoundationLayer":{const t=e,r=fe(t);return r.product=i,o(t,r),r}case"DeformableCustomLayer":{const t=e,r=new te(i,t.maskImagePath,t.maskJsonPath);return o(t,r),me(t,"maxCols",r,"maxCols"),me(t,"maxRows",r,"maxRows"),r}case"MakeupEraseDeformableCustomLayer":{const t=e,r=new re(i,t.maskImagePath,t.maskJsonPath);return o(t,r),me(t,"maxCols",r,"maxCols"),me(t,"maxRows",r,"maxRows"),me(t,"eraseAmount",r,"eraseAmount"),r}case"MakeupDeformableCustomLayer":{const t=e,r=new se(i,t.maskImagePath,t.maskJsonPath);return void 0!==t.eraseMasks&&(r.eraseMasks=t.eraseMasks.map((e=>xe(e,"default","MakeupEraseDeformableCustomLayer")))),r}case"MakeupFoundationLayer":{const t=e,r=new ue(i);return void 0!==t.shadeMatchedProduct&&(r.shadeMatchedProduct=we(t.shadeMatchedProduct)),r}default:return null}var s,u}function Le(e,t="custom",r="MakeupLayer"){return e?e.map((e=>xe(e,t,r))):null}function Ee(e,t=null,r=null){const n=new H;if(e){Object.assign(n,{lipLayer:xe(e.lipLayer,"default","MakeupLipLayer"),lipLayers:Le(e.lipLayers,"default","MakeupLipLayer"),blushLayers:Le(e.blushLayers,"blush","MakeupBlushLayer"),eyeLinerLayers:Le(e.eyeLinerLayers,"natural","MakeupEyeLinerLayer"),mascaraLayers:Le(e.mascaraLayers,"natural","MakeupMascaraLayer"),eyeShadowLayers:Le(e.eyeShadowLayers,"lid","MakeupEyeShadowLayer"),foundationLayer:xe(e.foundationLayer),cushionLayer:xe(e.cushionLayer),primerLayer:xe(e.primerLayer),settingSprayLayer:xe(e.settingSprayLayer),lipLinerLayer:xe(e.lipLinerLayer),concealerLayer:xe(e.concealerLayer,"default","MakeupConcealerLayer"),deformableFoundationLayers:Le(e.deformableFoundationLayers,"custom","MakeupDeformableFoundationLayer"),browLayer:be(e.browEffectsLayer),particleEffectsLayer:(o=e.particleEffectsLayer,"number"==typeof o||"string"==typeof o||"boolean"==typeof o?o:o?JSON.parse(JSON.stringify(o)):null)});const t=function(e){const t=["eyeEraseExpandFactorInner","eyeEraseExpandFactorOuter","eyeEraseExpandFactorTop","eyeEraseExpandFactorBottom"].filter((t=>pe(e[t])));return t.length>0?(console.warn('Warning: eye erase parameters have been consolidated into "eyeEraseExpandFactor", will use the average'),t.reduce(((t,r)=>t+e[r]),0)/t.length):null}(e);"number"==typeof t&&(n.eyeEraseExpandFactor=t),n.shouldApplySkinEffectsToBaseLook=Boolean(e.shouldApplySkinEffectsToBaseLook),me(e,"intensity",n,"intensity"),me(e,"skinClearingAmount",n,"skinSmoothing"),me(e,"skinGlowAmount",n,"skinGlow"),me(e,"skinBrighteningAmount",n,"skinBrightening")}var o;return function(e,t){if(!t)return;const r=(r,n)=>{me(t,r,e,n)};r("nostrilWarpHoriz","nostrilThinning"),r("noseBridgeWarpHoriz","noseBridgeThinning"),r("jawLine","jawSlimming"),r("eyeEnlargeVert","eyeHeightEnlarge"),r("eyeEnlargeHoriz","eyeWidthEnlarge"),r("lipVolume","lipVolume"),r("skinClearingAmount","skinSmoothing"),r("skinBrighteningAmount","skinBrightening"),r("skinGlowAmount","skinGlow")}(n,t),r&&(me(r,"skinClearingAmount",n,"skinSmoothing","max"),me(r,"skinGlowAmount",n,"skinGlow","max"),me(r,"skinBrighteningAmount",n,"skinBrightening","max")),n}function Ce(e){return JSON.stringify(e)}function De(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((n=n.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class Me{constructor(e,t,r="default"){this.loadHandlerType=null,this.resourceURL=e,this.isBuiltInResource=t,this.type=r}}class Se extends Me{constructor(e,t,r,n="default"){super(e,r,n),this.loadHandlerType="image",this.isGrayscale=t}}class Pe extends Me{constructor(){super(...arguments),this.loadHandlerType="json"}}function Ae(e){return void 0!==e.maskJSONPath}function Te(){const e=[];for(let t=0;t<10;t+=1)e.push(new Se(`glitter/glitter_particle_normal.${t}.png`,!1,!0)),e.push(new Se(`glitter/glitter_particle_center.${t}.png`,!1,!0));return e.push(new Se("glitter/glitter_env_cubemap.png",!1,!0)),e.push(new Se("glitter/glitter_brdf_lut.png",!1,!0)),e}function Fe(e){const t=[],r=[];return e.forEach((e=>{t.includes(e.resourceURL)||(t.push(e.resourceURL),r.push(e))})),r}!function(e){e[e.Medium=0]="Medium",e[e.High=1]="High"}(he||(he={}));class Oe{constructor(e){this.module=null,this.cameraArraySize=0,this.cameraArrayPtr=0,this.cameraWidth=0,this.cameraHeight=0,this.loadImageHandler=null,this.loadJSONHandler=null,this.currentLookBefore=null,this.currentLookBeforeJSON=null,this.currentLookAfter=null,this.currentLookAfterJSON=null,this.effectVisibility=null,this.loadedImages=new Map,this.loadedJSONs=new Map,this.emscriptenConstructor=null,this.quality=he.Medium,this.convertOutputToNV12=!1,this.enableComparisonMode=!1,this.comparisonPercent=.5,this.enableFaceChart=!1,this.flipY=!1,this.startTime=0,this.glContext=null,this.lastTintURL=null,this.lastTintUpdatePromise=Promise.resolve(),this.drawFacePoints=!1,this.emscriptenLocateFileFunc=null,this.requestOverride=null,this.printOverride=null,this.loadLookResourcesInParallel=!1,this.enableParallelTracking=!1,this.hideMakeup=!1,this.instantiateWasmOverride=null,this.emscriptenConstructor=e}load(e,t,r){return De(this,void 0,void 0,(function*(){const n=new Promise((n=>{const o={canvas:e,postRun:()=>{this.log("postRun"),o.cw_init=o.cwrap("init",null,["number","number"]),o.cw_resizeView=o.cwrap("resizeView",null,["number","number"]),o.cw_setFaceTrackerData=o.cwrap("setFaceTrackerData",null,["array","number","number","number","number","number","number","number","number"]),o.cw_getIsMouthOpen=o.cwrap("getIsMouthOpen","number",["number"]),o.cw_resetTrackerData=o.cwrap("resetTrackerData",null,[]),o.cw_setMakeupLookBefore=o.cwrap("setMakeupLookBefore",null,["string"]),o.cw_setMakeupLookAfter=o.cwrap("setMakeupLookAfter",null,["string"]),o.cw_setEffectVisibility=o.cwrap("setEffectVisibility",null,["number","number","number","number"]),o.cw_newCachedImage=o.cwrap("newCachedImage","number",["string","number","number","number"]),o.cw_addJSONToCache=o.cwrap("addJSONToCache",null,["string","string"]),o.cw_removeImageFromCache=o.cwrap("removeImageFromCache",null,["string"]),o.cw_setQuality=o.cwrap("setQuality",null,["number"]),o.cw_render=o.cwrap("render",null,["number","number","number","number","number","number"]),o.cw_renderFromNV12Data=o.cwrap("renderFromNV12Data",null,["number","number","number"]),o.cw_captureOutput=o.cwrap("captureOutput",null,["number","number","number","number","number"]),o.cw_freeCapturedOutput=o.cwrap("freeCapturedOutput",null,[]),o.cw_setComparisonModeSettings=o.cwrap("setComparisonModeSettings",null,["number","number"]),o.cw_setComparisonBarWidth=o.cwrap("setComparisonBarWidth",null,["number"]),o.cw_setComparisonBarColor=o.cwrap("setComparisonBarColor",null,["number","number","number"]),o.cw_setEnableFaceChart=o.cwrap("setEnableFaceChart",null,["number"]),o.cw_getTintImagePathForEffect=o.cwrap("getTintImagePathForEffect","number",["number"]),o.cw_setTintEffectImagePath=o.cwrap("setTintEffectImagePath",null,["string"]),o.cw_setConvertOutputToNV12=o.cwrap("setConvertOutputToNV12",null,["number"]),o.cw_getCanvasBufferPixelData=o.cwrap("getCanvasBufferPixelData",null,["number","number","number","number"]),o.cw_setFlipY=o.cwrap("setFlipY",null,["number"]),o.cw_setEnableParallelTracking=o.cwrap("setEnableParallelTracking",null,["number"]),o.cw_prepareAndBindNV12InputTexture=o.cwrap("prepareAndBindNV12InputTexture","number",["number","number"]),o.cw_processNV12InputTexture=o.cwrap("processNV12InputTexture",null,["number","number","number","number"]),o.cw_useAndConvertNV12Input=o.cwrap("useAndConvertNV12Input",null,["number","number","number","number","number"]),o.cw_cropResizeConvertedNV12=o.cwrap("cropResizeConvertedNV12",null,["number","number","number","number","number","number"]),o.cw_getDownsizedConvertedNV12=o.cwrap("getDownsizedConvertedNV12","number",[]),o.cw_getCroppedConvertedNV12=o.cwrap("getCroppedConvertedNV12","number",[]),o.cw_isFoundationCloseMatch=o.cwrap("isFoundationCloseMatch","number",["number","number"]),o.cw_init(t,r),this.glContext=e.getContext("webgl"),n()}};if("undefined"!=typeof XMLHttpRequest)o.request=XMLHttpRequest;else{if(!this.requestOverride)throw new Error("CoreSDKWrapper.requestOverride was not set");o.request=this.requestOverride}this.emscriptenLocateFileFunc&&(o.locateFile=this.emscriptenLocateFileFunc),this.printOverride&&(o.print=this.printOverride,o.printErr=this.printOverride),this.instantiateWasmOverride&&(o.instantiateWasm=this.instantiateWasmOverride),this.module=this.emscriptenConstructor(o)}));yield n,this.startTime=(new Date).getTime(),this.currentLookBefore&&this.setLookBefore(this.currentLookBefore,!0),this.currentLookAfter&&this.setLook(this.currentLookAfter,!0),this.effectVisibility&&this.setEffectVisbility(this.effectVisibility),this.setEnableComparisonMode(this.enableComparisonMode),this.setComparisonPercent(this.comparisonPercent),this.setQuality(this.quality),this.setConvertOutputToNV12(this.convertOutputToNV12),this.setEnableParallelTracking(this.enableParallelTracking),this.setFlipY(this.flipY),this.setEnableFaceChart(this.enableFaceChart),this.setTintEffect(this.tintEffect)}))}getTimeSeconds(){return((new Date).getTime()-this.startTime)/1e3}log(e){this.printOverride?this.printOverride(e):console.log(e)}getCameraInputArray(){return new Uint8Array(this.module.HEAPU8.buffer,this.cameraArrayPtr,this.cameraArraySize)}allocateCameraBuffer(e,t){return De(this,void 0,void 0,(function*(){const r=e*t*4;this.cameraArraySize!==r&&(this.cameraArrayPtr&&this.module._free(this.cameraArrayPtr),this.cameraArraySize=r,this.cameraArrayPtr=this.module._malloc(r),this.cameraWidth=e,this.cameraHeight=t)}))}static resolvePathForType(e,t,r){let n=e;return t&&("default"===r?n=`default/${e}`:"particles"===r&&(n=`Particles/${e}`)),n}preloadImage(e){return De(this,void 0,void 0,(function*(){const{resourceURL:t,isGrayscale:r,isBuiltInResource:n,type:o}=e,a=Oe.resolvePathForType(t,n,o);if(this.loadedImages.get(a))return void(this.loadedImages.get(a).isGrayscale!==r&&this.log(`${a} is already loaded with different color settings`));this.log(`Loading image ${a}, grayscale: ${r}, isBuiltInResource: ${n}`);const{buffer:i,width:s,height:u}=yield this.loadImageHandler(a,r,n),l=r?1:4,c=s*u*l,h=this.module.cw_newCachedImage(a,s,u,l);new Uint8Array(this.module.HEAPU8.buffer,h,c).set(i);const f={storagePointer:h,isGrayscale:r};this.loadedImages.set(a,f)}))}preloadJSON(e){return De(this,void 0,void 0,(function*(){const{resourceURL:t,isBuiltInResource:r,type:n}=e,o=Oe.resolvePathForType(t,r,n);if(this.loadedJSONs.get(o))return;this.log(`Loading json ${o}`);const a=yield this.loadJSONHandler(o,r),i={json:a};this.loadedJSONs.set(o,i),this.module.cw_addJSONToCache(o,a)}))}removeImageFromCache(e){this.loadedImages.delete(e),this.module.cw_removeImageFromCache(e)}preloadFilesForLook(e){return De(this,void 0,void 0,(function*(){const t=function(e){const t=[],r=(e,r=null)=>{var n,o;if(function(e){return void 0!==e.maskImagePath}(e)){if(e.maskImagePath&&e.maskImagePath.length>0){const r=!e.blendMode||"makeup"===e.blendMode||"solidColorBlend"===e.blendMode;t.push(new Se(e.maskImagePath,r,!1)),"makeupBlend"!==e.blendMode&&"alphaBlend"!==e.blendMode||t.push(new Se("white.png",!0,!0))}(null===(n=e.product)||void 0===n?void 0:n.glitter)>0&&t.push(...function(e,t=null){const r=Te();return e.glitterMaskImage&&r.push(new Se(e.glitterMaskImage,!0,!1)),e.glitterSurfaceNormalImage?r.push(new Se(e.glitterSurfaceNormalImage,!1,!1)):t&&r.push(new Se(t,!1,!0)),r}(e,r))}else(null===(o=e.product)||void 0===o?void 0:o.glitter)>0&&t.push(...Te())},n=e=>{e.maskJSONPath&&e.maskJSONPath.length>0&&t.push(new Pe(e.maskJSONPath,!1))},o=(e,r)=>{var n,o;if((null===(n=e.product)||void 0===n?void 0:n.skinGlow)>0)if(t.push(new Se("white.png",!0,!0)),null===(o=e.product)||void 0===o?void 0:o.isSkinGlowDynamicByRotation)t.push(new Se("Foundation/FoundationGlow_June4-2020_v2.png",!1,!0)),t.push(new Se("Foundation/normal_map7_v1.png",!1,!0));else{const e=r?"Foundation/radiantsettingspray_mask.png":"Foundation/GlowMasksCropped2.png";t.push(new Se(e,!1,!0))}},a=e=>{r(e),n(e),e.eraseMasks&&e.eraseMasks.forEach((e=>{r(e),n(e)}))},i=e=>{e.forEach((e=>{r(e),Ae(e)&&a(e)}));const n=[],o=[];e.some((e=>{var t;return(null===(t=e.product)||void 0===t?void 0:t.metallicIntensity)>0}))&&(n.push("Metallic/EyeNormals.png"),n.push("Metallic/EyeEnvMap.png"),o.push("Metallic/EyeSpecular.png")),e.some((e=>{var t;return(null===(t=e.product)||void 0===t?void 0:t.vinylIntensity)>0}))&&(n.push("Vinyl/EyeEnvMap.png"),n.push("Vinyl/EyeNormals.png")),e.some((e=>{var t;return(null===(t=e.product)||void 0===t?void 0:t.gloss)>0}))&&(o.push("Eyeshadow/Glossy_Lid7.png"),o.push("Eyeshadow/gloss4.png"));const i=o.map((e=>new Se(e,!0,!0)));t.push(...i);const s=n.map((e=>new Se(e,!1,!0)));t.push(...s)},s=e=>{e.forEach((e=>{r(e)}))};e.blushLayers&&e.blushLayers.forEach((e=>{(e=>{var n;r(e,"glitter/blush_glitter_surface_normal.png"),t.push(new Se("Blush/drop_4_sub_left_2.png",!0,!0)),(null===(n=e.product)||void 0===n?void 0:n.blushGlow)>0&&(t.push(new Se("white.png",!0,!0)),e.product.isSkinGlowDynamicByRotation?(t.push(new Se("Blush/BlushGlow_June4-2020_v2.png",!1,!0)),t.push(new Se("Foundation/normal_map7_v1.png",!1,!0))):t.push(new Se("Blush/GlowMasksCropped2.png",!1,!0))),Ae(e)&&a(e)})(e)})),e.eyeLinerLayers&&i(e.eyeLinerLayers),e.mascaraLayers&&e.mascaraLayers.forEach((e=>{r(e),Ae(e)&&a(e)})),e.eyeShadowLayers&&i(e.eyeShadowLayers),e.faceOverlayLayers&&(s(e.faceOverlayLayers),e.faceOverlayLayers.forEach((e=>{"alphaBlend"===e.blendMode&&("overlayFilled"===e.presetStyle?t.push(new Se("overlay-mask-filled.png",!0,!0)):t.push(new Se("overlay-mask.png",!0,!0)))}))),e.concealerLayer&&(r(e.concealerLayer),Ae(e.concealerLayer)&&a(e.concealerLayer));const u=[];return e.lipLayer&&u.push(e.lipLayer),e.lipLayers&&u.push(...e.lipLayers),u.forEach((e=>{var n,o;Ae(e)?a(e):((null===(n=e.product)||void 0===n?void 0:n.envMappingIntensity)>0||(null===(o=e.product)||void 0===o?void 0:o.metallicIntensity)>0)&&(void 0!==e.presetStyle?"brilliant"===e.presetStyle?(t.push(new Se("brilliant_lip_cubemap.png",!1,!0)),t.push(new Se("basic_lip_normals.png",!1,!0))):"metallic"===e.presetStyle?t.push(new Se("Metallic/LipNormals.png",!1,!0)):(t.push(new Se("basic_lip_cubemap.png",!1,!0)),t.push(new Se("basic_lip_normals.png",!1,!0))):(t.push(new Se("basic_lip_cubemap.png",!1,!0)),t.push(new Se("basic_lip_normals.png",!1,!0)))),r(e)})),e.lipLinerLayer&&Ae(e.lipLinerLayer)&&(r(e.lipLinerLayer),a(e.lipLinerLayer)),e.foundationLayer&&(o(e.foundationLayer,!1),Ae(e.foundationLayer)&&a(e.foundationLayer)),e.primerLayer&&(o(e.primerLayer,!1),Ae(e.primerLayer)&&a(e.primerLayer)),e.settingSprayLayer&&(o(e.settingSprayLayer,!0),Ae(e.settingSprayLayer)&&a(e.settingSprayLayer)),e.cushionLayer&&(o(e.cushionLayer,!1),Ae(e.cushionLayer)&&a(e.cushionLayer)),e.deformableFoundationLayers&&s(e.deformableFoundationLayers),e.browLayer&&(e=>{var r;let n=!1;e.fillOverlayParams&&e.fillOverlayParams.overlayImagePath&&e.fillOverlayParams.overlayImagePath.length>0&&(n=!0,t.push(new Se(e.fillOverlayParams.overlayImagePath,!1,!1))),e.overlayParams&&e.overlayParams.overlayImagePath&&e.overlayParams.overlayImagePath.length>0&&(n=!0,t.push(new Se(e.overlayParams.overlayImagePath,!1,!1))),(null===(r=e.coloringParams)||void 0===r?void 0:r.sparkleIntensity)>0&&t.push(...function(){const e=Te();return e.push(new Se("glitter/brow.png",!0,!0)),e}()),n&&t.push(new Se("white.png",!0,!0))})(e.browLayer),e.particleEffectsLayer&&("bubbles"===e.particleEffectsLayer.presetStyle?t.push(new Pe("bubbles.json",!0,"particles"),new Se("bubble1-1.4s.png",!1,!0,"particles"),new Se("bubble1-2s.png",!1,!0,"particles"),new Se("bubble1-3s.png",!1,!0,"particles"),new Se("bubble2-1.4s.png",!1,!0,"particles"),new Se("bubble2-2s.png",!1,!0,"particles"),new Se("bubble2-3s.png",!1,!0,"particles"),new Se("bubble3-1.4s.png",!1,!0,"particles"),new Se("bubble3-2s.png",!1,!0,"particles"),new Se("bubble3-3s.png",!1,!0,"particles")):"hearts"===e.particleEffectsLayer.presetStyle?t.push(new Pe("hearts.json",!0,"particles"),new Se("heart1.png",!1,!0,"particles"),new Se("heart2.png",!1,!0,"particles")):"stars"===e.particleEffectsLayer.presetStyle?t.push(new Pe("stars.json",!0,"particles"),new Se("star.png",!1,!0,"particles")):"custom"===e.particleEffectsLayer.presetStyle&&t.push(new Pe(e.particleEffectsLayer.effectJsonPath,!1,"particles"))),Fe(t)}(e).map((e=>{const t=new Map;return t.set("image",this.preloadImage.bind(this)),t.set("json",this.preloadJSON.bind(this)),{request:e,preloadHandler:t.get(e.loadHandlerType)}}));if(this.loadLookResourcesInParallel){const e=t.map((e=>e.preloadHandler(e.request)));yield Promise.all(e)}else{let e=Promise.resolve();t.forEach((t=>{e=e.then((()=>t.preloadHandler(t.request)))})),yield e}if(e.particleEffectsLayer&&"custom"===e.particleEffectsLayer.presetStyle){const t=function(e){const t=[];try{JSON.parse(e).animationImages.forEach((e=>{t.push(new Se(e.imagePath,!1,!1,"particles"))}))}catch(e){console.warn("Warning: Failed to parse custom particle effect")}return Fe(t)}(this.loadedJSONs.get(e.particleEffectsLayer.effectJsonPath).json);if(this.loadLookResourcesInParallel){const e=t.map((e=>this.preloadImage(e)));yield Promise.all(e)}else{let e=Promise.resolve();t.forEach((t=>{e=e.then((()=>this.preloadImage(t)))})),yield e}}}))}destroy(){this.module&&this.cameraArrayPtr&&this.module._free(this.cameraArrayPtr)}setLoadImageHandler(e){this.loadImageHandler=e}setLoadJSONHandler(e){this.loadJSONHandler=e}setEffectVisbility(e){this.effectVisibility=e,this.module&&this.module.cw_setEffectVisibility(e.lips,e.eyes,e.brows,e.cheeks)}setLook(e,t=!1){return De(this,void 0,void 0,(function*(){const r=Ce(e);(t||this.currentLookAfterJSON!==r)&&(this.currentLookAfter=fe(e),this.currentLookAfterJSON=r,yield this.preloadFilesForLook(this.currentLookAfter),this.module&&this.module.cw_setMakeupLookAfter(Ce(this.currentLookAfter)))}))}getLook(){return fe(this.currentLookAfter)}setLookBefore(e,t=!1){return De(this,void 0,void 0,(function*(){const r=Ce(e);(t||this.currentLookBeforeJSON!==r)&&(this.currentLookBefore=fe(e),this.currentLookBeforeJSON=r,yield this.preloadFilesForLook(this.currentLookBefore),this.module&&this.module.cw_setMakeupLookBefore(Ce(this.currentLookBefore)))}))}getLookBefore(){return fe(this.currentLookBefore)}setEnableComparisonMode(e){this.enableComparisonMode=e,this.module&&this.module.cw_setComparisonModeSettings(this.enableComparisonMode,this.comparisonPercent)}getEnableComparisonMode(){return this.enableComparisonMode}setComparisonPercent(e){this.comparisonPercent=e,this.module&&this.module.cw_setComparisonModeSettings(this.enableComparisonMode,this.comparisonPercent)}getComparisonPercent(){return this.comparisonPercent}setComparisonBarWidth(e){this.module&&this.module.cw_setComparisonBarWidth(e)}setComparisonBarColor(e,t,r){this.module&&this.module.cw_setComparisonBarColor(e,t,r)}setEnableFaceChart(e){this.enableFaceChart=e,this.module&&this.module.cw_setEnableFaceChart(e)}getEnableFaceChart(){return this.enableFaceChart}setTintEffect(e){var t;return De(this,void 0,void 0,(function*(){if(this.tintEffect=e,!this.module)return;let r=null!==(t=null==e?void 0:e.customLUTPath)&&void 0!==t?t:"";if(null==e?void 0:e.preset){let t=["none","rosie","dawn","dusk","cool","peachy","golden","sunkissed"].indexOf(e.preset);-1===t&&(t=0,this.log(`Warning: tint effect ${e} not found`));const n=this.module.cw_getTintImagePathForEffect(t);r=this.module.UTF8ToString(n),this.module._free(n)}yield this.lastTintUpdatePromise;const n=()=>De(this,void 0,void 0,(function*(){this.lastTintURL&&this.removeImageFromCache(this.lastTintURL),""!==r&&(yield this.preloadImage(new Se(r,!1,!0,"tints"))),this.module.cw_setTintEffectImagePath(r),this.lastTintURL=r}));this.lastTintUpdatePromise=this.lastTintUpdatePromise.then((()=>n())),yield this.lastTintUpdatePromise}))}getTintEffect(){return this.tintEffect}setQuality(e){this.quality=e,this.module&&this.module.cw_setQuality(this.quality)}getQuality(){return this.quality}setConvertOutputToNV12(e){this.convertOutputToNV12=e,this.module&&this.module.cw_setConvertOutputToNV12(e)}getConvertOutputToNV12(){return this.convertOutputToNV12}setEnableParallelTracking(e){this.enableParallelTracking=e,this.module&&this.module.cw_setEnableParallelTracking(e)}getEnableParallelTracking(){return this.enableParallelTracking}setFlipY(e){this.flipY=e,this.module&&this.module.cw_setFlipY(e)}getFlipY(){return this.flipY}setFaceTrackerData(e,t,r,n,o,a,i,s="unset"){const u={imageWidth:t,imageHeight:r,faceData:[{facePts:e,faceboxX:n,faceboxY:o,faceboxWidth:a,faceboxHeight:i,mouthOpenOverride:s}]};this.setMultiFaceTrackerData(u)}setMultiFaceTrackerData(e){if(this.module){if(!(null==e?void 0:e.faceData)||0===e.faceData.length)return void this.resetTrackerData();e.faceData.forEach(((t,r)=>{const n=W.serialize(t.facePts);this.module.cw_setFaceTrackerData(n,n.length,e.imageWidth,e.imageHeight,t.faceboxX,t.faceboxY,t.faceboxWidth,t.faceboxHeight,{unset:0,open:1,closed:2}[t.mouthOpenOverride],r,e.faceData.length)}))}}getIsMouthOpen(e=0){return!!this.module&&this.module.cw_getIsMouthOpen(e)}resetTrackerData(){this.module&&this.module.cw_resetTrackerData()}render(e,t,r){R(t*r*4===e.byteLength),this.module&&(this.allocateCameraBuffer(t,r),this.getCameraInputArray().set(e),this.module.cw_render(t,r,this.cameraArrayPtr,this.drawFacePoints,this.hideMakeup,this.getTimeSeconds()))}renderFromNV12Data(){this.module&&this.module.cw_renderFromNV12Data(this.drawFacePoints,this.hideMakeup,this.getTimeSeconds())}redraw(){this.module&&this.cameraArrayPtr&&this.module.cw_render(this.cameraWidth,this.cameraHeight,this.cameraArrayPtr,this.drawFacePoints,this.hideMakeup,this.getTimeSeconds())}resizeView(e,t){R(e>0&&t>0,"New view dimensions cannot be zero"),this.module&&this.module.cw_resizeView(e,t)}captureOutput(e=!1,t=!1){const{module:r}=this;if(!r)return null;const n=r._malloc(4),o=new Uint32Array(r.HEAPU32.buffer,n,1),a=r._malloc(4),i=new Uint32Array(r.HEAPU32.buffer,a,1),s=r._malloc(4),u=new Uint32Array(r.HEAPU32.buffer,s,1);this.module.cw_captureOutput(n,a,s,e?1:0,t?1:0);const l=o[0],c=i[0],h=u[0];let f=null;return l&&(f=new Uint8Array(r.HEAPU8.buffer,l,c*h*4).slice()),r.cw_freeCapturedOutput(),r._free(n),r._free(a),r._free(s),l?{buffer:f,width:c,height:h}:null}getCanvasBufferPixelData(){const{module:e}=this;if(!e)return null;const t=e._malloc(4),r=new Uint32Array(e.HEAPU32.buffer,t,1),n=e._malloc(4),o=new Uint32Array(e.HEAPU32.buffer,n,1),a=e._malloc(4),i=new Uint32Array(e.HEAPU32.buffer,a,1),s=e._malloc(4),u=new Uint32Array(e.HEAPU32.buffer,s,1);this.module.cw_getCanvasBufferPixelData(t,n,a,s);const l=r[0],c=o[0],h=i[0],f=u[0];let d=null;return l&&(d=new Uint8Array(e.HEAPU8.buffer,l,c).slice()),e._free(t),e._free(n),e._free(a),e._free(s),l?{buffer:d,width:h,height:f}:null}isFoundationCloseMatch(e=0,t=.06){return!!this.module&&this.module.cw_isFoundationCloseMatch(e,t)}useAndConvertNV12Input(e,t,r){this.allocateCameraBuffer(e.width,3*e.height/8),this.getCameraInputArray().set(e.buffer);const n=void 0!==t?t:e.width/4,o=void 0!==r?r:e.height/4;return this.module.cw_useAndConvertNV12Input(e.width,e.height,this.cameraArrayPtr,n,o),this.getConvertedNV12Output(n,o)}cropAndResizeConvertedNV12(e,t,r){const n=e?e.x:0,o=e?e.y:0,a=e?e.width:0,i=e?e.height:0;this.module.cw_cropResizeConvertedNV12(n,o,a,i,t,r);const s=this.module.cw_getCroppedConvertedNV12();return{buffer:new Uint8Array(this.module.HEAPU8.buffer,s,t*r*4),width:t,height:r}}getWebGLContext(){return this.glContext}useAndConvertNV12ImageBitmap(e,t,r){const{width:n,height:o}=e,a=void 0!==t?t:n/4,i=void 0!==r?r:o/4,s=this.module.cw_prepareAndBindNV12InputTexture(n,o),u=this.getWebGLContext();return s?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,e):u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,e),this.module.cw_processNV12InputTexture(n,o,a,i),this.getConvertedNV12Output(a,i)}getConvertedNV12Output(e,t){const r=this.module.cw_getDownsizedConvertedNV12();return{buffer:new Uint8Array(this.module.HEAPU8.buffer,r,e*t*4),width:e,height:t}}}var Ie,Re=(Ie="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,r=void 0!==(e=e||{})?e:{},n={};for(t in r)r.hasOwnProperty(t)&&(n[t]=r[t]);var o,a,i="./this.program",s="";s=self.location.href,Ie&&(s=Ie),s=0!==s.indexOf("blob:")?s.substr(0,s.lastIndexOf("/")+1):"",a=function(t){var r=new e.request;return r.open("GET",t,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)},o=function(t,r,n){var o=new e.request;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){200==o.status||0==o.status&&o.response?r(o.response):n()},o.onerror=n,o.send(null)};var u=r.print||console.log.bind(console),l=r.printErr||console.warn.bind(console);for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);function c(e){c.shown||(c.shown={}),c.shown[e]||(c.shown[e]=1,l(e))}n=null,r.arguments&&r.arguments,r.thisProgram&&(i=r.thisProgram),r.quit&&r.quit;var h,f,d={"f64-rem":function(e,t){return e%t},debugger:function(){}};new Array(0),r.wasmBinary&&(h=r.wasmBinary),r.noExitRuntime&&r.noExitRuntime,"object"!=typeof WebAssembly&&l("no native wasm support detected");var p=new WebAssembly.Table({initial:1368,maximum:1368,element:"anyfunc"}),m=!1;function g(e,t){e||$("Assertion failed: "+t)}function y(e){var t=r["_"+e];return g(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function v(e,t,r,n,o){var a={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);A(e,t=Ce(r),r)}return t},array:function(e){var t=Ce(e.length);return function(e,t){k.set(e,t)}(e,t),t}},i=y(e),s=[],u=0;if(n)for(var l=0;l<n.length;l++){var c=a[r[l]];c?(0===u&&(u=Me()),s[l]=c(n[l])):s[l]=n[l]}var h=i.apply(null,s);return h=function(e){return"string"===t?S(e):"boolean"===t?Boolean(e):e}(h),0!==u&&De(u),h}function _(e){return V?Le(e):function(e){var t=L[R>>2],r=t+e+15&-16;return L[R>>2]=r,t}(e)}var w,k,b,x,L,E,C,D="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function M(e,t,r){for(var n=t+r,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.subarray&&D)return D.decode(e.subarray(t,o));for(var a="";t<o;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)a+=String.fromCharCode(i);else{var l=i-65536;a+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else a+=String.fromCharCode((31&i)<<6|s)}else a+=String.fromCharCode(i)}return a}function S(e,t){return e?M(b,e,t):""}function P(e,t,r,n){if(!(n>0))return 0;for(var o=r,a=r+n-1,i=0;i<e.length;++i){var s=e.charCodeAt(i);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-o}function A(e,t,r){return P(e,b,t,r)}function T(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}function F(e,t,r){for(var n=0;n<e.length;++n)k[t++>>0]=e.charCodeAt(n);r||(k[t>>0]=0)}function O(e,t){return e%t>0&&(e+=t-e%t),e}function I(e){w=e,r.HEAP8=k=new Int8Array(e),r.HEAP16=new Int16Array(e),r.HEAP32=L=new Int32Array(e),r.HEAPU8=b=new Uint8Array(e),r.HEAPU16=x=new Uint16Array(e),r.HEAPU32=E=new Uint32Array(e),r.HEAPF32=C=new Float32Array(e),r.HEAPF64=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var R=216288,N=r.INITIAL_MEMORY||33554432;function j(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?r.dynCall_v(n):r.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t(r)}}(f=r.wasmMemory?r.wasmMemory:new WebAssembly.Memory({initial:N/65536,maximum:32768}))&&(w=f.buffer),N=w.byteLength,I(w),L[R>>2]=5459360;var B=[],z=[],W=[],H=[],V=!1,U=0,G=null;function q(e){U++,r.monitorRunDependencies&&r.monitorRunDependencies(U)}function Y(e){if(U--,r.monitorRunDependencies&&r.monitorRunDependencies(U),0==U&&G){var t=G;G=null,t()}}function $(e){throw r.onAbort&&r.onAbort(e),u(e+=""),l(e),m=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}r.preloadedImages={},r.preloadedAudios={};var J="data:application/octet-stream;base64,";function X(e){return String.prototype.startsWith?e.startsWith(J):0===e.indexOf(J)}var K,Z,Q="CoreSDK.wasm";function ee(){try{if(h)return new Uint8Array(h);if(a)return a(Q);throw"both async and sync fetching of the wasm failed"}catch(e){$(e)}}function te(e,t){if(ne.mainLoop.timingMode=e,ne.mainLoop.timingValue=t,!ne.mainLoop.func)return 1;if(0==e)ne.mainLoop.scheduler=function(){var e=0|Math.max(0,ne.mainLoop.tickStartTime+t-Z());setTimeout(ne.mainLoop.runner,e)},ne.mainLoop.method="timeout";else if(1==e)ne.mainLoop.scheduler=function(){ne.requestAnimationFrame(ne.mainLoop.runner)},ne.mainLoop.method="rAF";else if(2==e){if("undefined"==typeof setImmediate){var n=[],o="setimmediate";addEventListener("message",(function(e){e.data!==o&&e.data.target!==o||(e.stopPropagation(),n.shift()())}),!0),setImmediate=function(e){n.push(e),void 0===r.setImmediates&&(r.setImmediates=[]),r.setImmediates.push(e),postMessage({target:o})}}ne.mainLoop.scheduler=function(){setImmediate(ne.mainLoop.runner)},ne.mainLoop.method="immediate"}return 0}X(Q)||(K=Q,Q=r.locateFile?r.locateFile(K,s):s+K),r.asm=function(){var e={env:de,wasi_snapshot_preview1:de,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:d};function t(e,t){var n=e.exports;r.asm=n,Y()}function n(e){t(e.instance)}function o(t){return(h||"function"!=typeof fetch?new Promise((function(e,t){e(ee())})):fetch(Q,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Q+"'";return e.arrayBuffer()})).catch((function(){return ee()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){l("failed to asynchronously prepare wasm: "+e),$(e)}))}if(q(),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return l("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(h||"function"!=typeof WebAssembly.instantiateStreaming||X(Q)||"function"!=typeof fetch)return o(n);fetch(Q,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){l("wasm streaming compile failed: "+e),l("falling back to ArrayBuffer instantiation"),o(n)}))}))}(),{}},z.push({func:function(){_e()}},{func:function(){ye()}},{func:function(){me()}},{func:function(){ge()}},{func:function(){ve()}},{func:function(){we()}},{func:function(){ke()}},{func:function(){be()}}),Z=function(){return performance.now()};var re,ne={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){ne.mainLoop.scheduler=null,ne.mainLoop.currentlyRunningMainloop++},resume:function(){ne.mainLoop.currentlyRunningMainloop++;var e=ne.mainLoop.timingMode,t=ne.mainLoop.timingValue,n=ne.mainLoop.func;ne.mainLoop.func=null,function(e,t,n,o,a){var i;g(!ne.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),ne.mainLoop.func=e,ne.mainLoop.arg=o,i=void 0!==o?function(){r.dynCall_vi(e,o)}:function(){r.dynCall_v(e)};var s=ne.mainLoop.currentlyRunningMainloop;if(ne.mainLoop.runner=function(){if(!m)if(ne.mainLoop.queue.length>0){var e=Date.now(),t=ne.mainLoop.queue.shift();if(t.func(t.arg),ne.mainLoop.remainingBlockers){var r=ne.mainLoop.remainingBlockers,n=r%1==0?r-1:Math.floor(r);t.counted?ne.mainLoop.remainingBlockers=n:(n+=.5,ne.mainLoop.remainingBlockers=(8*r+n)/9)}if(console.log('main loop blocker "'+t.name+'" took '+(Date.now()-e)+" ms"),ne.mainLoop.updateStatus(),s<ne.mainLoop.currentlyRunningMainloop)return;setTimeout(ne.mainLoop.runner,0)}else s<ne.mainLoop.currentlyRunningMainloop||(ne.mainLoop.currentFrameNumber=ne.mainLoop.currentFrameNumber+1|0,1==ne.mainLoop.timingMode&&ne.mainLoop.timingValue>1&&ne.mainLoop.currentFrameNumber%ne.mainLoop.timingValue!=0?ne.mainLoop.scheduler():(0==ne.mainLoop.timingMode&&(ne.mainLoop.tickStartTime=Z()),ne.mainLoop.runIter(i),s<ne.mainLoop.currentlyRunningMainloop||("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),ne.mainLoop.scheduler())))},a||(t&&t>0?te(0,1e3/t):te(1,1),ne.mainLoop.scheduler()),n)throw"unwind"}(n,0,!1,ne.mainLoop.arg,!0),te(e,t),ne.mainLoop.scheduler()},updateStatus:function(){if(r.setStatus){var e=r.statusMessage||"Please wait...",t=ne.mainLoop.remainingBlockers,n=ne.mainLoop.expectedBlockers;t?t<n?r.setStatus(e+" ("+(n-t)+"/"+n+")"):r.setStatus(e):r.setStatus("")}},runIter:function(e){if(!m){if(r.preMainLoop&&!1===r.preMainLoop())return;try{e()}catch(e){if(e instanceof Se)return;throw e&&"object"==typeof e&&e.stack&&l("exception thrown: "+[e,e.stack]),e}r.postMainLoop&&r.postMainLoop()}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(r.preloadPlugins||(r.preloadPlugins=[]),!ne.initted){ne.initted=!0;try{new Blob,ne.hasBlobConstructor=!0}catch(e){ne.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}ne.BlobBuilder="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:ne.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),ne.URLObject="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,r.noImageDecoding||void 0!==ne.URLObject||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),r.noImageDecoding=!0);var e={canHandle:function(e){return!r.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,n,o){var a=null;if(ne.hasBlobConstructor)try{(a=new Blob([e],{type:ne.getMimetype(t)})).size!==e.length&&(a=new Blob([new Uint8Array(e).buffer],{type:ne.getMimetype(t)}))}catch(e){c("Blob constructor present but fails: "+e+"; falling back to blob builder")}if(!a){var i=new ne.BlobBuilder;i.append(new Uint8Array(e).buffer),a=i.getBlob()}var s=ne.URLObject.createObjectURL(a),u=new Image;u.onload=function(){g(u.complete,"Image "+t+" could not be decoded");var o=document.createElement("canvas");o.width=u.width,o.height=u.height,o.getContext("2d").drawImage(u,0,0),r.preloadedImages[t]=o,ne.URLObject.revokeObjectURL(s),n&&n(e)},u.onerror=function(e){console.log("Image "+s+" could not be decoded"),o&&o()},u.src=s}};r.preloadPlugins.push(e);var t={canHandle:function(e){return!r.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,n,o){var a=!1;function i(o){a||(a=!0,r.preloadedAudios[t]=o,n&&n(e))}function s(){a||(a=!0,r.preloadedAudios[t]=new Audio,o&&o())}if(!ne.hasBlobConstructor)return s();try{var u=new Blob([e],{type:ne.getMimetype(t)})}catch(e){return s()}var l=ne.URLObject.createObjectURL(u),c=new Audio;c.addEventListener("canplaythrough",(function(){i(c)}),!1),c.onerror=function(r){a||(console.log("warning: browser could not fully decode audio "+t+", trying slower base64 approach"),c.src="data:audio/x-"+t.substr(-3)+";base64,"+function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",n=0,o=0,a=0;a<e.length;a++)for(n=n<<8|e[a],o+=8;o>=6;){var i=n>>o-6&63;o-=6,r+=t[i]}return 2==o?(r+=t[(3&n)<<4],r+="=="):4==o&&(r+=t[(15&n)<<2],r+="="),r}(e),i(c))},c.src=l,ne.safeSetTimeout((function(){i(c)}),1e4)}};r.preloadPlugins.push(t);var n=r.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||function(){},n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),document.addEventListener("webkitpointerlockchange",o,!1),document.addEventListener("mspointerlockchange",o,!1),r.elementPointerLock&&n.addEventListener("click",(function(e){!ne.pointerLock&&r.canvas.requestPointerLock&&(r.canvas.requestPointerLock(),e.preventDefault())}),!1))}function o(){ne.pointerLock=document.pointerLockElement===r.canvas||document.mozPointerLockElement===r.canvas||document.webkitPointerLockElement===r.canvas||document.msPointerLockElement===r.canvas}},createContext:function(e,t,n,o){if(t&&r.ctx&&e==r.canvas)return r.ctx;var a,i;if(t){var s={antialias:!1,alpha:!1,majorVersion:1};if(o)for(var u in o)s[u]=o[u];void 0!==se&&(i=se.createContext(e,s))&&(a=se.getContext(i).GLctx)}else a=e.getContext("2d");return a?(n&&(t||g(void 0===re,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),r.ctx=a,t&&se.makeContextCurrent(i),r.useWebGL=t,ne.moduleContextCreatedCallbacks.forEach((function(e){e()})),ne.init()),a):null},destroyContext:function(e,t,r){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen:function(e,t){ne.lockPointer=e,ne.resizeCanvas=t,void 0===ne.lockPointer&&(ne.lockPointer=!0),void 0===ne.resizeCanvas&&(ne.resizeCanvas=!1);var n=r.canvas;function o(){ne.isFullscreen=!1;var e=n.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(n.exitFullscreen=ne.exitFullscreen,ne.lockPointer&&n.requestPointerLock(),ne.isFullscreen=!0,ne.resizeCanvas?ne.setFullscreenCanvasSize():ne.updateCanvasDimensions(n)):(e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e),ne.resizeCanvas?ne.setWindowedCanvasSize():ne.updateCanvasDimensions(n)),r.onFullScreen&&r.onFullScreen(ne.isFullscreen),r.onFullscreen&&r.onFullscreen(ne.isFullscreen)}ne.fullscreenHandlersInstalled||(ne.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",o,!1),document.addEventListener("mozfullscreenchange",o,!1),document.addEventListener("webkitfullscreenchange",o,!1),document.addEventListener("MSFullscreenChange",o,!1));var a=document.createElement("div");n.parentNode.insertBefore(a,n),a.appendChild(n),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?function(){a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(a.webkitRequestFullScreen?function(){a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),a.requestFullscreen()},exitFullscreen:function(){return!!ne.isFullscreen&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===ne.nextRAF)ne.nextRAF=t+1e3/60;else for(;t+2>=ne.nextRAF;)ne.nextRAF+=1e3/60;var r=Math.max(ne.nextRAF-t,0);setTimeout(e,r)},requestAnimationFrame:function(e){"function"!=typeof requestAnimationFrame?(0,ne.fakeRequestAnimationFrame)(e):requestAnimationFrame(e)},safeCallback:function(e){return function(){if(!m)return e.apply(null,arguments)}},allowAsyncCallbacks:!0,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){ne.allowAsyncCallbacks=!1},resumeAsyncCallbacks:function(){if(ne.allowAsyncCallbacks=!0,ne.queuedAsyncCallbacks.length>0){var e=ne.queuedAsyncCallbacks;ne.queuedAsyncCallbacks=[],e.forEach((function(e){e()}))}},safeRequestAnimationFrame:function(e){return ne.requestAnimationFrame((function(){m||(ne.allowAsyncCallbacks?e():ne.queuedAsyncCallbacks.push(e))}))},safeSetTimeout:function(e,t){return setTimeout((function(){m||(ne.allowAsyncCallbacks?e():ne.queuedAsyncCallbacks.push(e))}),t)},safeSetInterval:function(e,t){return setInterval((function(){m||ne.allowAsyncCallbacks&&e()}),t)},getMimetype:function(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail/3;break;case"mousewheel":t=e.wheelDelta/120;break;case"wheel":switch(t=e.deltaY,e.deltaMode){case 0:t/=100;break;case 1:t/=3;break;case 2:t*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(e){if(ne.pointerLock)"mousemove"!=e.type&&"mozMovementX"in e?ne.mouseMovementX=ne.mouseMovementY=0:(ne.mouseMovementX=ne.getMovementX(e),ne.mouseMovementY=ne.getMovementY(e)),"undefined"!=typeof SDL?(ne.mouseX=SDL.mouseX+ne.mouseMovementX,ne.mouseY=SDL.mouseY+ne.mouseMovementY):(ne.mouseX+=ne.mouseMovementX,ne.mouseY+=ne.mouseMovementY);else{var t=r.canvas.getBoundingClientRect(),n=r.canvas.width,o=r.canvas.height,a=void 0!==window.scrollX?window.scrollX:window.pageXOffset,i=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type){var s=e.touch;if(void 0===s)return;var u=s.pageX-(a+t.left),l=s.pageY-(i+t.top),c={x:u*=n/t.width,y:l*=o/t.height};if("touchstart"===e.type)ne.lastTouches[s.identifier]=c,ne.touches[s.identifier]=c;else if("touchend"===e.type||"touchmove"===e.type){var h=ne.touches[s.identifier];h||(h=c),ne.lastTouches[s.identifier]=h,ne.touches[s.identifier]=c}return}var f=e.pageX-(a+t.left),d=e.pageY-(i+t.top);f*=n/t.width,d*=o/t.height,ne.mouseMovementX=f-ne.mouseX,ne.mouseMovementY=d-ne.mouseY,ne.mouseX=f,ne.mouseY=d}},asyncLoad:function(e,t,r,n){var a=n?"":"al "+e;o(e,(function(r){g(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),a&&Y()}),(function(t){if(!r)throw'Loading data file "'+e+'" failed.';r()})),a&&q()},resizeListeners:[],updateResizeListeners:function(){var e=r.canvas;ne.resizeListeners.forEach((function(t){t(e.width,e.height)}))},setCanvasSize:function(e,t,n){var o=r.canvas;ne.updateCanvasDimensions(o,e,t),n||ne.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if("undefined"!=typeof SDL){var e=E[SDL.screen>>2];e|=8388608,L[SDL.screen>>2]=e}ne.updateCanvasDimensions(r.canvas),ne.updateResizeListeners()},setWindowedCanvasSize:function(){if("undefined"!=typeof SDL){var e=E[SDL.screen>>2];e&=-8388609,L[SDL.screen>>2]=e}ne.updateCanvasDimensions(r.canvas),ne.updateResizeListeners()},updateCanvasDimensions:function(e,t,n){t&&n?(e.widthNative=t,e.heightNative=n):(t=e.widthNative,n=e.heightNative);var o=t,a=n;if(r.forcedAspectRatio&&r.forcedAspectRatio>0&&(o/a<r.forcedAspectRatio?o=Math.round(a*r.forcedAspectRatio):a=Math.round(o/r.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var i=Math.min(screen.width/o,screen.height/a);o=Math.round(o*i),a=Math.round(a*i)}ne.resizeCanvas?(e.width!=o&&(e.width=o),e.height!=a&&(e.height=a),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=t&&(e.width=t),e.height!=n&&(e.height=n),void 0!==e.style&&(o!=t||a!=n?(e.style.setProperty("width",o+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var e=ne.nextWgetRequestHandle;return ne.nextWgetRequestHandle++,e}},oe={},ae={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=ae.buffers[e];0===t||10===t?((1===e?u:l)(M(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return ae.varargs+=4,L[ae.varargs-4>>2]},getStr:function(e){return S(e)},get64:function(e,t){return e}},ie={errorCode:12288,defaultDisplayInitialized:!1,currentContext:0,currentReadSurface:0,currentDrawSurface:0,contextAttributes:{alpha:!1,depth:!1,stencil:!1,antialias:!1},stringCache:{},setErrorCode:function(e){ie.errorCode=e},chooseConfig:function(e,t,r,n,o){if(62e3!=e)return ie.setErrorCode(12296),0;if(t)for(;;){var a=L[t>>2];if(12321==a){var i=L[t+4>>2];ie.contextAttributes.alpha=i>0}else if(12325==a){var s=L[t+4>>2];ie.contextAttributes.depth=s>0}else if(12326==a){var u=L[t+4>>2];ie.contextAttributes.stencil=u>0}else if(12337==a){var l=L[t+4>>2];ie.contextAttributes.antialias=l>0}else if(12338==a)l=L[t+4>>2],ie.contextAttributes.antialias=1==l;else if(12544==a){var c=L[t+4>>2];ie.contextAttributes.lowLatency=12547!=c}else if(12344==a)break;t+=8}return r&&n||o?(o&&(L[o>>2]=1),r&&n>0&&(L[r>>2]=62002),ie.setErrorCode(12288),1):(ie.setErrorCode(12300),0)}},se={counter:1,lastError:0,buffers:[],mappedBuffers:{},programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:[],currentContext:null,offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,init:function(){for(var e=new Float32Array(se.MINI_TEMP_BUFFER_SIZE),t=0;t<se.MINI_TEMP_BUFFER_SIZE;t++)se.miniTempBufferFloatViews[t]=e.subarray(0,t+1);var r=new Int32Array(se.MINI_TEMP_BUFFER_SIZE);for(t=0;t<se.MINI_TEMP_BUFFER_SIZE;t++)se.miniTempBufferIntViews[t]=r.subarray(0,t+1)},recordError:function(e){se.lastError||(se.lastError=e)},getNewId:function(e){for(var t=se.counter++,r=e.length;r<t;r++)e[r]=null;return t},MINI_TEMP_BUFFER_SIZE:256,miniTempBufferFloatViews:[0],miniTempBufferIntViews:[0],getSource:function(e,t,r,n){for(var o="",a=0;a<t;++a){var i=n?L[n+4*a>>2]:-1;o+=S(L[r+4*a>>2],i<0?void 0:i)}return o},createContext:function(e,t){var r=e.getContext("webgl",t);return r?se.registerContext(r,t):0},registerContext:function(e,t){var r=se.getNewId(se.contexts),n={handle:r,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),se.contexts[r]=n,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&se.initExtensions(n),r},makeContextCurrent:function(e){return se.currentContext=se.contexts[e],r.ctx=re=se.currentContext&&se.currentContext.GLctx,!(e&&!re)},getContext:function(e){return se.contexts[e]},deleteContext:function(e){se.currentContext===se.contexts[e]&&(se.currentContext=null),"object"==typeof JSEvents&&JSEvents.removeAllHandlersOnTarget(se.contexts[e].GLctx.canvas),se.contexts[e]&&se.contexts[e].GLctx.canvas&&(se.contexts[e].GLctx.canvas.GLctxObject=void 0),se.contexts[e]=null},initExtensions:function(e){if(e||(e=se.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t,r,n=e.GLctx;e.version<2&&((r=(t=n).getExtension("ANGLE_instanced_arrays"))&&(t.vertexAttribDivisor=function(e,t){r.vertexAttribDivisorANGLE(e,t)},t.drawArraysInstanced=function(e,t,n,o){r.drawArraysInstancedANGLE(e,t,n,o)},t.drawElementsInstanced=function(e,t,n,o,a){r.drawElementsInstancedANGLE(e,t,n,o,a)}),function(e){var t=e.getExtension("OES_vertex_array_object");t&&(e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)})}(n),function(e){var t=e.getExtension("WEBGL_draw_buffers");t&&(e.drawBuffers=function(e,r){t.drawBuffersWEBGL(e,r)})}(n)),n.disjointTimerQueryExt=n.getExtension("EXT_disjoint_timer_query");var o=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(n.getSupportedExtensions()||[]).forEach((function(e){-1!=o.indexOf(e)&&n.getExtension(e)}))}},populateUniformTable:function(e){for(var t=se.programs[e],r=se.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},n=r.uniforms,o=re.getProgramParameter(t,35718),a=0;a<o;++a){var i=re.getActiveUniform(t,a),s=i.name;r.maxUniformLength=Math.max(r.maxUniformLength,s.length+1),"]"==s.slice(-1)&&(s=s.slice(0,s.lastIndexOf("[")));var u=re.getUniformLocation(t,s);if(u){var l=se.getNewId(se.uniforms);n[s]=[i.size,l],se.uniforms[l]=u;for(var c=1;c<i.size;++c){var h=s+"["+c+"]";u=re.getUniformLocation(t,h),l=se.getNewId(se.uniforms),se.uniforms[l]=u}}}}};function ue(){return b.length}function le(e){try{return f.grow(e-w.byteLength+65535>>>16),I(f.buffer),1}catch(e){}}function ce(e,t,r,n){for(var o=0;o<e;o++){var a=re[r](),i=a&&se.getNewId(n);a?(a.name=i,n[i]=a):se.recordError(1282),L[t+4*o>>2]=i}}function he(e){var t=T(e)+1,r=Le(t);return A(e,r,t),r}function fe(e,t,r,n,o,a){var i=function(e){return 1==(e-=5120)?b:4==e?L:6==e?C:5==e||28922==e?E:x}(e),s=function(e){return 31-Math.clz32(e.BYTES_PER_ELEMENT)}(i),u=1<<s,l=function(e){return{5:3,6:4,8:2,29502:3,29504:4}[e-6402]||1}(t)*u,c=function(e,t,r,n){var o=function(e,t){return e+t-1&-t}(e*r,n);return t*o}(r,n,l,se.unpackAlignment);return i.subarray(o>>s,o+c>>s)}r.requestFullscreen=function(e,t){ne.requestFullscreen(e,t)},r.requestAnimationFrame=function(e){ne.requestAnimationFrame(e)},r.setCanvasSize=function(e,t,r){ne.setCanvasSize(e,t,r)},r.pauseMainLoop=function(){ne.mainLoop.pause()},r.resumeMainLoop=function(){ne.mainLoop.resume()},r.getUserMedia=function(){ne.getUserMedia()},r.createContext=function(e,t,r,n){return ne.createContext(e,t,r,n)},se.init();var de={La:function(){},Ba:function(e,t,r,n,o,a,i,s,u,l,c,h){return ne.setCanvasSize(o,a),2},va:function(e,t,r){return 0},ra:function(){},ka:function(){return 1},ga:function(){},$:function(){},Z:function(){},m:function(e,t,r,n){$("Assertion failed: "+S(e)+", at: "+[t?S(t):"unknown filename",r,n?S(n):"unknown function"])},Ka:function e(t){var r,n;e.called?(n=L[t>>2],r=L[n>>2]):(e.called=!0,oe.USER="web_user",oe.LOGNAME="web_user",oe.PATH="/",oe.PWD="/",oe.HOME="/home/web_user",oe.LANG=("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",oe._=i||"./this.program",r=_(1024),n=_(256),L[n>>2]=r,L[t>>2]=n);var o=[],a=0;for(var s in oe)if("string"==typeof oe[s]){var u=s+"="+oe[s];o.push(u),a+=u.length}if(a>1024)throw new Error("Environment size exceeded TOTAL_ENV_SIZE!");for(var l=0;l<o.length;l++)F(u=o[l],r),L[n+4*l>>2]=r,r+=u.length+1;L[n+4*o.length>>2]=0},Ja:function(e){return 0},T:function(e,t,r,n,o){},Ia:function(e,t,r,n){return function(e,t,r,n){for(var o=0,a=0;a<r;a++){for(var i=L[t+8*a>>2],s=L[t+(8*a+4)>>2],u=0;u<s;u++)ae.printChar(e,b[i+u]);o+=s}return L[n>>2]=o,0}(e,t,r,n)},__memory_base:1024,__table_base:0,a:function(){$()},Ha:function(e,t){var n,o;if(0===e)n=Date.now();else{if(1!==e&&4!==e)return o=28,r.___errno_location&&(L[r.___errno_location()>>2]=o),-1;n=Z()}return L[t>>2]=n/1e3|0,L[t+4>>2]=n%1e3*1e3*1e3|0,0},Ga:function(e,t,r,n,o){return ie.chooseConfig(e,t,r,n,o)},Fa:function(e,t,n,o){if(62e3!=e)return ie.setErrorCode(12296),0;for(var a=1;;){var i=L[o>>2];if(12440!=i){if(12344==i)break;return ie.setErrorCode(12292),0}a=L[o+4>>2],o+=8}return 2!=a?(ie.setErrorCode(12293),0):(ie.contextAttributes.majorVersion=a-1,ie.contextAttributes.minorVersion=0,ie.context=se.createContext(r.canvas,ie.contextAttributes),0!=ie.context?(ie.setErrorCode(12288),se.makeContextCurrent(ie.context),r.useWebGL=!0,ne.moduleContextCreatedCallbacks.forEach((function(e){e()})),se.makeContextCurrent(null),62004):(ie.setErrorCode(12297),0))},Ea:function(e,t,r,n){return 62e3!=e?(ie.setErrorCode(12296),0):62002!=t?(ie.setErrorCode(12293),0):(ie.setErrorCode(12288),62006)},Da:function(e,t,r,n){return ie.chooseConfig(e,0,t,r,n)},Ca:function(e){return ie.setErrorCode(12288),62e3},Aa:function(e,t,r){return 62e3==e?(t&&(L[t>>2]=1),r&&(L[r>>2]=4),ie.defaultDisplayInitialized=!0,ie.setErrorCode(12288),1):(ie.setErrorCode(12296),0)},za:function(e,t,r,n){return 62e3!=e?(ie.setErrorCode(12296),0):0!=n&&62004!=n?(ie.setErrorCode(12294),0):0!=r&&62006!=r||0!=t&&62006!=t?(ie.setErrorCode(12301),0):(se.makeContextCurrent(n?ie.context:null),ie.currentContext=n,ie.currentDrawSurface=t,ie.currentReadSurface=r,ie.setErrorCode(12288),1)},ya:ue,xa:function(e,t,r){b.copyWithin(e,t,t+r)},wa:function(e){var t=ue(),r=2147483648;if(e>r)return!1;for(var n=1;n<=4;n*=2){var o=t*(1+.2/n);if(o=Math.min(o,e+100663296),le(Math.min(r,O(Math.max(16777216,e,o),65536))))return!0}return!1},S:function e(t){return 0===t?0:(t=S(t),oe.hasOwnProperty(t)?(e.ret&&xe(e.ret),e.ret=(r=oe[t],n=T(r)+1,(o=Le(n))&&P(r,k,o,n),o)):0);var r,n,o},d:function(e){re.activeTexture(e)},R:function(e,t){re.attachShader(se.programs[e],se.shaders[t])},Q:function(e,t,r){re.bindAttribLocation(se.programs[e],t,S(r))},b:function(e,t){re.bindBuffer(e,se.buffers[t])},E:function(e,t){re.bindFramebuffer(e,se.framebuffers[t])},v:function(e,t){re.bindTexture(e,se.textures[t])},l:function(e,t){re.blendFunc(e,t)},P:function(e,t,r,n){re.bufferData(e,r?b.subarray(r,r+t):t,n)},O:function(e,t,r,n){re.bufferSubData(e,t,b.subarray(n,n+r))},ua:function(e){return re.checkFramebufferStatus(e)},x:function(e){re.clear(e)},z:function(e,t,r,n){re.clearColor(e,t,r,n)},ta:function(e){re.compileShader(se.shaders[e])},sa:function(){var e=se.getNewId(se.programs),t=re.createProgram();return t.name=e,se.programs[e]=t,e},qa:function(e){var t=se.getNewId(se.shaders);return se.shaders[t]=re.createShader(e),t},pa:function(e,t){for(var r=0;r<e;r++){var n=L[t+4*r>>2],o=se.buffers[n];o&&(re.deleteBuffer(o),o.name=0,se.buffers[n]=null,n==se.currArrayBuffer&&(se.currArrayBuffer=0),n==se.currElementArrayBuffer&&(se.currElementArrayBuffer=0))}},oa:function(e,t){for(var r=0;r<e;++r){var n=L[t+4*r>>2],o=se.framebuffers[n];o&&(re.deleteFramebuffer(o),o.name=0,se.framebuffers[n]=null)}},na:function(e){if(e){var t=se.programs[e];t?(re.deleteProgram(t),t.name=0,se.programs[e]=null,se.programInfos[e]=null):se.recordError(1281)}},ma:function(e,t){for(var r=0;r<e;r++){var n=L[t+4*r>>2],o=se.renderbuffers[n];o&&(re.deleteRenderbuffer(o),o.name=0,se.renderbuffers[n]=null)}},N:function(e){if(e){var t=se.shaders[e];t?(re.deleteShader(t),se.shaders[e]=null):se.recordError(1281)}},la:function(e,t){for(var r=0;r<e;r++){var n=L[t+4*r>>2],o=se.textures[n];o&&(re.deleteTexture(o),o.name=0,se.textures[n]=null)}},p:function(e){re.disable(e)},f:function(e){re.disableVertexAttribArray(e)},M:function(e,t,r){re.drawArrays(e,t,r)},j:function(e,t,r,n){re.drawElements(e,t,r,n)},o:function(e){re.enable(e)},h:function(e){re.enableVertexAttribArray(e)},A:function(e,t,r,n,o){re.framebufferTexture2D(e,t,r,se.textures[n],o)},L:function(e,t){ce(e,t,"createBuffer",se.buffers)},K:function(e,t){ce(e,t,"createFramebuffer",se.framebuffers)},ja:function(e,t){ce(e,t,"createTexture",se.textures)},C:function(e){re.generateMipmap(e)},ia:function(e,t){return re.getAttribLocation(se.programs[e],S(t))},ha:function(){var e=re.getError()||se.lastError;return se.lastError=0,e},fa:function(e,t,r,n){var o=re.getProgramInfoLog(se.programs[e]);null===o&&(o="(unknown error)");var a=t>0&&n?A(o,n,t):0;r&&(L[r>>2]=a)},J:function(e,t,r){if(r)if(e>=se.counter)se.recordError(1281);else{var n=se.programInfos[e];if(n)if(35716==t){var o=re.getProgramInfoLog(se.programs[e]);null===o&&(o="(unknown error)"),L[r>>2]=o.length+1}else if(35719==t)L[r>>2]=n.maxUniformLength;else if(35722==t){if(-1==n.maxAttributeLength){e=se.programs[e];var a=re.getProgramParameter(e,35721);n.maxAttributeLength=0;for(var i=0;i<a;++i){var s=re.getActiveAttrib(e,i);n.maxAttributeLength=Math.max(n.maxAttributeLength,s.name.length+1)}}L[r>>2]=n.maxAttributeLength}else if(35381==t){if(-1==n.maxUniformBlockNameLength){e=se.programs[e];var u=re.getProgramParameter(e,35382);for(n.maxUniformBlockNameLength=0,i=0;i<u;++i){var l=re.getActiveUniformBlockName(e,i);n.maxUniformBlockNameLength=Math.max(n.maxUniformBlockNameLength,l.length+1)}}L[r>>2]=n.maxUniformBlockNameLength}else L[r>>2]=re.getProgramParameter(se.programs[e],t);else se.recordError(1282)}else se.recordError(1281)},ea:function(e,t,r,n){var o=re.getShaderInfoLog(se.shaders[e]);null===o&&(o="(unknown error)");var a=t>0&&n?A(o,n,t):0;r&&(L[r>>2]=a)},I:function(e,t,r){if(r)if(35716==t){var n=re.getShaderInfoLog(se.shaders[e]);null===n&&(n="(unknown error)"),L[r>>2]=n.length+1}else if(35720==t){var o=re.getShaderSource(se.shaders[e]),a=null===o||0==o.length?0:o.length+1;L[r>>2]=a}else L[r>>2]=re.getShaderParameter(se.shaders[e],t);else se.recordError(1281)},H:function(e){if(se.stringCache[e])return se.stringCache[e];var t;switch(e){case 7939:var r=re.getSupportedExtensions()||[];r=r.concat(r.map((function(e){return"GL_"+e}))),t=he(r.join(" "));break;case 7936:case 7937:case 37445:case 37446:var n=re.getParameter(e);n||se.recordError(1280),t=he(n);break;case 7938:var o=re.getParameter(7938);t=he(o="OpenGL ES 2.0 ("+o+")");break;case 35724:var a=re.getParameter(35724),i=a.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==i&&(3==i[1].length&&(i[1]=i[1]+"0"),a="OpenGL ES GLSL ES "+i[1]+" ("+a+")"),t=he(a);break;default:return se.recordError(1280),0}return se.stringCache[e]=t,t},da:function(e,t){var r,n=0;if("]"==(t=S(t))[t.length-1]){var o=t.lastIndexOf("[");n="]"!=t[o+1]?(r=t.slice(o+1),parseInt(r)):0,t=t.slice(0,o)}var a=se.programInfos[e]&&se.programInfos[e].uniforms[t];return a&&n>=0&&n<a[0]?a[1]+n:-1},ca:function(e){re.linkProgram(se.programs[e]),se.populateUniformTable(e)},w:function(e,t){3317==e&&(se.unpackAlignment=t),re.pixelStorei(e,t)},ba:function(e,t,r,n,o,a,i){var s=fe(a,o,r,n,i);s?re.readPixels(e,t,r,n,o,a,s):se.recordError(1280)},aa:function(e,t,r,n){var o=se.getSource(e,t,r,n);re.shaderSource(se.shaders[e],o)},y:function(e,t,r,n,o,a,i,s,u){re.texImage2D(e,t,r,n,o,a,i,s,u?fe(s,i,n,o,u):null)},s:function(e,t,r){re.texParameteri(e,t,r)},G:function(e,t,r,n,o,a,i,s,u){var l=null;u&&(l=fe(s,i,o,a,u)),re.texSubImage2D(e,t,r,n,o,a,i,s,l)},c:function(e,t){re.uniform1f(se.uniforms[e],t)},_:function(e,t,r){if(t<=se.MINI_TEMP_BUFFER_SIZE)for(var n=se.miniTempBufferFloatViews[t-1],o=0;o<t;++o)n[o]=C[r+4*o>>2];else n=C.subarray(r>>2,r+4*t>>2);re.uniform1fv(se.uniforms[e],n)},e:function(e,t){re.uniform1i(se.uniforms[e],t)},t:function(e,t,r){re.uniform2f(se.uniforms[e],t,r)},r:function(e,t,r){if(2*t<=se.MINI_TEMP_BUFFER_SIZE)for(var n=se.miniTempBufferFloatViews[2*t-1],o=0;o<2*t;o+=2)n[o]=C[r+4*o>>2],n[o+1]=C[r+(4*o+4)>>2];else n=C.subarray(r>>2,r+8*t>>2);re.uniform2fv(se.uniforms[e],n)},q:function(e,t,r,n){re.uniform3f(se.uniforms[e],t,r,n)},n:function(e,t,r,n,o){re.uniform4f(se.uniforms[e],t,r,n,o)},u:function(e,t,r,n){if(9*t<=se.MINI_TEMP_BUFFER_SIZE)for(var o=se.miniTempBufferFloatViews[9*t-1],a=0;a<9*t;a+=9)o[a]=C[n+4*a>>2],o[a+1]=C[n+(4*a+4)>>2],o[a+2]=C[n+(4*a+8)>>2],o[a+3]=C[n+(4*a+12)>>2],o[a+4]=C[n+(4*a+16)>>2],o[a+5]=C[n+(4*a+20)>>2],o[a+6]=C[n+(4*a+24)>>2],o[a+7]=C[n+(4*a+28)>>2],o[a+8]=C[n+(4*a+32)>>2];else o=C.subarray(n>>2,n+36*t>>2);re.uniformMatrix3fv(se.uniforms[e],!!r,o)},i:function(e,t,r,n){if(16*t<=se.MINI_TEMP_BUFFER_SIZE){var o=se.miniTempBufferFloatViews[16*t-1],a=C;n>>=2;for(var i=0;i<16*t;i+=16){var s=n+i;o[i]=a[s],o[i+1]=a[s+1],o[i+2]=a[s+2],o[i+3]=a[s+3],o[i+4]=a[s+4],o[i+5]=a[s+5],o[i+6]=a[s+6],o[i+7]=a[s+7],o[i+8]=a[s+8],o[i+9]=a[s+9],o[i+10]=a[s+10],o[i+11]=a[s+11],o[i+12]=a[s+12],o[i+13]=a[s+13],o[i+14]=a[s+14],o[i+15]=a[s+15]}}else o=C.subarray(n>>2,n+64*t>>2);re.uniformMatrix4fv(se.uniforms[e],!!r,o)},Y:function(e){re.useProgram(se.programs[e])},F:function(e,t){re.vertexAttrib1f(e,t)},B:function(e,t,r,n){re.vertexAttrib3f(e,t,r,n)},g:function(e,t,r,n,o,a){re.vertexAttribPointer(e,t,r,!!n,o,a)},D:function(e,t,r,n){re.viewport(e,t,r,n)},X:function(){$("trap!")},W:function(){},V:function(){},U:function(){},k:$,memory:f,table:p},pe=r.asm({},de,w);r.asm=pe;var me=r.__GLOBAL__sub_I_DeformableCustomMaskJSONParser_FloatFunctions_cpp=function(){return r.asm.Ma.apply(null,arguments)},ge=r.__GLOBAL__sub_I_DeformableCustomMaskJSONParser_PointFunctions_cpp=function(){return r.asm.Na.apply(null,arguments)},ye=r.__GLOBAL__sub_I_DeformableCustomMaskJSONParser_cpp=function(){return r.asm.Oa.apply(null,arguments)},ve=r.__GLOBAL__sub_I_DeformableCustommaskJSONParser_WeightedPointPairsFunctions_cpp=function(){return r.asm.Pa.apply(null,arguments)},_e=r.__GLOBAL__sub_I_MakeupMaskDataConstants_cpp=function(){return r.asm.Qa.apply(null,arguments)},we=r.__GLOBAL__sub_I_system_cpp=function(){return r.asm.Ra.apply(null,arguments)},ke=r.__GLOBAL__sub_I_umatrix_cpp=function(){return r.asm.Sa.apply(null,arguments)},be=r.___emscripten_environ_constructor=function(){return r.asm.Ta.apply(null,arguments)};r._addJSONToCache=function(){return r.asm.Ua.apply(null,arguments)},r._captureOutput=function(){return r.asm.Va.apply(null,arguments)},r._cropResizeConvertedNV12=function(){return r.asm.Wa.apply(null,arguments)};var xe=r._free=function(){return r.asm.Xa.apply(null,arguments)};r._freeCapturedOutput=function(){return r.asm.Ya.apply(null,arguments)},r._getCanvasBufferPixelData=function(){return r.asm.Za.apply(null,arguments)},r._getCroppedConvertedNV12=function(){return r.asm._a.apply(null,arguments)},r._getDownsizedConvertedNV12=function(){return r.asm.$a.apply(null,arguments)},r._getIsMouthOpen=function(){return r.asm.ab.apply(null,arguments)},r._getTintImagePathForEffect=function(){return r.asm.bb.apply(null,arguments)},r._init=function(){return r.asm.cb.apply(null,arguments)},r._isFoundationCloseMatch=function(){return r.asm.db.apply(null,arguments)};var Le=r._malloc=function(){return r.asm.eb.apply(null,arguments)};r._newCachedImage=function(){return r.asm.fb.apply(null,arguments)},r._prepareAndBindNV12InputTexture=function(){return r.asm.gb.apply(null,arguments)},r._processNV12InputTexture=function(){return r.asm.hb.apply(null,arguments)},r._removeImageFromCache=function(){return r.asm.ib.apply(null,arguments)},r._render=function(){return r.asm.jb.apply(null,arguments)},r._renderFromNV12Data=function(){return r.asm.kb.apply(null,arguments)},r._resetTrackerData=function(){return r.asm.lb.apply(null,arguments)},r._resizeView=function(){return r.asm.mb.apply(null,arguments)},r._setComparisonBarColor=function(){return r.asm.nb.apply(null,arguments)},r._setComparisonBarWidth=function(){return r.asm.ob.apply(null,arguments)},r._setComparisonModeSettings=function(){return r.asm.pb.apply(null,arguments)},r._setConvertOutputToNV12=function(){return r.asm.qb.apply(null,arguments)},r._setEffectVisibility=function(){return r.asm.rb.apply(null,arguments)},r._setEnableFaceChart=function(){return r.asm.sb.apply(null,arguments)},r._setEnableParallelTracking=function(){return r.asm.tb.apply(null,arguments)},r._setFaceTrackerData=function(){return r.asm.ub.apply(null,arguments)},r._setFlipY=function(){return r.asm.vb.apply(null,arguments)},r._setMakeupLookAfter=function(){return r.asm.wb.apply(null,arguments)},r._setMakeupLookBefore=function(){return r.asm.xb.apply(null,arguments)},r._setQuality=function(){return r.asm.yb.apply(null,arguments)},r._setTintEffectImagePath=function(){return r.asm.zb.apply(null,arguments)},r._useAndConvertNV12Input=function(){return r.asm.Ab.apply(null,arguments)};var Ee,Ce=r.stackAlloc=function(){return r.asm.Db.apply(null,arguments)},De=r.stackRestore=function(){return r.asm.Eb.apply(null,arguments)},Me=r.stackSave=function(){return r.asm.Fb.apply(null,arguments)};function Se(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Pe(e){function t(){Ee||(Ee=!0,r.calledRun=!0,m||(V=!0,j(z),j(W),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),H.unshift(e);var e;j(H)}()))}U>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),B.unshift(e);var e;j(B)}(),U>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),t()}),1)):t()))}if(r.dynCall_v=function(){return r.asm.Bb.apply(null,arguments)},r.dynCall_vi=function(){return r.asm.Cb.apply(null,arguments)},r.asm=pe,r.cwrap=function(e,t,r,n){var o=(r=r||[]).every((function(e){return"number"===e}));return"string"!==t&&o&&!n?y(e):function(){return v(e,t,r,arguments)}},r.UTF8ToString=S,r.then=function(e){if(Ee)e(r);else{var t=r.onRuntimeInitialized;r.onRuntimeInitialized=function(){t&&t(),e(r)}}return r},G=function e(){Ee||Pe(),Ee||(G=e)},r.run=Pe,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Pe(),e}),Ne=Re,je=s((function e(t,r,n){a(this,e),this.detectionResult=t,this.imageData=r,this.canvas=n,this.imageDataCopy=null})),Be=function(){function e(t){a(this,e),t||O("need the coreSDK to create MakeupEffects"),this.coreSDK=t,this.makeupLooks={},this.createLookPromise=Promise.resolve()}var t,r;return s(e,[{key:"hasLook",value:function(e){return Boolean(this.makeupLooks[e])}},{key:"getLook",value:function(e){return this.makeupLooks[e]}},{key:"removeLook",value:function(e){this.makeupLooks[e]&&delete this.makeupLooks[e]}},{key:"createLook",value:(r=o(v.mark((function e(t,r,n,o){var a,i=this,s=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(s.length>4&&void 0!==s[4])||s[4],this.createLookPromise=this.createLookPromise.then((function(){return i.createLookInternal(t,r,n,o,a)})),e.abrupt("return",this.createLookPromise);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,o){return r.apply(this,arguments)})},{key:"createLookInternal",value:(t=o(v.mark((function e(t,r,n,o,a){var i,s=this;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a?Ee(t,n):t,e.abrupt("return",this.coreSDK.preloadFilesForLook(i).then((function(){return s.makeupLooks[r]={},a?s.makeupLooks[r].lookGeneratorLook=t:s.makeupLooks[r].coreSDKLook=i,s.makeupLooks[r].faceEffects=n,s.makeupLooks[r].enableFaceChart=o,!0}),(function(e){O(e)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r,n,o,a){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=this;Object.keys(this.makeupLooks).forEach((function(t){delete e.makeupLooks[t]})),this.makeupLooks={},this.coreSDK=null}}]),e}();function ze(e,t,r,n,o){return We.apply(this,arguments)}function We(){return We=o(v.mark((function e(t,r,n,o,a){var i,s,u,l,c,h,f,d,p,m,g,y;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.resolveImageLocation(t,n,a),mfBroadcast(_.EventStage.RESOURCE,i),e.next=4,new Promise((function(e,t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(e){return t(e)},r.src=i}));case 4:if(s=e.sent,(u=document.createElement("canvas")).width=s.naturalWidth,u.height=s.naturalHeight,(l=u.getContext("2d")).drawImage(s,0,0),c=l.getImageData(0,0,u.width,u.height),h=new Uint8Array(c.data),f=s.naturalWidth*s.naturalHeight,r){for(d=new Uint8Array(f),p=0;p<d.length;p+=1)d[p]=h[4*p];h=d}else for(m=0;m<f;m+=1)g=h[4*m+3]/255,h[4*m]=h[4*m]*g,h[4*m+1]=h[4*m+1]*g,h[4*m+2]=h[4*m+2]*g;return y={buffer:h,width:c.width,height:c.height},e.abrupt("return",y);case 16:case"end":return e.stop()}}),e)}))),We.apply(this,arguments)}function He(e,t,r){return Ve.apply(this,arguments)}function Ve(){return(Ve=o(v.mark((function e(t,r,n){var o,a,i;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.resolveJsonLocation(t,r),mfBroadcast(_.EventStage.RESOURCE,o),e.next=4,fetch(o);case 4:return a=e.sent,e.next=7,a.text();case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e){var t={x:(e.contour2D[9].x+e.contour2D[10].x)/2,y:(e.contour2D[9].y+e.contour2D[10].y)/2},r=function(e){return[e.x,e.y,e.z]};return{outerMouth:e.extendedOuterMouth2D,innerMouth:e.innerMouth2D,leftEye:e.leftExtendedEye2D,rightEye:e.rightExtendedEye2D,leftBrow:e.leftFullBrow2D,rightBrow:e.rightFullBrow2D,nose:e.extendedNose2D,contour:[e.contour2D[0],t,e.contour2D[19]],foreheadPt:e.forehead2D[1],faceRotation:[e.faceRotation.x,-e.faceRotation.y,-e.faceRotation.z],faceTranslation:r(e.faceTranslation),modelViewProjectionMatrix:e.modelViewProjectionMatrix,modelMatrix:e.modelMatrix,projectionViewMatrix:e.projectionViewMatrix,rightEye3D:r(e.rightEyeCenter3D),leftEye3D:r(e.leftEyeCenter3D),nose3D:r(e.noseCenter3D),mouth3D:r(e.mouthCenter3D),rightEyeInnerCorner3D:r(e.rightEyeInnerCorner3D),leftEyeInnerCorner3D:r(e.leftEyeInnerCorner3D),rightEyeOuterCorner3D:r(e.rightEyeOuterCorner3D),leftEyeOuterCorner3D:r(e.leftEyeOuterCorner3D),rightNose3D:r(e.rightNose3D),leftNose3D:r(e.leftNose3D)}}var Ge=function(){function e(t){a(this,e),this.originalCanvas=null,this.hasRendered=!1,this.lookManager=null,this.mediaData=null,this.shouldKeepOriginal=!0,this.smoothDegree=0,this.coreSDK=null,this.outputCanvas=null,this.currentImageData=null,this.resourceResolver=t,this.currentLookId=null,this.currentBaseLook=null,this.mouthOverrideState="unset"}var t,r,n,i,u,l;return s(e,[{key:"width",get:function(){return this.originalCanvas.width}},{key:"height",get:function(){return this.originalCanvas.height}},{key:"init",value:(l=o(v.mark((function e(t,r){var n,o=this;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.originalCanvas||(this.originalCanvas=I(t,r)),this.outputCanvas=document.createElement("canvas"),this.outputCanvas.width=t,this.outputCanvas.height=r,e.next=6,MF_MODULE_LOADER.wasmModulePromises.coreSDKWasmModule;case 6:return n=e.sent,this.coreSDK=new Oe(Ne),this.coreSDK.setLoadImageHandler((function(e,t,r){return ze(e,t,r,o.resourceResolver,!1)})),this.coreSDK.setLoadJSONHandler((function(e,t){return He(e,t,o.resourceResolver)})),this.coreSDK.setQuality(he.High),this.coreSDK.loadLookResourcesInParallel=!0,this.coreSDK.instantiateWasmOverride=function(e,t){return WebAssembly.instantiate(n,e).then((function(e){t(e)})),{}},e.next=15,this.coreSDK.load(this.outputCanvas,t,r);case 15:this.lookManager=new Be(this.coreSDK),t===this.width&&r===this.height||this.coreSDK.resizeView(t,r),this.setSmoothingIntensity(this.smoothDegree);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getBeforeEffectsCanvas",value:function(){return this.originalCanvas}},{key:"getOutputCanvas",value:function(){return this.outputCanvas}},{key:"setMouthOpen",value:function(e){this.mouthOverrideState=e?"open":"closed",this.mediaData&&this.setMediaData(this.mediaData)}},{key:"unsetMouthOpen",value:function(){this.mouthOverrideState="unset",this.mediaData&&this.setMediaData(this.mediaData)}},{key:"isMouthOpen",value:function(){var e,t;return null!==(e=null===(t=this.coreSDK)||void 0===t?void 0:t.getIsMouthOpen())&&void 0!==e&&e}},{key:"isFoundationCloseMatch",value:function(){var e,t;return null!==(e=null===(t=this.coreSDK)||void 0===t?void 0:t.isFoundationCloseMatch())&&void 0!==e&&e}},{key:"resize",value:function(e,t){var r;("number"!=typeof e||"number"!=typeof t||e<0||t<0)&&O("Invalid arguments to resize"),this.originalCanvas.width=e,this.originalCanvas.height=t,this.outputCanvas.width=e,this.outputCanvas.height=t,null===(r=this.coreSDK)||void 0===r||r.resizeView(e,t)}},{key:"setShouldKeepOriginal",value:function(e){this.shouldKeepOriginal=e}},{key:"setMediaData",value:function(e){var t,r=this;if(e instanceof je||O("Type error"),this.mediaData=e,e.canvas.width!==this.outputCanvas.width||e.canvas.height!==this.outputCanvas.height){var n=e.canvas.width,o=e.canvas.height;this.resize(n,o)}this.shouldKeepOriginal&&this.originalCanvas.getContext("2d").drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height);var a=e.imageData;if((null===(t=e.detectionResult)||void 0===t||null===(t=t.faces)||void 0===t?void 0:t.length)>0){var i=[];e.detectionResult.faces.forEach((function(e,t){var n=Ue(e.facePoints);i.push({facePts:n,faceboxX:e.facebox.x,faceboxY:e.facebox.y,faceboxWidth:e.facebox.width,faceboxHeight:e.facebox.height,mouthOpenOverride:0===t?r.mouthOverrideState:"unset"})}));var s={imageWidth:e.imageData.width,imageHeight:e.imageData.height,faceData:i};this.coreSDK.setMultiFaceTrackerData(s)}else this.coreSDK.resetTrackerData();this.currentImageData=a.data}},{key:"hasLook",value:function(e){return this.lookManager.hasLook(e)}},{key:"removeLook",value:function(e){this.lookManager.removeLook(e)}},{key:"setBaseLook",value:(u=o(v.mark((function e(t){var r;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentBaseLook=t,r=Ee(t),e.next=4,this.coreSDK.setLookBefore(r);case 4:return e.next=6,this.updateRendererLook();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setLook",value:(i=o(v.mark((function e(t){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lookManager.hasLook(t)||O("Cannot use a lookId ".concat(t," that does not exist")),this.currentLookId=t,e.next=4,this.updateRendererLook();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTintEffect",value:(n=o(v.mark((function e(t){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.coreSDK.setTintEffect(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getTintEffect",value:function(){return this.coreSDK.getTintEffect()}},{key:"updateRendererLook",value:(r=o(v.mark((function e(){var t,r,n,o,a,i,s;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.currentLookId,r=t?this.lookManager.getLook(t):null,n=r?r.faceEffects:null,o=r?r.lookGeneratorLook:null,!(a=r?r.coreSDKLook:null)){e.next=10;break}return e.next=8,this.coreSDK.setLook(a);case 8:e.next=13;break;case 10:return i=Ee(o,n,this.currentBaseLook),e.next=13,this.coreSDK.setLook(i);case 13:s=!!r&&r.enableFaceChart,this.coreSDK.setEnableFaceChart(s);case 15:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"render",value:function(){this.coreSDK.render(this.currentImageData,this.width,this.height),this.hasRendered=!0}},{key:"destroy",value:function(){this.lookManager.destroy(),this.coreSDK.destroy(),this.coreSDK=null}},{key:"createLook",value:(t=o(v.mark((function e(t,r,n,o){var a,i=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(i.length>4&&void 0!==i[4])||i[4],this.lookManager||O("need the procedureManager to createEffects"),e.abrupt("return",this.lookManager.createLook(t||{},r,n,o,a));case 3:case"end":return e.stop()}}),e,this)}))),function(e,r,n,o){return t.apply(this,arguments)})},{key:"setShouldShowPoints",value:function(e){this.coreSDK.drawFacePoints=e}},{key:"setSmoothingIntensity",value:function(e){var t={skinClearingAmount:e,shouldApplySkinEffectsToBaseLook:!0};this.setBaseLook(t)}},{key:"resetTrackerData",value:function(){this.coreSDK.resetTrackerData()}}]),e}();function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,s=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Je={};!function(e){const t=Math.pow(1,-10);class r{constructor(e,t,r,n){this.x=e,this.y=t,this.width=r,this.height=n}round(){return new r(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height))}static intersect(e,t){const n=new r(0,0,0,0);n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y);const o=Math.min(e.x+e.width,t.x+t.width),a=Math.min(e.y+e.height,t.y+t.height);return n.width=o-n.x,n.height=a-n.y,n}static union(e,t){const n=new r(0,0,0,0),o=Math.min(e.x,t.x),a=Math.max(e.x+e.width,t.x+t.width),i=Math.min(e.y,t.y),s=Math.max(e.y+e.height,t.y+t.height);return n.x=o,n.y=i,n.width=a-o,n.height=s-i,n}static area(e){return e.width*e.height}static iou(e,t){const n=r.intersect(e,t),o=r.union(e,t);return this.area(n)/this.area(o)}static mix(e,t,r){return e*(1-r)+t*r}static iouAvgRect(e,t){const n=r.iou(e,t),o=r.mix(e.x,t.x,n),a=r.mix(e.y,t.y,n),i=r.mix(e.x+e.width,t.x+t.width,n),s=r.mix(e.y+e.height,t.y+t.height,n);return new r(o,a,i-o,s-a)}}class n{constructor(e=0,t=0){this.x=e,this.y=t}static fromObject(e){return e?new n(e.x||0,e.y||0):new n}add(e){return new n(this.x+e.x,this.y+e.y)}sub(e){return new n(this.x-e.x,this.y-e.y)}neg(){return new n(-this.x,-this.y)}multScalar(e){return new n(this.x*e,this.y*e)}divScalar(e){if(Math.abs(e)<t)throw new Error("divScalar: scalar is too close to 0.");return new n(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}normalized(){const e=this.norm();return e<t?new n(0,0):new n(this.x/e,this.y/e)}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}clone(){return new n(this.x,this.y)}setTo(e){this.x=e.x,this.y=e.y}}function o(e){let t=0,r=0;return e.forEach((({x:e,y:n})=>{t+=e,r+=n})),new n(t/e.length,r/e.length)}class a{constructor(){this.data=[]}writeZeroes(e){for(let t=0;t<e;t+=1)this.data.push(0)}write(e){this.data.push(e||0)}writeNumArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(t);for(let t=0;t<e.length;t+=1)this.write(e[t]);const r=t-e.length;this.writeZeroes(r)}writePoint(e){this.write(e.x),this.write(e.y)}writePointArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(2*t);for(let t=0;t<e.length;t+=1)this.writePoint(e[t]);const r=t-e.length;this.writeZeroes(2*r)}toFloat32(){return new Float32Array(this.data)}toFloat64(){return new Float64Array(this.data)}}e.Color=class{constructor(e,t,r,n=255){this.r=e,this.g=t,this.b=r,this.a=n}},e.FacePoints=class{constructor(){this.outerMouth=null,this.innerMouth=null,this.leftEye=null,this.rightEye=null,this.leftBrow=null,this.rightBrow=null,this.nose=null,this.contour=null,this.foreheadPt=null,this.rightEye3D=[65.9,25.8,200.7],this.leftEye3D=[-65.9,25.8,200.7],this.nose3D=[0,-69.7,259.8],this.mouth3D=[0,-132.5,215.1],this.rightEyeInnerCorner3D=[32.6,27.1,196.5],this.leftEyeInnerCorner3D=[-32.6,27.1,196.5],this.rightEyeOuterCorner3D=[105.638,26.872,185.49],this.leftEyeOuterCorner3D=[-105.638,26.872,185.49],this.rightNose3D=[32.559,-20.731,206.171],this.leftNose3D=[-32.559,-20.731,206.171],this.modelMatrix=null,this.projectionViewMatrix=null,this.modelViewProjectionMatrix=null,this.faceRotation=[0,0,0],this.faceTranslation=[0,0,0]}static serialize(e){const t=new a;return t.writePointArray(e.outerMouth,13),t.writePointArray(e.innerMouth,8),t.writePointArray(e.leftEye,10),t.writePointArray(e.rightEye,10),t.writePointArray(e.leftBrow,7),t.writePointArray(e.rightBrow,7),t.writePointArray(e.nose,7),t.writePointArray(e.contour,3),t.writeNumArray([e.foreheadPt.x,e.foreheadPt.y],2),t.writeNumArray(e.faceRotation,3),t.writeNumArray(e.faceTranslation,3),t.writeNumArray(e.modelViewProjectionMatrix,12),t.writeNumArray(e.modelMatrix,16),t.writeNumArray(e.projectionViewMatrix,12),t.writeNumArray(e.rightEye3D,3),t.writeNumArray(e.leftEye3D,3),t.writeNumArray(e.nose3D,3),t.writeNumArray(e.mouth3D,3),t.writeNumArray(e.rightEyeInnerCorner3D,3),t.writeNumArray(e.leftEyeInnerCorner3D,3),t.writeNumArray(e.rightEyeOuterCorner3D,3),t.writeNumArray(e.leftEyeOuterCorner3D,3),t.writeNumArray(e.rightNose3D,3),t.writeNumArray(e.leftNose3D,3),new Uint8Array(t.toFloat32().buffer)}pose2DPoints(){const e=o(this.rightEye),t=o(this.leftEye),r=o(this.nose),n=o(this.outerMouth);return[e.x,e.y,t.x,t.y,r.x,r.y,n.x,n.y,this.rightEye[0].x,this.rightEye[0].y,this.leftEye[5].x,this.leftEye[5].y,this.rightEye[5].x,this.rightEye[5].y,this.leftEye[0].x,this.leftEye[0].y,this.nose[6].x,this.nose[6].y,this.nose[0].x,this.nose[0].y]}pose3DPoints(){return this.rightEye3D.concat(this.leftEye3D,this.nose3D,this.mouth3D,this.rightEyeInnerCorner3D,this.leftEyeInnerCorner3D,this.rightEyeOuterCorner3D,this.leftEyeOuterCorner3D,this.rightNose3D,this.leftNose3D)}},e.FloatWriter=a,e.PixelData=class{constructor(e,t,r){this.buffer=e,this.width=t,this.height=r}},e.Point=n,e.Rect=r,e.Timer=class{constructor(){this.reset()}reset(){this.startTime=(new Date).getTime()}timePassed(){return(new Date).getTime()-this.startTime}static measure(e){const t=(new Date).getTime();return e(),(new Date).getTime()-t}},e.assert=(e,t=null)=>{if(!e)throw console.error(t),new Error(`Assertion failed: ${t}`)},e.estimateForeheadPoint=(e,t)=>{const{width:r,height:o}=e,[a,i,s]=t,u=e.x+e.width/2,l=e.y+e.height/2,c=new n(u,l);c.x+=-Math.sin(i)*r/2,c.y+=(1-Math.cos(a))*o/2;const h=new n(Math.sin(s),-Math.cos(s)),f=new n(h.x*o/2,h.y*o/2);return new n(c.x+f.x,c.y+f.y)},Object.defineProperty(e,"__esModule",{value:!0})}(Je);const Xe=(e,t=null)=>{if(!e)throw console.error(t),new Error(`Assertion failed: ${t}`)},Ke=Math.pow(1,-10);class Ze{constructor(e=0,t=0){this.x=e,this.y=t}static fromObject(e){return e?new Ze(e.x||0,e.y||0):new Ze}add(e){return new Ze(this.x+e.x,this.y+e.y)}sub(e){return new Ze(this.x-e.x,this.y-e.y)}neg(){return new Ze(-this.x,-this.y)}multScalar(e){return new Ze(this.x*e,this.y*e)}divScalar(e){if(Math.abs(e)<Ke)throw new Error("divScalar: scalar is too close to 0.");return new Ze(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}normalized(){const e=this.norm();return e<Ke?new Ze(0,0):new Ze(this.x/e,this.y/e)}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}clone(){return new Ze(this.x,this.y)}setTo(e){this.x=e.x,this.y=e.y}}function Qe(e){let t=0,r=0;return e.forEach((({x:e,y:n})=>{t+=e,r+=n})),new Ze(t/e.length,r/e.length)}class et{constructor(){this.data=[]}writeZeroes(e){for(let t=0;t<e;t+=1)this.data.push(0)}write(e){this.data.push(e||0)}writeNumArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(t);for(let t=0;t<e.length;t+=1)this.write(e[t]);const r=t-e.length;this.writeZeroes(r)}writePoint(e){this.write(e.x),this.write(e.y)}writePointArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(2*t);for(let t=0;t<e.length;t+=1)this.writePoint(e[t]);const r=t-e.length;this.writeZeroes(2*r)}toFloat32(){return new Float32Array(this.data)}toFloat64(){return new Float64Array(this.data)}}class tt{constructor(){this.outerMouth=null,this.innerMouth=null,this.leftEye=null,this.rightEye=null,this.leftBrow=null,this.rightBrow=null,this.nose=null,this.contour=null,this.foreheadPt=null,this.rightEye3D=[65.9,25.8,200.7],this.leftEye3D=[-65.9,25.8,200.7],this.nose3D=[0,-69.7,259.8],this.mouth3D=[0,-132.5,215.1],this.rightEyeInnerCorner3D=[32.6,27.1,196.5],this.leftEyeInnerCorner3D=[-32.6,27.1,196.5],this.rightEyeOuterCorner3D=[105.638,26.872,185.49],this.leftEyeOuterCorner3D=[-105.638,26.872,185.49],this.rightNose3D=[32.559,-20.731,206.171],this.leftNose3D=[-32.559,-20.731,206.171],this.modelMatrix=null,this.projectionViewMatrix=null,this.modelViewProjectionMatrix=null,this.faceRotation=[0,0,0],this.faceTranslation=[0,0,0]}static serialize(e){const t=new et;return t.writePointArray(e.outerMouth,13),t.writePointArray(e.innerMouth,8),t.writePointArray(e.leftEye,10),t.writePointArray(e.rightEye,10),t.writePointArray(e.leftBrow,7),t.writePointArray(e.rightBrow,7),t.writePointArray(e.nose,7),t.writePointArray(e.contour,3),t.writeNumArray([e.foreheadPt.x,e.foreheadPt.y],2),t.writeNumArray(e.faceRotation,3),t.writeNumArray(e.faceTranslation,3),t.writeNumArray(e.modelViewProjectionMatrix,12),t.writeNumArray(e.modelMatrix,16),t.writeNumArray(e.projectionViewMatrix,12),t.writeNumArray(e.rightEye3D,3),t.writeNumArray(e.leftEye3D,3),t.writeNumArray(e.nose3D,3),t.writeNumArray(e.mouth3D,3),t.writeNumArray(e.rightEyeInnerCorner3D,3),t.writeNumArray(e.leftEyeInnerCorner3D,3),t.writeNumArray(e.rightEyeOuterCorner3D,3),t.writeNumArray(e.leftEyeOuterCorner3D,3),t.writeNumArray(e.rightNose3D,3),t.writeNumArray(e.leftNose3D,3),new Uint8Array(t.toFloat32().buffer)}pose2DPoints(){const e=Qe(this.rightEye),t=Qe(this.leftEye),r=Qe(this.nose),n=Qe(this.outerMouth);return[e.x,e.y,t.x,t.y,r.x,r.y,n.x,n.y,this.rightEye[0].x,this.rightEye[0].y,this.leftEye[5].x,this.leftEye[5].y,this.rightEye[5].x,this.rightEye[5].y,this.leftEye[0].x,this.leftEye[0].y,this.nose[6].x,this.nose[6].y,this.nose[0].x,this.nose[0].y]}pose3DPoints(){return this.rightEye3D.concat(this.leftEye3D,this.nose3D,this.mouth3D,this.rightEyeInnerCorner3D,this.leftEyeInnerCorner3D,this.rightEyeOuterCorner3D,this.leftEyeOuterCorner3D,this.rightNose3D,this.leftNose3D)}}const rt={data:{blush:["apple","apple2","apple2_intense","apple_blended","apple_blended_intense","apple_intense","cheekbone","cheekbone_intense","contour","default_intense","full_cheek","full_cheek_intense","lower_cheek","lower_cheek_intense","none","upper_cheek","upper_cheek_intense","default"],brow:["default"],concealer:["default"],contour:["forehead_side","forehead_side2","highlight","default","inner_eyebrow"],cushion:["default"],eyeliner:["angular_both","angular_top","Bold_eyeliner_both","Bold_eyeliner_top","butterfly_liner_both","butterfly_liner_top","butterfly_mask_both","butterfly_mask_top","cateye2_both","cateye2_top","cateye_both","cateye_top","cheetah_mask_both","cheetah_mask_top","cheetah_winged_both","cheetah_winged_top","Confident_eyeliner_both","Confident_eyeliner_top","crease_box_both","crease_box_top","crease_flare_both","crease_flare_top","crease_simple_long_both","crease_simple_long_top","crease_simple_short_both","crease_simple_short_top","double_winged_both","double_winged_top","elongated_bottom_both","elongated_bottom_top","extrasmallwinged_both","extrasmallwinged_top","fashion_look2_eyeliner_both","fashion_look2_eyeliner_top","GetTheLook_look1_eyeliner_both","GetTheLook_look1_eyeliner_top","GetTheLook_look3_eyeliner_both","GetTheLook_look3_eyeliner_top","halloween1_both","halloween1_top","halloween2_both","halloween2_top","halloween3_both","halloween3_top","halloween4_both","halloween4_top","halloween5_both","halloween5_top","innermid_crease_both","innermid_crease_top","kaja_both","kaja_top","kohl_both","kohl_top","la_inner_winged_both","la_inner_winged_top","la_mask_both","la_mask_top","la_middle_winged_both","la_middle_winged_top","la_outer_winged_both","la_outer_winged_top","MNY_FashionWeek_look1_liner1_both","MNY_FashionWeek_look1_liner1_top","MNY_FashionWeek_look1_liner2_both","MNY_FashionWeek_look1_liner2_top","MNY_FashionWeek_look1_liner3_both","MNY_FashionWeek_look1_liner3_top","MNY_Holiday_look1_eyeliner_crease_both","MNY_Holiday_look1_eyeliner_crease_top","MNY_Holiday_look2_eyeliner_outer_both","MNY_Holiday_look2_eyeliner_outer_top","MNY_Holiday_look2_eyeliner_under_both","MNY_Holiday_look2_eyeliner_under_top","natural","natural2_both","natural2_top","natural_both","natural_top","none_both","none_top","OAP_Halloween2020_look1_both","OAP_Halloween2020_look1_top","OAP_Halloween2020_look2_both","OAP_Halloween2020_look2_top","OAP_Halloween2020_look3_both","OAP_Halloween2020_look3_top","OAP_Halloween2020_look4_both","OAP_Halloween2020_look4_top","Powerful_eyeliner_both","Powerful_eyeliner_top","prima_ballerina_liner_both","prima_ballerina_liner_top","puppyeye_both","puppyeye_top","sharpwinged_inner_both","sharpwinged_inner_top","sharpwinged_outer_both","sharpwinged_outer_top","smallwinged_both","smallwinged_top","smokeyfull_both","smokeyfull_top","smoky2_both","smoky2_top","smokynautral_both","smokynautral_top","smoky_both","smoky_top","smudged_bottom_both","smudged_bottom_top","smudged_winged_both","smudged_winged_top","subtle_both","subtle_top","swoop_winged_liner_both","swoop_winged_liner_top","tear_both","tear_top","thick_winged_crease_both","thick_winged_crease_top","top_both","top_top","waterline_both","waterline_thick_both","waterline_thick_top","waterline_top","winged2_both","winged2_top","wingedsimple_both","wingedsimple_top","wingedthick_both","wingedthick_top","wingedthin_both","wingedthin_top","winged_both","winged_crease2_both","winged_crease2_top","winged_crease_both","winged_crease_top","winged_top"],eyeshadow:["angular_full","angular_liner","angular_overlay","Asian_1color","Asian_2color_A1","Asian_2color_A2","Asian_2color_B1","Asian_2color_B2","Asian_3color_A1","Asian_3color_A2","Asian_3color_A3","Asian_3color_B1","Asian_3color_B2","Asian_3color_B3","Azuki_Look_1","Azuki_Look_2","below_iris","black","bluelook1_a","bluelook1_b","bluelook1_b1","bluelook1_b2","bluelook1_c","bluelook2_a","bluelook2_b","bluelook2_c","bluelook2_eyebrow","bluelook3_a","bluelook3_b","bluelook3_c","bronze","browline2","butterfly_inner","center","centre_lid","cheetah_lid","cleopatra2_liner","colourqueenlook1_part1","colourqueenlook1_part2","colourqueenlook3_part1","colourqueenlook3_part2","Confident_eyeshadow","contour","crease3","deep_aqua","deep_blue","deep_blue_2","deep_blue_fade","elongated_bottom_liner","elongated_lid","energeticorange_part1","energeticorange_part2","energeticorange_part3","energeticorange_part4","eyegowild_look2_lower","eyegowild_look2_upper","eyegowild_look4","eyegowild_look4_liner","eyegowild_look5_liner","eyegowild_look5_lower","eyegowild_look5_upper","eyegowild_look6","eyegowild_look6_liner","fashion_look1_part1","fashion_look1_part2","fashion_look2_part1","fashion_look2_part2","fashion_look3_part1","fashion_look3_part2","fashion_look4_part1","fashion_look4_part2","framed","full_lid3","GetTheLook_look1_eyeshadow1","GetTheLook_look1_eyeshadow2","GetTheLook_look1_eyeshadow3","GetTheLook_look1_eyeshadow4","GetTheLook_look2_eyeshadow1","GetTheLook_look2_eyeshadow2","GetTheLook_look3_eyeshadow","gold","Graphic_3_Liner","green","half_inner_lid","halloween1","halloween2","halloween3","indigomotion_part1","indigomotion_part2","indigomotion_part3","indigomotion_part4","innercorner","innermid_crease_liner","la_tear","light_blue","lowerlash2","lowerlash_thick","MNY_FashionWeek_look1_shadow1","MNY_FashionWeek_look1_shadow2","MNY_FashionWeek_look1_shadow3","MNY_Holiday_look1_eyeshadow_crease","MNY_Holiday_look2_eyeshadow_outer","MNY_Holiday_look2_eyeshadow_under","natural_liner","none","OP_look1_CS1","OP_look1_M3","OP_look1_ME5","OP_look1_ME6","OP_look2_CS1","OP_look2_P1","OP_look3_CS1","OP_look3_ME4","OP_look3_P1","OP_look4_ME6","OP_look4_P2","OP_look5_CS1","OP_look5_M3","OP_look5_M5","OP_look5_P4","OP_look6_CS1","OP_look6_M4","OP_look6_ME5","OP_look6_P3","OP_look7_G1","OP_look7_P1","OP_look7_PR1","OP_look8_G1","OP_look8_ME2","OP_look8_ME4","orangelook4_a","orangelook4_b","orangelook4_c","orangelook5_a","orangelook5_b","orangelook5_c","orangelook5_eyebrow","orangelook6_a","orangelook6_b","orangelook6_c","outer_corner_framed","outer_half_top","Powerful_eyeshadow_part1","Powerful_eyeshadow_part2","prima_ballerina_shadow","sharplid_full","sharp_lid2","side_crease","side_lid","sportykick_part1","sportykick_part2","sportykick_part3","sportykick_part4","summerpunch_part1","summerpunch_part2","summerpunch_part3","summerpunch_part4","tokyosunrise_part1","tokyosunrise_part2","tokyosunrise_part3","tokyosunrise_part4","winged_crease","default","full_lid","outer","inner","crease","brow_highlight","full_lid2","outer2","tear","crease2","browline","lowerlash","innerhalf","outerhalf","rectangular","smokycateye","fullcateye","cleopatra1","cleopatra2","full_smoky_lid","full_smoky_winged","fulllid_winged","innerlid","sharp_crease","sharp_lid","sharpinner_lid","sharpouter_corner","sharpwinged_inner","sharpwinged_outer"],foundation:["default"],highlight:["cheek1","cheek2","cheek3","cheek4","chin","contour","cupidsbow","eyebrow","forehead","glow1_cherie","glow2_monamour","glow3_lavieenglow","glow3_lavieenglow2","glow4_sorbet","nose1","nose2","nose3","upperlip","default"],lipcolor:["inner_horizontal","inner_vertical","outer_horizontal","outer_vertical","default"],lipliner:["default"],mascara:["doll","doll_2","doll_2_full","drama","drama_full","extreme","extreme_full","fashion_look2_lash","FA_Asia_2_4","FA_Asia_2_5","grandiose","grandiose_full","idole_lash","length","lower","natural","naturallength","naturallength_2","naturalvolume","naturalvolumelength","naturalvolumelength_lower","naturalvolume_lower","naturalwhispy","naturalwhispy_lower","natural_2","natural_2_full","none","prima_ballerina_bottom_mascara","prima_ballerina_top_mascara","subtle","subtle_full","volume","volumelength","volume_2","volume_2_full"],primer:["default"],settingspray:["default"]}};function nt(e){return function(e){return rt.data[e]}(e).reduce(((t,r)=>{const n=t;return n[r]=`${e}_${r}.png`,n}),{})}Object.assign(Object.assign(Object.assign({blush:"blush.png",highlight:"highlight.png",contour:"contour.png",overlay:"white.png"},nt("blush")),nt("contour")),nt("highlight")),Object.assign(Object.assign({},nt("eyeliner")),{natural_top:"natural_top.png"}),Object.assign({},nt("eyeshadow")),Object.assign({},nt("lipcolor")),Object.assign(Object.assign({},nt("mascara")),{doll:"doll.png",length:"length.png",lower:"lower.png",natural:"natural.png",naturallength:"naturallength.png",volume:"volume.png",volumelength:"volumelength.png"});var ot,at="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},it={exports:{}};function st(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((n=n.apply(e,t||[])).next())}))}function ut(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}!function(e,t){var r="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",a="[object Boolean]",i="[object Date]",s="[object Function]",u="[object GeneratorFunction]",l="[object Map]",c="[object Number]",h="[object Object]",f="[object Promise]",d="[object RegExp]",p="[object Set]",m="[object String]",g="[object Symbol]",y="[object WeakMap]",v="[object ArrayBuffer]",_="[object DataView]",w="[object Float32Array]",k="[object Float64Array]",b="[object Int8Array]",x="[object Int16Array]",L="[object Int32Array]",E="[object Uint8Array]",C="[object Uint8ClampedArray]",D="[object Uint16Array]",M="[object Uint32Array]",S=/\w*$/,P=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,T={};T[o]=T["[object Array]"]=T[v]=T[_]=T[a]=T[i]=T[w]=T[k]=T[b]=T[x]=T[L]=T[l]=T[c]=T[h]=T[d]=T[p]=T[m]=T[g]=T[E]=T[C]=T[D]=T[M]=!0,T["[object Error]"]=T[s]=T[y]=!1;var F="object"==typeof at&&at&&at.Object===Object&&at,O="object"==typeof self&&self&&self.Object===Object&&self,I=F||O||Function("return this")(),R=t&&!t.nodeType&&t,N=R&&e&&!e.nodeType&&e,j=N&&N.exports===R;function B(e,t){return e.set(t[0],t[1]),e}function z(e,t){return e.add(t),e}function W(e,t,r,n){var o=-1,a=e?e.length:0;for(n&&a&&(r=e[++o]);++o<a;)r=t(r,e[o],o,e);return r}function H(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function V(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function U(e,t){return function(r){return e(t(r))}}function G(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var q,Y=Array.prototype,$=Function.prototype,J=Object.prototype,X=I["__core-js_shared__"],K=(q=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"",Z=$.toString,Q=J.hasOwnProperty,ee=J.toString,te=RegExp("^"+Z.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),re=j?I.Buffer:void 0,ne=I.Symbol,oe=I.Uint8Array,ae=U(Object.getPrototypeOf,Object),ie=Object.create,se=J.propertyIsEnumerable,ue=Y.splice,le=Object.getOwnPropertySymbols,ce=re?re.isBuffer:void 0,he=U(Object.keys,Object),fe=Ie(I,"DataView"),de=Ie(I,"Map"),pe=Ie(I,"Promise"),me=Ie(I,"Set"),ge=Ie(I,"WeakMap"),ye=Ie(Object,"create"),ve=ze(fe),_e=ze(de),we=ze(pe),ke=ze(me),be=ze(ge),xe=ne?ne.prototype:void 0,Le=xe?xe.valueOf:void 0;function Ee(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ce(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function De(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Me(e){this.__data__=new Ce(e)}function Se(e,t,r){var n=e[t];Q.call(e,t)&&We(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function Pe(e,t){for(var r=e.length;r--;)if(We(e[r][0],t))return r;return-1}function Ae(e,t,r,n,f,y,P){var A;if(n&&(A=y?n(e,f,y,P):n(e)),void 0!==A)return A;if(!qe(e))return e;var F=He(e);if(F){if(A=function(e){var t=e.length,r=e.constructor(t);return t&&"string"==typeof e[0]&&Q.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!t)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,A)}else{var O=Ne(e),I=O==s||O==u;if(Ue(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if(O==h||O==o||I&&!y){if(H(e))return y?e:{};if(A=function(e){return"function"!=typeof e.constructor||Be(e)?{}:qe(t=ae(e))?ie(t):{};var t}(I?{}:e),!t)return function(e,t){return Fe(e,Re(e),t)}(e,function(e,t){return e&&Fe(t,Ye(t),e)}(A,e))}else{if(!T[O])return y?e:{};A=function(e,t,r,n){var o,s=e.constructor;switch(t){case v:return Te(e);case a:case i:return new s(+e);case _:return function(e,t){var r=t?Te(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case w:case k:case b:case x:case L:case E:case C:case D:case M:return function(e,t){var r=t?Te(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case l:return function(e,t,r){return W(t?r(V(e),!0):V(e),B,new e.constructor)}(e,n,r);case c:case m:return new s(e);case d:return function(e){var t=new e.constructor(e.source,S.exec(e));return t.lastIndex=e.lastIndex,t}(e);case p:return function(e,t,r){return W(t?r(G(e),!0):G(e),z,new e.constructor)}(e,n,r);case g:return o=e,Le?Object(Le.call(o)):{}}}(e,O,Ae,t)}}P||(P=new Me);var R=P.get(e);if(R)return R;if(P.set(e,A),!F)var N=r?function(e){return function(e,t,r){var n=t(e);return He(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,Ye,Re)}(e):Ye(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r););}(N||e,(function(o,a){N&&(o=e[a=o]),Se(A,a,Ae(o,t,r,n,a,e,P))})),A}function Te(e){var t=new e.constructor(e.byteLength);return new oe(t).set(new oe(e)),t}function Fe(e,t,r,n){r||(r={});for(var o=-1,a=t.length;++o<a;){var i=t[o],s=n?n(r[i],e[i],i,r,e):void 0;Se(r,i,void 0===s?e[i]:s)}return r}function Oe(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function Ie(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!qe(e)||(t=e,K&&K in t))&&(Ge(e)||H(e)?te:P).test(ze(e));var t}(r)?r:void 0}Ee.prototype.clear=function(){this.__data__=ye?ye(null):{}},Ee.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Ee.prototype.get=function(e){var t=this.__data__;if(ye){var n=t[e];return n===r?void 0:n}return Q.call(t,e)?t[e]:void 0},Ee.prototype.has=function(e){var t=this.__data__;return ye?void 0!==t[e]:Q.call(t,e)},Ee.prototype.set=function(e,t){return this.__data__[e]=ye&&void 0===t?r:t,this},Ce.prototype.clear=function(){this.__data__=[]},Ce.prototype.delete=function(e){var t=this.__data__,r=Pe(t,e);return!(r<0||(r==t.length-1?t.pop():ue.call(t,r,1),0))},Ce.prototype.get=function(e){var t=this.__data__,r=Pe(t,e);return r<0?void 0:t[r][1]},Ce.prototype.has=function(e){return Pe(this.__data__,e)>-1},Ce.prototype.set=function(e,t){var r=this.__data__,n=Pe(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},De.prototype.clear=function(){this.__data__={hash:new Ee,map:new(de||Ce),string:new Ee}},De.prototype.delete=function(e){return Oe(this,e).delete(e)},De.prototype.get=function(e){return Oe(this,e).get(e)},De.prototype.has=function(e){return Oe(this,e).has(e)},De.prototype.set=function(e,t){return Oe(this,e).set(e,t),this},Me.prototype.clear=function(){this.__data__=new Ce},Me.prototype.delete=function(e){return this.__data__.delete(e)},Me.prototype.get=function(e){return this.__data__.get(e)},Me.prototype.has=function(e){return this.__data__.has(e)},Me.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Ce){var n=r.__data__;if(!de||n.length<199)return n.push([e,t]),this;r=this.__data__=new De(n)}return r.set(e,t),this};var Re=le?U(le,Object):function(){return[]},Ne=function(e){return ee.call(e)};function je(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||A.test(e))&&e>-1&&e%1==0&&e<t}function Be(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||J)}function ze(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){return e===t||e!=e&&t!=t}(fe&&Ne(new fe(new ArrayBuffer(1)))!=_||de&&Ne(new de)!=l||pe&&Ne(pe.resolve())!=f||me&&Ne(new me)!=p||ge&&Ne(new ge)!=y)&&(Ne=function(e){var t=ee.call(e),r=t==h?e.constructor:void 0,n=r?ze(r):void 0;if(n)switch(n){case ve:return _;case _e:return l;case we:return f;case ke:return p;case be:return y}return t});var He=Array.isArray;function Ve(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!Ge(e)}var Ue=ce||function(){return!1};function Ge(e){var t=qe(e)?ee.call(e):"";return t==s||t==u}function qe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ye(e){return Ve(e)?function(e,t){var r=He(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ve(e)}(e)&&Q.call(e,"callee")&&(!se.call(e,"callee")||ee.call(e)==o)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,a=!!n;for(var i in e)!Q.call(e,i)||a&&("length"==i||je(i,n))||r.push(i);return r}(e):function(e){if(!Be(e))return he(e);var t=[];for(var r in Object(e))Q.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return Ae(e,!0,!0)}}(it,it.exports),function(e){e[e.Medium=0]="Medium",e[e.High=1]="High"}(ot||(ot={}));var lt={exports:{}};!function(e,t){var r="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",a="[object Boolean]",i="[object Date]",s="[object Function]",u="[object GeneratorFunction]",l="[object Map]",c="[object Number]",h="[object Object]",f="[object Promise]",d="[object RegExp]",p="[object Set]",m="[object String]",g="[object Symbol]",y="[object WeakMap]",v="[object ArrayBuffer]",_="[object DataView]",w="[object Float32Array]",k="[object Float64Array]",b="[object Int8Array]",x="[object Int16Array]",L="[object Int32Array]",E="[object Uint8Array]",C="[object Uint8ClampedArray]",D="[object Uint16Array]",M="[object Uint32Array]",S=/\w*$/,P=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,T={};T[o]=T["[object Array]"]=T[v]=T[_]=T[a]=T[i]=T[w]=T[k]=T[b]=T[x]=T[L]=T[l]=T[c]=T[h]=T[d]=T[p]=T[m]=T[g]=T[E]=T[C]=T[D]=T[M]=!0,T["[object Error]"]=T[s]=T[y]=!1;var F="object"==typeof $e&&$e&&$e.Object===Object&&$e,O="object"==typeof self&&self&&self.Object===Object&&self,I=F||O||Function("return this")(),R=t&&!t.nodeType&&t,N=R&&e&&!e.nodeType&&e,j=N&&N.exports===R;function B(e,t){return e.set(t[0],t[1]),e}function z(e,t){return e.add(t),e}function W(e,t,r,n){var o=-1,a=e?e.length:0;for(n&&a&&(r=e[++o]);++o<a;)r=t(r,e[o],o,e);return r}function H(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function V(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function U(e,t){return function(r){return e(t(r))}}function G(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var q,Y=Array.prototype,$=Function.prototype,J=Object.prototype,X=I["__core-js_shared__"],K=(q=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"",Z=$.toString,Q=J.hasOwnProperty,ee=J.toString,te=RegExp("^"+Z.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),re=j?I.Buffer:void 0,ne=I.Symbol,oe=I.Uint8Array,ae=U(Object.getPrototypeOf,Object),ie=Object.create,se=J.propertyIsEnumerable,ue=Y.splice,le=Object.getOwnPropertySymbols,ce=re?re.isBuffer:void 0,he=U(Object.keys,Object),fe=Ie(I,"DataView"),de=Ie(I,"Map"),pe=Ie(I,"Promise"),me=Ie(I,"Set"),ge=Ie(I,"WeakMap"),ye=Ie(Object,"create"),ve=ze(fe),_e=ze(de),we=ze(pe),ke=ze(me),be=ze(ge),xe=ne?ne.prototype:void 0,Le=xe?xe.valueOf:void 0;function Ee(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ce(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function De(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Me(e){this.__data__=new Ce(e)}function Se(e,t,r){var n=e[t];Q.call(e,t)&&We(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function Pe(e,t){for(var r=e.length;r--;)if(We(e[r][0],t))return r;return-1}function Ae(e,t,r,n,f,y,P){var A;if(n&&(A=y?n(e,f,y,P):n(e)),void 0!==A)return A;if(!qe(e))return e;var F=He(e);if(F){if(A=function(e){var t=e.length,r=e.constructor(t);return t&&"string"==typeof e[0]&&Q.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!t)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,A)}else{var O=Ne(e),I=O==s||O==u;if(Ue(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if(O==h||O==o||I&&!y){if(H(e))return y?e:{};if(A=function(e){return"function"!=typeof e.constructor||Be(e)?{}:qe(t=ae(e))?ie(t):{};var t}(I?{}:e),!t)return function(e,t){return Fe(e,Re(e),t)}(e,function(e,t){return e&&Fe(t,Ye(t),e)}(A,e))}else{if(!T[O])return y?e:{};A=function(e,t,r,n){var o,s=e.constructor;switch(t){case v:return Te(e);case a:case i:return new s(+e);case _:return function(e,t){var r=t?Te(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case w:case k:case b:case x:case L:case E:case C:case D:case M:return function(e,t){var r=t?Te(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case l:return function(e,t,r){return W(t?r(V(e),!0):V(e),B,new e.constructor)}(e,n,r);case c:case m:return new s(e);case d:return function(e){var t=new e.constructor(e.source,S.exec(e));return t.lastIndex=e.lastIndex,t}(e);case p:return function(e,t,r){return W(t?r(G(e),!0):G(e),z,new e.constructor)}(e,n,r);case g:return o=e,Le?Object(Le.call(o)):{}}}(e,O,Ae,t)}}P||(P=new Me);var R=P.get(e);if(R)return R;if(P.set(e,A),!F)var N=r?function(e){return function(e,t,r){var n=t(e);return He(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,Ye,Re)}(e):Ye(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r););}(N||e,(function(o,a){N&&(o=e[a=o]),Se(A,a,Ae(o,t,r,n,a,e,P))})),A}function Te(e){var t=new e.constructor(e.byteLength);return new oe(t).set(new oe(e)),t}function Fe(e,t,r,n){r||(r={});for(var o=-1,a=t.length;++o<a;){var i=t[o],s=n?n(r[i],e[i],i,r,e):void 0;Se(r,i,void 0===s?e[i]:s)}return r}function Oe(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function Ie(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!qe(e)||(t=e,K&&K in t))&&(Ge(e)||H(e)?te:P).test(ze(e));var t}(r)?r:void 0}Ee.prototype.clear=function(){this.__data__=ye?ye(null):{}},Ee.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Ee.prototype.get=function(e){var t=this.__data__;if(ye){var n=t[e];return n===r?void 0:n}return Q.call(t,e)?t[e]:void 0},Ee.prototype.has=function(e){var t=this.__data__;return ye?void 0!==t[e]:Q.call(t,e)},Ee.prototype.set=function(e,t){return this.__data__[e]=ye&&void 0===t?r:t,this},Ce.prototype.clear=function(){this.__data__=[]},Ce.prototype.delete=function(e){var t=this.__data__,r=Pe(t,e);return!(r<0||(r==t.length-1?t.pop():ue.call(t,r,1),0))},Ce.prototype.get=function(e){var t=this.__data__,r=Pe(t,e);return r<0?void 0:t[r][1]},Ce.prototype.has=function(e){return Pe(this.__data__,e)>-1},Ce.prototype.set=function(e,t){var r=this.__data__,n=Pe(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},De.prototype.clear=function(){this.__data__={hash:new Ee,map:new(de||Ce),string:new Ee}},De.prototype.delete=function(e){return Oe(this,e).delete(e)},De.prototype.get=function(e){return Oe(this,e).get(e)},De.prototype.has=function(e){return Oe(this,e).has(e)},De.prototype.set=function(e,t){return Oe(this,e).set(e,t),this},Me.prototype.clear=function(){this.__data__=new Ce},Me.prototype.delete=function(e){return this.__data__.delete(e)},Me.prototype.get=function(e){return this.__data__.get(e)},Me.prototype.has=function(e){return this.__data__.has(e)},Me.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Ce){var n=r.__data__;if(!de||n.length<199)return n.push([e,t]),this;r=this.__data__=new De(n)}return r.set(e,t),this};var Re=le?U(le,Object):function(){return[]},Ne=function(e){return ee.call(e)};function je(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||A.test(e))&&e>-1&&e%1==0&&e<t}function Be(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||J)}function ze(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){return e===t||e!=e&&t!=t}(fe&&Ne(new fe(new ArrayBuffer(1)))!=_||de&&Ne(new de)!=l||pe&&Ne(pe.resolve())!=f||me&&Ne(new me)!=p||ge&&Ne(new ge)!=y)&&(Ne=function(e){var t=ee.call(e),r=t==h?e.constructor:void 0,n=r?ze(r):void 0;if(n)switch(n){case ve:return _;case _e:return l;case we:return f;case ke:return p;case be:return y}return t});var He=Array.isArray;function Ve(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!Ge(e)}var Ue=ce||function(){return!1};function Ge(e){var t=qe(e)?ee.call(e):"";return t==s||t==u}function qe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ye(e){return Ve(e)?function(e,t){var r=He(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ve(e)}(e)&&Q.call(e,"callee")&&(!se.call(e,"callee")||ee.call(e)==o)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,a=!!n;for(var i in e)!t&&!Q.call(e,i)||a&&("length"==i||je(i,n))||r.push(i);return r}(e):function(e){if(!Be(e))return he(e);var t=[];for(var r in Object(e))Q.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return Ae(e,!0,!0)}}(lt,lt.exports);var ct=lt.exports,ht=function(){function e(e){this.module=null,this.cameraArraySize=0,this.cameraArrayPtr=0,this.cameraArray=null,this.cameraWidth=0,this.cameraHeight=0,this.loadImageHandler=null,this.loadJSONHandler=null,this.currentTutorial=null,this.loadedMasks=new Map,this.loadedJSONs=new Map,this.emscriptenConstructor=null,this.emscriptenLocateFileFunc=null,this.requestOverride=null,this.printOverride=null,this.loadTutorialResourcesInParallel=!1,this.instantiateWasmOverride=null,this.emscriptenConstructor=e}return e.prototype.load=function(e,t,r){return st(this,void 0,void 0,(function(){var n=this;return ut(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(o){var a={canvas:e,postRun:function(){n.log("postRun"),a.cw_init=a.cwrap("init",null,["number","number"]),a.cw_setFaceTrackerData=a.cwrap("setFaceTrackerData",null,["array","number","number","number","number","number","number","number"]),a.cw_resetTrackerData=a.cwrap("resetTrackerData",null,[]),a.cw_setTutorial=a.cwrap("setTutorial",null,["string"]),a.cw_setStepIndex=a.cwrap("setStepIndex",null,["number"]),a.cw_addImageToCache=a.cwrap("addImageToCache",null,["string","number","number","number","number"]),a.cw_addJSONToCache=a.cwrap("addJSONToCache",null,["string","string"]),a.cw_render=a.cwrap("render",null,["number","number","number"]),a.cw_resizeView=a.cwrap("resizeView",null,["number","number"]),a.cw_startTutorial=a.cwrap("startTutorial",null,[]),a.cw_pauseTutorial=a.cwrap("pauseTutorial",null,[]),a.cw_resumeTutorial=a.cwrap("resumeTutorial",null,[]),a.cw_stopTutorial=a.cwrap("stopTutorial",null,[]),a.cw_shouldDrawMakeup=a.cwrap("shouldDrawMakeup","boolean",[]),a.cw_shouldDrawTutorial=a.cwrap("shouldDrawTutorial","boolean",[]),a.cw_getProgress=a.cwrap("getProgress","number",[]),a.cw_setPlayCount=a.cwrap("setPlayCount",null,["number"]),a.cw_setStepAnimationDuration=a.cwrap("setStepAnimationDuration",null,["number"]),a.cw_setDelayBeforeRepeat=a.cwrap("setDelayBeforeRepeat",null,["number"]),a.cw_setShowMakeupWhenStepDone=a.cwrap("setShowMakeupWhenStepDone",null,["boolean"]),a.cw_setShouldDrawOriginal=a.cwrap("setShouldDrawOriginal",null,["boolean"]),a.cw_init(t,r),o()}};if("undefined"!=typeof XMLHttpRequest)a.request=XMLHttpRequest;else{if(!n.requestOverride)throw new Error("CoreSDKWrapper.requestOverride was not set");a.request=n.requestOverride}n.emscriptenLocateFileFunc&&(a.locateFile=n.emscriptenLocateFileFunc),n.printOverride&&(a.print=n.printOverride,a.printErr=n.printOverride),n.instantiateWasmOverride&&(a.instantiateWasm=n.instantiateWasmOverride),n.module=n.emscriptenConstructor(a)}))];case 1:return o.sent(),this.currentTutorial&&this.setTutorial(this.currentTutorial),[2]}}))}))},e.prototype.log=function(e){this.printOverride?this.printOverride(e):console.log(e)},e.prototype.allocateCameraBuffer=function(e,t){return st(this,void 0,void 0,(function(){var r;return ut(this,(function(n){return r=e*t*4,this.cameraArraySize!==r&&(this.cameraArrayPtr&&this.module._free(this.cameraArrayPtr),this.cameraArraySize=r,this.cameraArrayPtr=this.module._malloc(r),this.cameraWidth=e,this.cameraHeight=t),this.cameraArray=new Uint8Array(this.module.HEAPU8.buffer,this.cameraArrayPtr,r),[2]}))}))},e.prototype.preloadMask=function(e,t,r){return st(this,void 0,void 0,(function(){var n,o,a,i,s,u,l,c;return ut(this,(function(h){switch(h.label){case 0:return this.loadedMasks.get(e)?(this.loadedMasks.get(e).isGrayscale!==t&&console.warn(e+" is already loaded with different color settings"),[2]):(this.log("Loading mask "+e+", grayscale: "+t),[4,this.loadImageHandler(e,t,r)]);case 1:return n=h.sent(),o=n.buffer,a=n.width,i=n.height,u=a*i*(s=t?1:4),l=this.module._malloc(u),new Uint8Array(this.module.HEAPU8.buffer,l,u).set(o),c={storagePointer:l,isGrayscale:t},this.loadedMasks.set(e,c),this.module.cw_addImageToCache(e,l,a,i,s),[2]}}))}))},e.prototype.preloadJSON=function(e){return st(this,void 0,void 0,(function(){var t,r;return ut(this,(function(n){switch(n.label){case 0:return this.loadedJSONs.get(e)?[2]:(this.log("Loading json "+e),[4,this.loadJSONHandler(e)]);case 1:return t=n.sent(),r={json:t},this.loadedJSONs.set(e,r),this.module.cw_addJSONToCache(e,t),[2]}}))}))},e.isDeformableLayer=function(e){return void 0!==e.maskJSONPath},e.prototype.preloadFilesForTutorial=function(t){return st(this,void 0,void 0,(function(){var r,n,o,a,i=this;return ut(this,(function(s){switch(s.label){case 0:return r=[],n=function(t){if(t.maskImagePath&&t.maskImagePath.length>0){var n="makeup"===t.blendMode;r.push(i.preloadMask(t.maskImagePath,n,!1)),"makeupBlend"!==t.blendMode&&"alphaBlend"!==t.blendMode||r.push(i.preloadMask("white.png",!0,!0))}e.isDeformableLayer(t)&&(t.maskJSONPath&&t.maskJSONPath.length>0&&r.push(i.preloadJSON(t.maskJSONPath)),t.eraseMasks&&t.eraseMasks.forEach((function(e){e.maskImagePath&&e.maskImagePath.length>0&&r.push(i.preloadMask(e.maskImagePath,!0,!1)),e.maskJSONPath&&e.maskJSONPath.length>0&&r.push(i.preloadJSON(e.maskJSONPath))})))},o=function(e){e.forEach((function(e){r.push(i.preloadMask(e.path,e.isGrayscale,e.isBuiltInResource))}))},a=function(e){var t;(null===(t=e.product)||void 0===t?void 0:t.skinGlow)>0&&o([{path:"GlowMasksCropped2.png",isGrayscale:!1,isBuiltInResource:!0},{path:"white.png",isGrayscale:!0,isBuiltInResource:!0}])},t.steps.forEach((function(e){var t,r;if(e.blushLayer&&(n(e.blushLayer),o([{path:"Blush/blush_drop_4_sub_left_2.png",isGrayscale:!0,isBuiltInResource:!0},{path:"Blush/blush_drop_for_outline.png",isGrayscale:!0,isBuiltInResource:!0}])),e.eyeLinerLayer&&n(e.eyeLinerLayer),e.mascaraLayer&&n(e.mascaraLayer),e.eyeShadowLayer&&n(e.eyeShadowLayer),e.concealerLayer&&(n(e.concealerLayer),a(e.concealerLayer)),(null===(r=null===(t=e.lipstickLayer)||void 0===t?void 0:t.product)||void 0===r?void 0:r.envMappingIntensity)>0){var i=[{path:"map6_normals.png",isGrayscale:!1,isBuiltInResource:!0}];void 0!==e.lipstickLayer.presetStyle&&"brilliant"===e.lipstickLayer.presetStyle?i.push({path:"cube2.png",isGrayscale:!1,isBuiltInResource:!0}):i.push({path:"cube3.png",isGrayscale:!1,isBuiltInResource:!0}),o(i)}})),this.loadTutorialResourcesInParallel?[4,Promise.all(r)]:[3,2];case 1:case 3:return s.sent(),[2];case 2:return[4,r.reduce((function(e,t){return e.then((function(){return t}))}),Promise.resolve())]}}))}))},e.prototype.destroy=function(){this.module&&this.cameraArrayPtr&&this.module._free(this.cameraArrayPtr)},e.prototype.setLoadImageHandler=function(e){this.loadImageHandler=e},e.prototype.setLoadJSONHandler=function(e){this.loadJSONHandler=e},e.prototype.setTutorial=function(e){return st(this,void 0,void 0,(function(){var t;return ut(this,(function(r){switch(r.label){case 0:return this.currentTutorial=ct(e),[4,this.preloadFilesForTutorial(this.currentTutorial)];case 1:return r.sent(),t=function(e){return JSON.stringify(e)}(this.currentTutorial),this.module?this.module.cw_setTutorial(t):this.log("setTutorial: module not loaded"),[2]}}))}))},e.prototype.getTutorialData=function(){return ct(this.currentTutorial)},e.prototype.setTutorialStep=function(e){this.module&&this.module.cw_setStepIndex(e)},e.prototype.setFaceTrackerData=function(e,t,r,n,o,a,i){if(this.module){var s=tt.serialize(e);this.module.cw_setFaceTrackerData(s,s.length,t,r,n,o,a,i)}},e.prototype.resetTrackerData=function(){this.module&&this.module.cw_resetTrackerData()},e.prototype.startTutorial=function(){this.module&&this.module.cw_startTutorial()},e.prototype.pauseTutorial=function(){this.module&&this.module.cw_pauseTutorial()},e.prototype.resumeTutorial=function(){this.module&&this.module.cw_resumeTutorial()},e.prototype.stopTutorial=function(){this.module&&this.module.cw_stopTutorial()},e.prototype.shouldDrawMakeup=function(){return!!this.module&&this.module.cw_shouldDrawMakeup()},e.prototype.shouldDrawTutorial=function(){return!!this.module&&this.module.cw_shouldDrawTutorial()},e.prototype.getProgress=function(){return this.module?this.module.cw_getProgress():0},e.prototype.setPlayCount=function(e){this.module&&this.module.cw_setPlayCount(e)},e.prototype.setStepAnimationDuration=function(e){this.module&&this.module.cw_setStepAnimationDuration(e)},e.prototype.setDelayBeforeRepeat=function(e){this.module&&this.module.cw_setDelayBeforeRepeat(e)},e.prototype.setShowMakeupWhenStepDone=function(e){this.module&&this.module.cw_setShowMakeupWhenStepDone(e)},e.prototype.setShouldDrawOriginal=function(e){this.module&&this.module.cw_setShouldDrawOriginal(e)},e.prototype.render=function(e,t,r){Xe(t*r*4===e.byteLength),this.module?(this.allocateCameraBuffer(t,r),this.cameraArray.set(e),this.module.cw_render(t,r,this.cameraArrayPtr)):this.log("render: module not loaded")},e.prototype.resizeView=function(e,t){Xe(e>0&&t>0,"New view dimensions cannot be zero"),this.module&&this.module.cw_resizeView(e,t)},e.prototype.redraw=function(){this.module&&this.cameraArrayPtr&&this.module.cw_render(this.cameraWidth,this.cameraHeight,this.cameraArrayPtr)},e}();Je.Color;var ft=function(){function e(t){a(this,e),this.hasRendered=!1,this.mediaData=null,this.tutorialRenderer=null,this.outputCanvas=null,this.currentImageData=null,this.width=0,this.height=0,this.currentLookId=null,this.lookIdToTutorialInfo={},this.resourceResolver=t}var t,r,n,i,u;return s(e,[{key:"loadTutorialLibrary",value:(u=o(v.mark((function t(){var r,n,o,a,i,s,u;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!=typeof TutorialCoreSDK){t.next=11;break}return r=[],n=MF_MODULE_LOADER,o=n.dataPromises,a=n.wasmModulePromises,i=o.tutorialCoreSDK,s=a.tutorialCoreSDKWasm,r=Promise.all([i,s]).then((function(t){var r=Ye(t,2),n=r[0],o=r[1];eval.call(window,n),e.tutorialData={tutorialCoreWasmModule:o}})),u="".concat(MF_MODULE_LOADER.tutorialDistFolderUrl,"/TutorialCoreSDKWrapper.js"),t.next=9,import(u);case 9:return this.tutorialModule=t.sent,t.abrupt("return",r);case 11:return t.abrupt("return",Promise.resolve());case 12:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"init",value:(i=o(v.mark((function t(r){var n=this;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.tutorialStepIndex=0,this.outputCanvas=r,this.loadTutorialLibrary().then((function(){return n.tutorialRenderer=new ht(TutorialCoreSDK),n.tutorialRenderer.setLoadImageHandler((function(e,t,r){return ze(e,t,r,n.resourceResolver,!0)})),n.tutorialRenderer.setLoadJSONHandler((function(e){return He(e,!1,n.resourceResolver)})),n.tutorialRenderer.instantiateWasmOverride=function(t,r){return WebAssembly.instantiate(e.tutorialData.tutorialCoreWasmModule,t).then((function(e){r(e)})),{}},n.tutorialRenderer.load(n.outputCanvas,n.outputCanvas.width,n.outputCanvas.height)})).then((function(){n.tutorialLoaded=!0}));case 3:case"end":return t.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})},{key:"setMediaData",value:function(e){var t;if(e instanceof je||O("Type error"),this.mediaData=e,e.canvas.width!==this.outputCanvas.width||e.canvas.height!==this.outputCanvas.height){var r=e.canvas.width,n=e.canvas.height;this.resize(r,n)}var o=e.imageData;if((null===(t=e.detectionResult)||void 0===t||null===(t=t.faces)||void 0===t?void 0:t.length)>0){var a=[];e.detectionResult.faces.forEach((function(e){var t=Ue(e.facePoints);a.push({facePts:t,faceboxX:e.facebox.x,faceboxY:e.facebox.y,faceboxWidth:e.facebox.width,faceboxHeight:e.facebox.height,mouthOpenOverride:"unset"})}));var i={imageWidth:e.imageData.width,imageHeight:e.imageData.height,faceData:a};this.tutorialRenderer.setFaceTrackerData(a[0].facePts,i.imageWidth,i.imageHeight,a[0].faceboxX,a[0].faceboxY,a[0].faceboxWidth,a[0].faceboxWidth)}else this.tutorialRenderer.resetTrackerData();this.currentImageData=o.data,this.width=o.width,this.height=o.height}},{key:"render",value:function(){this.tutorialRenderer.render(this.currentImageData,this.width,this.height),this.hasRendered=!0}},{key:"resize",value:function(e,t){var r;("number"!=typeof e||"number"!=typeof t||e<0||t<0)&&O("Invalid arguments to resize"),this.outputCanvas.width=e,this.outputCanvas.height=t,null===(r=this.tutorialRenderer)||void 0===r||r.resizeView(e,t)}},{key:"destroy",value:function(){this.tutorialRenderer.destroy(),this.tutorialRenderer=null}},{key:"resetTrackerData",value:function(){this.tutorialRenderer.resetTrackerData()}},{key:"getShouldDrawMakeup",value:function(){return this.tutorialRenderer.shouldDrawMakeup()}},{key:"createTutorial",value:(n=o(v.mark((function e(t,r,n,o){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.lookIdToTutorialInfo[r]={tutorialData:t,faceEffects:n,faceChart:o,requiresUpdate:!0};case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,o){return n.apply(this,arguments)})},{key:"removeTutorial",value:function(e){delete this.lookIdToTutorialInfo[e]}},{key:"setLook",value:(r=o(v.mark((function t(r){var n,o,a;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=this.lookIdToTutorialInfo[r])||O("Cannot use a lookId ".concat(r," that does not exist")),this.currentLookId===r&&!n.requiresUpdate){t.next=12;break}if(!this.tutorialRenderer){t.next=11;break}return o=n.tutorialData,this.tutorialRenderer.setShouldDrawOriginal(!1),a=e.convertTutorialLayersFromLegacyToLite(o),t.next=9,this.tutorialRenderer.setTutorial(a);case 9:this.tutorialRenderer.startTutorial(),n.requiresUpdate=!1;case 11:this.currentLookId=r;case 12:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateMakeupLookFromTutorialSteps",value:(t=o(v.mark((function t(r,n){var o,a,i,s,u,l;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this.lookIdToTutorialInfo[r]){t.next=3;break}return t.abrupt("return");case 3:return a=this.getShouldDrawMakeup()?this.getTutorialStep():this.getTutorialStep()-1,i=o.tutorialData,s=o.faceEffects,u=o.faceChart,l={},a>=0&&(l=e.createMakeupLookFromSteps(i,a)),t.next=9,n.createLook(l,r,s,u,!0);case 9:return t.next=11,n.setLook(r);case 11:case"end":return t.stop()}}),t,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"getHasTutorial",value:function(){return!!this.currentLookId}},{key:"startTutorial",value:function(){this.tutorialRenderer&&this.tutorialRenderer.startTutorial()}},{key:"pauseTutorial",value:function(){this.tutorialRenderer&&this.tutorialRenderer.pauseTutorial()}},{key:"resumeTutorial",value:function(){this.tutorialRenderer&&this.tutorialRenderer.resumeTutorial()}},{key:"getTutorialStep",value:function(){return this.tutorialStepIndex}},{key:"setTutorialStep",value:function(e){this.tutorialStepIndex=e,this.tutorialRenderer.setTutorialStep(e)}},{key:"setPlayCount",value:function(e){this.tutorialRenderer.setPlayCount(e)}},{key:"stopTutorial",value:function(){this.tutorialRenderer&&this.tutorialRenderer.stopTutorial()}}],[{key:"convertTutorialLayersFromLegacyToLite",value:function(e){if(!e||!e.steps)return null;var t=JSON.parse(JSON.stringify(e));return t.steps.forEach((function(e){var t=e.layer,r=e.category;if(t){var n,o,a={};if("MFEMakeupProductCategoryLip"===r)a.lipLayers=[t],n="lipLayers",o="lipstickLayer";else if("MFEMakeupProductCategoryLipLiner"===r)a.lipLinerLayer=t,n="lipLinerLayer",o="makeupLayer";else if("MFEMakeupProductCategoryBlush"===r)a.blushLayers=[t],n="blushLayers",o="blushLayer";else if("MFEMakeupProductCategoryHighlight"===r)a.blushLayers=[t],n="blushLayers",o="blushLayer";else if("MFEMakeupProductCategoryContour"===r)a.blushLayers=[t],n="blushLayers",o="blushLayer";else if("MFEMakeupProductCategoryEyeLiner"===r)a.eyeLinerLayers=[t],n="eyeLinerLayers",o="eyeLinerLayer";else if("MFEMakeupProductCategoryMascara"===r)a.mascaraLayers=[t],n="mascaraLayers",o="mascaraLayer";else if("MFEMakeupProductCategoryEyeShadow"===r)a.eyeShadowLayers=[t],n="eyeShadowLayers",o="eyeShadowLayer";else if("MFEMakeupProductCategoryFoundation"===r)a.foundationLayer=t,n="foundationLayer",o="foundationLayer";else if("MFEMakeupProductCategoryBrow"===r)a.browEffectsLayer=t,n="browLayer",o="makeupLayer";else if("MFEMakeupProductCategoryConcealer"===r)a.concealerLayer=t,n="concealerLayer",o="concealerLayer";else{if("MFEMakeupProductCategoryPrimer"!==r)return;a.primerLayer=t,n="primerLayer",o="foundationLayer"}var i=Ee(a),s=Array.isArray(i[n])?i[n][0]:i[n];if("MFEMakeupProductCategoryBrow"===r){var u=s.coloringParams;s={product:{r:u.colorR,g:u.colorG,b:u.colorB,amount:u.colorAmount,glitter:u.sparkleIntensity,glitterDensity:u.sparkleDensity,glitterColorR:u.sparkleR,glitterColorG:u.sparkleG,glitterColorB:u.sparkleB,glitterSize:u.sparkleSize,glitterBaseReflectivity:u.sparkleBaseReflectivity,glitterColorVariation:u.sparkleColorVariation,glitterSizeVariation:u.sparkleSizeVariation,useLegacyGlitter:u.useLegacyGlitter}}}delete e.layer,e[o]=s}})),t}},{key:"createMakeupLookFromSteps",value:function(e,t){for(var r,n,o=function(e,t){return e?(e.push(t),e):[t]},a=new H,i=Math.min(null!==(r=null==e||null===(n=e.steps)||void 0===n?void 0:n.length)&&void 0!==r?r:0,t+1),s=0;s<i;s+=1){var u=e.steps[s];"MFEMakeupProductCategoryEyeShadow"===u.category?a.eyeShadowLayers=o(a.eyeShadowLayers,u.layer):"MFEMakeupProductCategoryMascara"===u.category?a.mascaraLayers=o(a.mascaraLayers,u.layer):"MFEMakeupProductCategoryLip"===u.category?a.lipLayers=o(a.lipLayers,u.layer):"MFEMakeupProductCategoryBlush"===u.category?a.blushLayers=o(a.blushLayers,u.layer):"MFEMakeupProductCategoryEyeLiner"===u.category?a.eyeLinerLayers=o(a.eyeLinerLayers,u.layer):"MFEMakeupProductCategoryConcealer"===u.category?a.concealerLayer=u.layer:"MFEMakeupProductCategoryLipLiner"===u.category?a.lipLinerLayer=u.layer:"MFEMakeupProductCategoryFoundation"===u.category?a.foundationLayer=u.layer:"MFEMakeupProductCategoryPrimer"===u.category?a.primerLayer=u.layer:"MFEMakeupProductCategoryBrow"===u.category&&(a.browEffectsLayer=u.layer)}return a}}]),e}(),dt=function(){function e(){a(this,e),this.sourceCanvas=null,this.outputCanvases={}}return s(e,[{key:"getNumDisplays",value:function(){return Object.keys(this.outputCanvases).length}},{key:"toDataURL",value:function(){return this.sourceCanvas.toDataURL()}},{key:"setSource",value:function(e){e instanceof HTMLCanvasElement||O("setSource called with something that is not a canvas element"),this.sourceCanvas=e}},{key:"destroy",value:function(){}},{key:"update",value:function(e){this.sourceCanvas instanceof HTMLCanvasElement||O("Need a source canvas");var t=this.outputCanvases[e];t||O("Attempted to update a canvId that does not exist"),this.sourceCanvas.width===t.width&&this.sourceCanvas.height===t.height||(t.width=this.sourceCanvas.width,t.height=this.sourceCanvas.height),e!==this.sourceCanvas.id&&t.getContext("2d").drawImage(this.sourceCanvas,0,0,t.width,t.height)}},{key:"updateAll",value:function(){var e=this;Object.keys(this.outputCanvases).forEach((function(t){e.update(t)}))}},{key:"display",value:function(e,t,r){var n=this.outputCanvases[t]||this.createCanvas(t);document.getElementById(e).appendChild(n),n.setAttribute("id",t),void 0!==r&&n.setAttribute("class",r),this.outputCanvases[t]=n}},{key:"displaySource",value:function(e,t,r){var n=this.sourceCanvas;document.getElementById(e).appendChild(n),n.setAttribute("id",t),void 0!==r&&n.setAttribute("class",r),this.outputCanvases[t]=n}},{key:"displaySDK",value:function(e){var t=this.outputCanvases[e];return t||(this.createCanvas(e),t=this.outputCanvases[e]),this.update(e),t.setAttribute("id",e),t}},{key:"displaySourceSDK",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.outputCanvases[e],n=r;return r||(n=I(this.sourceCanvas.width,this.sourceCanvas.height),!this.sourceCanvas.getContext("2d")&&t||n.getContext("2d").drawImage(this.sourceCanvas,0,0,this.sourceCanvas.width,this.sourceCanvas.height)),n.setAttribute("id",e),this.outputCanvases[e]=n,n}},{key:"outputCanvasExisted",value:function(e){return!!(this.outputCanvases[e]&&this.outputCanvases[e]instanceof HTMLCanvasElement)}},{key:"createCanvas",value:function(e){var t,r;if(this.sourceCanvas){var n=this.sourceCanvas;t=n.width,r=n.height}else t=100,r=100;this.outputCanvases[e]=I(t,r)}},{key:"undisplay",value:function(e){this.outputCanvases[e]&&this.outputCanvases[e]instanceof HTMLCanvasElement&&this.outputCanvases[e].remove(),delete this.outputCanvases[e]}}]),e}(),pt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a(this,e),this.name=t,this.times=[],this.currentStart=null,this.maxWindowSize=25}return s(e,[{key:"begin",value:function(){this.currentStart=performance.now()}},{key:"end",value:function(){if(this.currentStart){var e=performance.now()-this.currentStart;this.times.push(e),this.times.length>this.maxWindowSize&&this.times.shift(),this.currentStart=null}}},{key:"getAverageTime",value:function(){return 0===this.times.length?0:this.times.reduce((function(e,t){return e+t}))/this.times.length}},{key:"getAverageFPS",value:function(){var e=this.getAverageTime();return e>0?1e3/e:0}}]),e}(),mt=function(){function e(){a(this,e),this.makeupRenderer=null,this.tutorialRenderer=null,this.maxFaces=1,this.beforeEffectsDisplayer=null,this.afterEffectsDisplayer=null,this.lookIdToCanvasIds={},this.canvasIdToLookId={},this.lookIdType={},this.singleDefaultId="SINGLE_DEFAULT",this.mediaData=null,this.mode=null,this.targetWidth=null,this.targetHeight=null,this.trueWidth=null,this.trueHeight=null,this.hasValidFace=!1,this.eventQueue={},this.eventToListeners={},this.detectFaceMasks=!1,this.setTutorialMakeupLookPromise=Promise.resolve(),this.performanceData={reset:function(){this.renderTime=new pt,this.frameToFrameTime=new pt},getAverages:function(){return{avgRenderTime:this.renderTime.getAverageTime(),avgFrameToFrameTime:this.frameToFrameTime.getAverageTime()}}},this.performanceData.reset()}var t,r,n,i,u,l,c,h,f,d,p;return s(e,[{key:"fireEventListener",value:function(e,t){this.eventToListeners[e]&&this.eventToListeners[e].forEach((function(e){return e(t)}))}},{key:"addEventListener",value:function(e,t){this.eventToListeners[e]||(this.eventToListeners[e]=new Set),this.eventToListeners[e].add(t)}},{key:"removeEventListener",value:function(e,t){this.eventToListeners[e]&&this.eventToListeners[e].delete(t)}},{key:"create",value:function(e){var t=e.resourceResolver,r=void 0===t?null:t;this.makeupRenderer&&O("Create was called before already. Re-creation is not supported."),r||O("An instance of MakeupResourceResolver must be passed into create(params) for params.resourceResolver");var n=[];return this.makeupRenderer=new Ge(r),n.push(this.makeupRenderer.init(1,1)),this.afterEffectsDisplayer=new dt,this.beforeEffectsDisplayer=new dt,MF_MODULE_LOADER.config.shouldLoadTutorial&&(this.tutorialRenderer=new ft(r),n.push(this.tutorialRenderer.init(this.makeupRenderer.getOutputCanvas()))),Promise.all(n)}},{key:"getSourceWidth",value:function(){return this.getMediaSource().getWidth()}},{key:"getSourceHeight",value:function(){return this.getMediaSource().getHeight()}},{key:"destroy",value:function(){this.makeupRenderer.destroy(),this.eventToListeners={},this.makeupRenderer=null}},{key:"show",value:(p=o(v.mark((function e(t){var r,n,o,a,i,s,u;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.view,n=t.canvId,o=t.canvClass,a=t.lookId,i=void 0===a?this.singleDefaultId:a,s=t.updateCanvas,u=void 0!==s&&s,n||O("Need a proper canvasId"),this.lookIdToCanvasIds[i]||(this.lookIdToCanvasIds[i]=[]),this.lookIdToCanvasIds[i].includes(n)||this.lookIdToCanvasIds[i].push(n),this.canvasIdToLookId[n]=i,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.afterEffectsDisplayer.createCanvas(n),e.t0=u,e.t0){e.next=15;break}if(e.t1="photo"===this.mode,!e.t1){e.next=14;break}return e.next=13,this.updateLook(i);case 13:e.t1=e.sent;case 14:e.t0=e.t1;case 15:if(!e.t0){e.next=17;break}this.afterEffectsDisplayer.update(n);case 17:this.afterEffectsDisplayer.display(r,n,o),this.canvasDidChangeLook();case 19:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"showSDK",value:(d=o(v.mark((function e(t){var r,n=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:this.singleDefaultId,t||O("Need a proper canvasId"),this.lookIdToCanvasIds[r]||(this.lookIdToCanvasIds[r]=[]),this.lookIdToCanvasIds[r].includes(t)||this.lookIdToCanvasIds[r].push(t),this.canvasIdToLookId[t]=r,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.afterEffectsDisplayer.outputCanvasExisted(t)||this.afterEffectsDisplayer.createCanvas(t),e.next=9,this.updateLook(r);case 9:if(!e.sent){e.next=11;break}this.afterEffectsDisplayer.update(t);case 11:return this.canvasDidChangeLook(),e.abrupt("return",this.afterEffectsDisplayer.displaySDK(t));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"hide",value:function(e){var t=this.canvasIdToLookId[e];t||O("The canvas that you are trying to hide was never created through show.");for(var r=this.lookIdToCanvasIds[t],n=0;n<r.length;n+=1)if(e===r[n]){r.splice(n,1);break}delete this.canvasIdToLookId[e],this.afterEffectsDisplayer.undisplay(e),this.canvasDidChangeLook()}},{key:"showRendererCanvas",value:function(e){var t=e.view,r=e.canvId,n=e.canvClass,o=e.lookId,a=void 0===o?this.singleDefaultId:o;r||O("Need a proper canvasId"),this.lookIdToCanvasIds[a]||(this.lookIdToCanvasIds[a]=[]),this.lookIdToCanvasIds[a].includes(r)||this.lookIdToCanvasIds[a].push(r),this.canvasIdToLookId[r]=a,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.afterEffectsDisplayer.displaySource(t,r,n),this.canvasDidChangeLook()}},{key:"showRendererCanvasSDK",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.singleDefaultId;return e||O("Need a proper canvasId"),this.lookIdToCanvasIds[t]||(this.lookIdToCanvasIds[t]=[]),this.lookIdToCanvasIds[t].includes(e)||this.lookIdToCanvasIds[t].push(e),this.canvasIdToLookId[e]=t,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.canvasDidChangeLook(),this.afterEffectsDisplayer.displaySourceSDK(e,"live"===this.mode)}},{key:"showOriginal",value:function(e){var t=e.view,r=e.canvId,n=e.canvClass;this.beforeEffectsDisplayer.createCanvas(r),this.beforeEffectsDisplayer.display(t,r,n),"photo"===this.mode&&this.beforeEffectsDisplayer.updateAll()}},{key:"showOriginalSource",value:function(e){var t=e.view,r=e.canvId,n=e.canvClass;this.beforeEffectsDisplayer.displaySource(t,r,n)}},{key:"showOriginalSDK",value:function(e){return this.beforeEffectsDisplayer.displaySDK(e)}},{key:"showOriginalSourceSDK",value:function(e){return this.beforeEffectsDisplayer.displaySourceSDK(e,"live"===this.mode)}},{key:"hideOriginal",value:function(e){this.beforeEffectsDisplayer.undisplay(e),this.beforeEffectsDisplayer.getNumDisplays()<=0&&this.makeupRenderer.setShouldKeepOriginal(!1)}},{key:"createLook",value:(f=o(v.mark((function e(t,r,n,o){var a,i=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(i.length>4&&void 0!==i[4])||i[4],this.lookIdToCanvasIds[r]||(this.lookIdToCanvasIds[r]=[]),this.lookIdType[r]="look",e.next=5,this.setTutorialMakeupLookPromise;case 5:return e.next=7,this.makeupRenderer.createLook(t,r,n,o,a);case 7:if("photo"!==this.mode){e.next=10;break}return e.next=10,this.redrawOutputs([r]);case 10:this.lookIdToCanvasIds[r].length>0&&this.canvasDidChangeLook();case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return f.apply(this,arguments)})},{key:"createTutorial",value:(h=o(v.mark((function e(t,r){var n,o,a=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:null,o=a.length>3&&void 0!==a[3]&&a[3],this.checkIfTutorialLoaded(),e.next=5,this.tutorialRenderer.createTutorial(t,r,n,o);case 5:if(this.tutorialRenderer.startTutorial(),this.lookIdToCanvasIds[r]||(this.lookIdToCanvasIds[r]=[]),this.lookIdType[r]="tutorial","photo"!==this.mode){e.next=11;break}return e.next=11,this.redrawOutputs([r]);case 11:this.lookIdToCanvasIds[r].length>0&&this.canvasDidChangeLook();case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"redrawOutputs",value:(c=o(v.mark((function e(){var t,r,n,o=this,a=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:null,r=null!=t?t:Object.keys(this.lookIdToCanvasIds),n=Promise.resolve(),r.forEach((function(e){n=n.then((function(){return o.updateLook(e).then((function(t){if(t)for(var r=o.lookIdToCanvasIds[e],n=0;n<r.length;n+=1)o.afterEffectsDisplayer.update(r[n])}))}))})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"setBaseLook",value:(l=o(v.mark((function e(t){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeupRenderer.setBaseLook(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setSmoothingIntensity",value:function(e){this.makeupRenderer.setSmoothingIntensity(e)}},{key:"setShowDebugPoints",value:function(e){this.makeupRenderer.setShouldShowPoints(e)}},{key:"getDetectionResult",value:function(){O("Override please.")}},{key:"isMouthOpen",value:function(){return this.makeupRenderer.isMouthOpen()}},{key:"setMouthOpen",value:function(e){if("boolean"!=typeof e)throw new TypeError;this.makeupRenderer.setMouthOpen(e)}},{key:"unsetMouthOpen",value:function(){this.makeupRenderer.unsetMouthOpen()}},{key:"isFoundationCloseMatch",value:function(){return this.makeupRenderer.isFoundationCloseMatch()}},{key:"setMaxFaces",value:function(e){this.maxFaces=e}},{key:"getMaxFaces",value:function(){return this.maxFaces}},{key:"removeMakeupLook",value:function(e){this.makeupRenderer.removeLook(e)}},{key:"removeTutorial",value:function(e){this.checkIfTutorialLoaded(),this.tutorialRenderer.removeTutorial(e)}},{key:"captureAfter",value:(u=o(v.mark((function e(){var t,r,n=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.singleDefaultId,r=n.length>1&&void 0!==n[1]?n[1]:"png",e.next=4,this.updateLook(t);case 4:return e.abrupt("return",this.makeupRenderer.getOutputCanvas().toDataURL("image/".concat(r)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"captureBefore",value:(i=o(v.mark((function e(){var t,r=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"png",e.abrupt("return",this.beforeEffectsCanvas.toDataURL("image/".concat(t)));case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getMediaSource",value:function(){O("Override please.")}},{key:"getSource",value:function(){return this.getMediaSource().getSource()}},{key:"setDetectFaceMasks",value:function(e){this.detectFaceMasks=e}},{key:"setTintEffect",value:(n=o(v.mark((function e(t){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeupRenderer.setTintEffect(t);case 2:if("photo"!==this.mode){e.next=5;break}return e.next=5,this.redrawOutputs();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getTintEffect",value:function(){return this.makeupRenderer.getTintEffect()}},{key:"render",value:(r=o(v.mark((function e(t){var r,n,a=this;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||(this.fireEventListener("frame_rendered"),O("mediaData that was passed to render is invalid.")),this.performanceData.frameToFrameTime.end(),this.performanceData.frameToFrameTime.begin(),this.performanceData.renderTime.begin(),"live"===this.mode&&mfBroadcast(_.EventStage.RENDER_START),this.beforeEffectsCanvas=t.canvas,this.makeupRenderer.setMediaData(t),null===(r=this.tutorialRenderer)||void 0===r||r.setMediaData(t),this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.beforeEffectsDisplayer.setSource(this.beforeEffectsCanvas),n=Promise.resolve(),Object.keys(this.lookIdToCanvasIds).forEach((function(e){n=n.then(o(v.mark((function t(){var r,n;return v.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((r=a.lookIdToCanvasIds[e]).length>0)){t.next=4;break}return t.next=4,a.updateLook(e);case 4:for(n=0;n<r.length;n+=1)a.afterEffectsDisplayer.update(r[n]);case 5:case"end":return t.stop()}}),t)}))))})),e.next=14,n;case 14:this.beforeEffectsDisplayer.updateAll(),this.performanceData.renderTime.end(),"live"===this.mode&&mfBroadcast(_.EventStage.RENDER_END),this.fireEventListener("frame_rendered",t.detectionResult);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateLook",value:(t=o(v.mark((function e(t){var r,n,o;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.makeupRenderer.mediaData){e.next=2;break}return e.abrupt("return",!1);case 2:if(r="tutorial"===this.lookIdType[t],n="look"===this.lookIdType[t],!r){e.next=13;break}return this.checkIfTutorialLoaded(),e.next=8,this.tutorialRenderer.setLook(t);case 8:return this.setTutorialMakeupLookPromise=this.tutorialRenderer.updateMakeupLookFromTutorialSteps(t,this.makeupRenderer),e.next=11,this.setTutorialMakeupLookPromise;case 11:e.next=16;break;case 13:if(!n||!this.makeupRenderer.hasLook(t)){e.next=16;break}return e.next=16,this.makeupRenderer.setLook(t);case 16:return this.makeupRenderer.render(),r&&(null===(o=this.tutorialRenderer)||void 0===o||o.render()),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"canvasDidChangeLook",value:function(){}},{key:"checkIfTutorialLoaded",value:function(){if(!this.tutorialRenderer)throw new Error("The tutorial feature was not loaded")}},{key:"startTutorial",value:function(){this.checkIfTutorialLoaded(),this.tutorialRenderer.startTutorial()}},{key:"pauseTutorial",value:function(){this.checkIfTutorialLoaded(),this.tutorialRenderer.pauseTutorial()}},{key:"resumeTutorial",value:function(){this.checkIfTutorialLoaded(),this.tutorialRenderer.resumeTutorial()}},{key:"getTutorialStep",value:function(){return this.checkIfTutorialLoaded(),this.tutorialRenderer.getTutorialStep()}},{key:"setTutorialStep",value:function(e){this.checkIfTutorialLoaded(),this.tutorialRenderer.setTutorialStep(e)}},{key:"setTutorialPlayCount",value:function(e){this.checkIfTutorialLoaded(),this.tutorialRenderer.setPlayCount(e)}},{key:"stopTutorial",value:function(){this.checkIfTutorialLoaded(),this.tutorialRenderer.stopTutorial()}}]),e}(),gt={exports:{}};gt.exports=function(){var e={VERSION:"0.8.0",not:{},all:{},any:{}},t=Object.prototype.toString,r=Array.prototype.slice,n=Object.prototype.hasOwnProperty;function o(e){return function(){return!e.apply(null,r.call(arguments))}}function a(e){return function(){for(var t=l(arguments),r=t.length,n=0;n<r;n++)if(!e.call(null,t[n]))return!1;return!0}}function i(e){return function(){for(var t=l(arguments),r=t.length,n=0;n<r;n++)if(e.call(null,t[n]))return!0;return!1}}var s={"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return e>t},">=":function(e,t){return e>=t}};function u(e,t){var r=t+"",n=+(r.match(/\d+/)||NaN),o=r.match(/^[<>]=?|/)[0];return s[o]?s[o](e,n):e==n||n!=n}function l(t){var n=r.call(t);return 1===n.length&&e.array(n[0])&&(n=n[0]),n}e.arguments=function(e){return"[object Arguments]"===t.call(e)||null!=e&&"object"==typeof e&&"callee"in e},e.array=Array.isArray||function(e){return"[object Array]"===t.call(e)},e.boolean=function(e){return!0===e||!1===e||"[object Boolean]"===t.call(e)},e.char=function(t){return e.string(t)&&1===t.length},e.date=function(e){return"[object Date]"===t.call(e)},e.domNode=function(t){return e.object(t)&&t.nodeType>0},e.error=function(e){return"[object Error]"===t.call(e)},e.function=function(e){return"[object Function]"===t.call(e)||"function"==typeof e},e.json=function(e){return"[object Object]"===t.call(e)},e.nan=function(e){return e!=e},e.null=function(e){return null===e},e.number=function(r){return e.not.nan(r)&&"[object Number]"===t.call(r)},e.object=function(e){return Object(e)===e},e.regexp=function(e){return"[object RegExp]"===t.call(e)},e.sameType=function(r,n){var o=t.call(r);return o===t.call(n)&&("[object Number]"!==o||!e.any.nan(r,n)||e.all.nan(r,n))},e.sameType.api=["not"],e.string=function(e){return"[object String]"===t.call(e)},e.undefined=function(e){return void 0===e},e.windowObject=function(e){return null!=e&&"object"==typeof e&&"setInterval"in e},e.empty=function(t){if(e.object(t)){var r=Object.getOwnPropertyNames(t).length;return!!(0===r||1===r&&e.array(t)||2===r&&e.arguments(t))}return""===t},e.existy=function(e){return null!=e},e.falsy=function(e){return!e},e.truthy=o(e.falsy),e.above=function(t,r){return e.all.number(t,r)&&t>r},e.above.api=["not"],e.decimal=function(t){return e.number(t)&&t%1!=0},e.equal=function(t,r){return e.all.number(t,r)?t===r&&1/t==1/r:e.all.string(t,r)||e.all.regexp(t,r)?""+t==""+r:!!e.all.boolean(t,r)&&t===r},e.equal.api=["not"],e.even=function(t){return e.number(t)&&t%2==0},e.finite=isFinite||function(t){return e.not.infinite(t)&&e.not.nan(t)},e.infinite=function(e){return e===1/0||e===-1/0},e.integer=function(t){return e.number(t)&&t%1==0},e.negative=function(t){return e.number(t)&&t<0},e.odd=function(t){return e.number(t)&&t%2==1},e.positive=function(t){return e.number(t)&&t>0},e.under=function(t,r){return e.all.number(t,r)&&t<r},e.under.api=["not"],e.within=function(t,r,n){return e.all.number(t,r,n)&&t>r&&t<n},e.within.api=["not"];var c={affirmative:/^(?:1|t(?:rue)?|y(?:es)?|ok(?:ay)?)$/,alphaNumeric:/^[A-Za-z0-9]+$/,caPostalCode:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s?[0-9][A-Z][0-9]$/,creditCard:/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,dateString:/^(1[0-2]|0?[1-9])([\/-])(3[01]|[12][0-9]|0?[1-9])(?:\2)(?:[0-9]{2})?[0-9]{2}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,eppPhone:/^\+[0-9]{1,3}\.[0-9]{4,14}(?:x.+)?$/,hexadecimal:/^(?:0x)?[0-9a-fA-F]+$/,hexColor:/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,nanpPhone:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,socialSecurityNumber:/^(?!000|666)[0-8][0-9]{2}-?(?!00)[0-9]{2}-?(?!0000)[0-9]{4}$/,timeString:/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/,ukPostCode:/^[A-Z]{1,2}[0-9RCHNQ][0-9A-Z]?\s?[0-9][ABD-HJLNP-UW-Z]{2}$|^[A-Z]{2}-?[0-9]{4}$/,url:/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i,usZipCode:/^[0-9]{5}(?:-[0-9]{4})?$/};function h(t,r){e[t]=function(e){return r[t].test(e)}}for(var f in c)c.hasOwnProperty(f)&&h(f,c);e.ip=function(t){return e.ipv4(t)||e.ipv6(t)},e.capitalized=function(t){if(e.not.string(t))return!1;for(var r=t.split(" "),n=0;n<r.length;n++){var o=r[n];if(o.length){var a=o.charAt(0);if(a!==a.toUpperCase())return!1}}return!0},e.endWith=function(t,r){if(e.not.string(t))return!1;r+="";var n=t.length-r.length;return n>=0&&t.indexOf(r,n)===n},e.endWith.api=["not"],e.include=function(e,t){return e.indexOf(t)>-1},e.include.api=["not"],e.lowerCase=function(t){return e.string(t)&&t===t.toLowerCase()},e.palindrome=function(t){if(e.not.string(t))return!1;for(var r=(t=t.replace(/[^a-zA-Z0-9]+/g,"").toLowerCase()).length-1,n=0,o=Math.floor(r/2);n<=o;n++)if(t.charAt(n)!==t.charAt(r-n))return!1;return!0},e.space=function(t){if(e.not.char(t))return!1;var r=t.charCodeAt(0);return r>8&&r<14||32===r},e.startWith=function(t,r){return e.string(t)&&0===t.indexOf(r)},e.startWith.api=["not"],e.upperCase=function(t){return e.string(t)&&t===t.toUpperCase()};var d=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],m=["january","february","march","april","may","june","july","august","september","october","november","december"];e.day=function(t,r){return e.date(t)&&r.toLowerCase()===d[t.getDay()]},e.day.api=["not"],e.dayLightSavingTime=function(e){var t=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),6,1),n=Math.max(t.getTimezoneOffset(),r.getTimezoneOffset());return e.getTimezoneOffset()<n},e.future=function(t){var r=new Date;return e.date(t)&&t.getTime()>r.getTime()},e.inDateRange=function(t,r,n){if(e.not.date(t)||e.not.date(r)||e.not.date(n))return!1;var o=t.getTime();return o>r.getTime()&&o<n.getTime()},e.inDateRange.api=["not"],e.inLastMonth=function(t){return e.inDateRange(t,new Date((new Date).setMonth((new Date).getMonth()-1)),new Date)},e.inLastWeek=function(t){return e.inDateRange(t,new Date((new Date).setDate((new Date).getDate()-7)),new Date)},e.inLastYear=function(t){return e.inDateRange(t,new Date((new Date).setFullYear((new Date).getFullYear()-1)),new Date)},e.inNextMonth=function(t){return e.inDateRange(t,new Date,new Date((new Date).setMonth((new Date).getMonth()+1)))},e.inNextWeek=function(t){return e.inDateRange(t,new Date,new Date((new Date).setDate((new Date).getDate()+7)))},e.inNextYear=function(t){return e.inDateRange(t,new Date,new Date((new Date).setFullYear((new Date).getFullYear()+1)))},e.leapYear=function(t){return e.number(t)&&(t%4==0&&t%100!=0||t%400==0)},e.month=function(t,r){return e.date(t)&&r.toLowerCase()===m[t.getMonth()]},e.month.api=["not"],e.past=function(t){var r=new Date;return e.date(t)&&t.getTime()<r.getTime()},e.quarterOfYear=function(t,r){return e.date(t)&&e.number(r)&&r===Math.floor((t.getMonth()+3)/3)},e.quarterOfYear.api=["not"],e.today=function(t){var r=(new Date).toDateString();return e.date(t)&&t.toDateString()===r},e.tomorrow=function(t){var r=new Date,n=new Date(r.setDate(r.getDate()+1)).toDateString();return e.date(t)&&t.toDateString()===n},e.weekend=function(t){return e.date(t)&&(6===t.getDay()||0===t.getDay())},e.weekday=o(e.weekend),e.year=function(t,r){return e.date(t)&&e.number(r)&&r===t.getFullYear()},e.year.api=["not"],e.yesterday=function(t){var r=new Date,n=new Date(r.setDate(r.getDate()-1)).toDateString();return e.date(t)&&t.toDateString()===n};var g=e.windowObject("object"==typeof p&&p)&&p,y=e.windowObject("object"==typeof self&&self)&&self,v=e.windowObject("object"==typeof this&&this)&&this,_=g||y||v||Function("return this")(),w=y&&y.document,k=_.is,b=y&&y.navigator,x=(b&&b.appVersion||"").toLowerCase(),L=(b&&b.userAgent||"").toLowerCase(),E=(b&&b.vendor||"").toLowerCase();function C(){var t=e;for(var r in t)if(n.call(t,r)&&e.function(t[r]))for(var s=t[r].api||["not","all","any"],u=0;u<s.length;u++)"not"===s[u]&&(e.not[r]=o(e[r])),"all"===s[u]&&(e.all[r]=a(e[r])),"any"===s[u]&&(e.any[r]=i(e[r]))}return e.android=function(){return/android/.test(L)},e.android.api=["not"],e.androidPhone=function(){return/android/.test(L)&&/mobile/.test(L)},e.androidPhone.api=["not"],e.androidTablet=function(){return/android/.test(L)&&!/mobile/.test(L)},e.androidTablet.api=["not"],e.blackberry=function(){return/blackberry/.test(L)||/bb10/.test(L)},e.blackberry.api=["not"],e.chrome=function(e){var t=/google inc/.test(E)?L.match(/(?:chrome|crios)\/(\d+)/):null;return null!==t&&u(t[1],e)},e.chrome.api=["not"],e.desktop=function(){return e.not.mobile()&&e.not.tablet()},e.desktop.api=["not"],e.edge=function(e){var t=L.match(/edge\/(\d+)/);return null!==t&&u(t[1],e)},e.edge.api=["not"],e.firefox=function(e){var t=L.match(/(?:firefox|fxios)\/(\d+)/);return null!==t&&u(t[1],e)},e.firefox.api=["not"],e.ie=function(e){var t=L.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==t&&u(t[1],e)},e.ie.api=["not"],e.ios=function(){return e.iphone()||e.ipad()||e.ipod()},e.ios.api=["not"],e.ipad=function(e){var t=L.match(/ipad.+?os (\d+)/);return null!==t&&u(t[1],e)},e.ipad.api=["not"],e.iphone=function(e){var t=L.match(/iphone(?:.+?os (\d+))?/);return null!==t&&u(t[1]||1,e)},e.iphone.api=["not"],e.ipod=function(e){var t=L.match(/ipod.+?os (\d+)/);return null!==t&&u(t[1],e)},e.ipod.api=["not"],e.linux=function(){return/linux/.test(x)},e.linux.api=["not"],e.mac=function(){return/mac/.test(x)},e.mac.api=["not"],e.mobile=function(){return e.iphone()||e.ipod()||e.androidPhone()||e.blackberry()||e.windowsPhone()},e.mobile.api=["not"],e.offline=o(e.online),e.offline.api=["not"],e.online=function(){return!b||!0===b.onLine},e.online.api=["not"],e.opera=function(e){var t=L.match(/(?:^opera.+?version|opr)\/(\d+)/);return null!==t&&u(t[1],e)},e.opera.api=["not"],e.phantom=function(e){var t=L.match(/phantomjs\/(\d+)/);return null!==t&&u(t[1],e)},e.phantom.api=["not"],e.safari=function(e){var t=L.match(/version\/(\d+).+?safari/);return null!==t&&u(t[1],e)},e.safari.api=["not"],e.tablet=function(){return e.ipad()||e.androidTablet()||e.windowsTablet()},e.tablet.api=["not"],e.touchDevice=function(){return!!w&&("ontouchstart"in y||"DocumentTouch"in y&&w instanceof DocumentTouch)},e.touchDevice.api=["not"],e.windows=function(){return/win/.test(x)},e.windows.api=["not"],e.windowsPhone=function(){return e.windows()&&/phone/.test(L)},e.windowsPhone.api=["not"],e.windowsTablet=function(){return e.windows()&&e.not.windowsPhone()&&/touch/.test(L)},e.windowsTablet.api=["not"],e.propertyCount=function(t,r){if(e.not.object(t)||e.not.number(r))return!1;var o=0;for(var a in t)if(n.call(t,a)&&++o>r)return!1;return o===r},e.propertyCount.api=["not"],e.propertyDefined=function(t,r){return e.object(t)&&e.string(r)&&r in t},e.propertyDefined.api=["not"],e.inArray=function(t,r){if(e.not.array(r))return!1;for(var n=0;n<r.length;n++)if(r[n]===t)return!0;return!1},e.inArray.api=["not"],e.sorted=function(t,r){if(e.not.array(t))return!1;for(var n=s[r]||s[">="],o=1;o<t.length;o++)if(!n(t[o],t[o-1]))return!1;return!0},C(),e.setNamespace=function(){return _.is=k,this},e.setRegexp=function(e,t){for(var r in c)n.call(c,r)&&t===r&&(c[r]=e)},e}();var yt=gt.exports;class vt{static log(e){console.log(e)}static warn(e){console.warn(e)}static error(e){console.error(e)}static timeStamp(e){console.timeStamp&&console.timeStamp(e)}}function _t(e){return"number"==typeof e&&!Number.isNaN(e)}class wt{constructor(){this.width=null,this.height=null,this.video=null,this.stream=null,this.imposeContraint=!0,this.facingMode=null,this.deviceId=null}hasStream(){return this.video&&null!=this.video.srcObject}create(e){return new Promise(((t,r)=>{const n=this;if(void 0===e)return vt.error("params must be provided"),void r();const o=e.width,a=e.height,i=e.frameRateConstraint,s=e.resizeModeConstraint,u=e.cameraInfo;n.facingMode=e.facingMode,n.deviceId=e.deviceId,n.video=document.createElement("video"),n.video.setAttribute("playsinline",!0),n.getStream(o,a,i,s,u).then(t).catch(r)}))}getSource(){return this.video}getWidth(){return this.video.videoWidth}getHeight(){return this.video.videoHeight}getStream(e,t,r,n,o){const a=this;return new Promise(((i,s)=>{const u=u=>{a.imposeContraint&&"undefined"!=typeof OverconstrainedError&&u instanceof OverconstrainedError?(vt.error(u),vt.error("re-attempting getUserMedia without constraints (this is likely iOS safari)"),a.imposeContraint=!1,a.getStream(e,t,r,n,o).then(i).catch(s)):(vt.error(u),s())};navigator||u(),navigator.mediaDevices.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.mediaDevices.getUserMedia||u();let l={};if(o)l.deviceId=o.deviceId,l.width=o.width,l.height=o.height,l.aspectRatio=o.aspectRatio,l.frameRate=o.frameRate,l.facingMode=o.facingMode;else if(l.facingMode={ideal:a.facingMode},null!==a.deviceId&&(l.deviceId={ideal:a.deviceId}),"crop-and-scale"!=n&&"none"!=n||(l.resizeMode={ideal:n}),_t(r)&&_t(e)&&_t(t)&&this.imposeContraint){const n=window.matchMedia("(orientation: portrait)").matches,o=n?t:e,a=n?e:t;l.width={ideal:o},l.height={ideal:a},l.frameRate={ideal:r}}vt.log(`getUserMedia videoConstraints: ${JSON.stringify(l)}`),navigator.mediaDevices.getUserMedia({video:l}).then((e=>{a.stream=e,navigator.userAgent.match(/UCBrowser/i)?a.video.onloadeddata=()=>{a.video.onloadeddata=null,i({width:a.video.videoWidth,height:a.video.videoHeight})}:a.video.onloadedmetadata=()=>{const e=a.stream.getVideoTracks()[0].getSettings(),t=`video stream information: \n   deviceId: ${e.deviceId}\n   width: ${a.video.videoWidth}\n   height: ${a.video.videoHeight}\n   frameRate: ${e.frameRate}\n`;vt.log(t),a.video.onloadedmetadata=null,i({width:a.video.videoWidth,height:a.video.videoHeight})},a.video.srcObject=e;const t=a.video.play();"undefined"!==t&&t.then((()=>{vt.log("playing")}),(()=>{vt.log("browser does not support auto start, show play button")}))})).catch(u)}))}pause(){const e=this;e.video&&e.stream?e.video.pause():vt.log("WARN: video has not been loaded yet")}destroy(){if(this.video.pause(),this.video){const e=this.video.srcObject;if(e){e.getTracks().forEach((e=>{e.stop()})),this.video.srcObject=null}}}}function kt(){return/iPad/i.test(navigator.userAgent)}function bt(){return/Pixel 4/i.test(navigator.userAgent)}class xt{constructor(){this.onAnimation=null,this.requestId=0}requestAnimationFrame(){const e=this;this.requestId=requestAnimationFrame((()=>{e._onFrame()}))}cancel(){0!==this.requestId&&cancelAnimationFrame(this.requestId),this.requestId=0}_onFrame(){this.onFrame&&this.onFrame()}}class Lt{constructor(e){this.active=!1,this.listener=e}}CanvasRenderingContext2D.prototype.resetTransform||(CanvasRenderingContext2D.prototype.resetTransform=function(){this.setTransform(1,0,0,1,0,0)});class Et{constructor(e=!1,t=0){vt.log("Camera object constructed"),Et.totalInstances+=1,Et.totalInstances>1&&vt.error("Too many camera instances"),this.onFrame=null,this.isRunning=!1,this.lastFrameUpdateTime=0,this.frameListeners=[],this.animation=new xt,this.mediaSource=null,this.flipX=!0,this.flipY=e,this.facingMode="user",this.deviceId=null,this.rotate=t,this.canvas=null,this.context=null,this.iframeWidth=0,this.iframeHeight=0,this.prevVideoWidth=0,this.prevVideoHeight=0;const r=this;this.animation.onFrame=()=>{r._onFrame()},this.firstTime=!0,this.manuallyRetrieveFrames=!1}waitForEnumerateDevices(){const e=t=>{!0===Et.isEnumerateDevicesFinished?t():setTimeout((()=>e(t)),50)};return new Promise(e)}getVideoSource(){return this.mediaSource.getSource()}getSource(){return this.canvas}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}start(e,t,r=30,n="user",o="none",a=null){return new Promise((async(i,s)=>{if(this.isRunning)return void i(e,t);vt.log("starting camera"),await this.waitForEnumerateDevices(),Et.hasWebCam||s(),this.isRunning=!0,(!_t(r)||r>30)&&(r=30),vt.log(`Camera.defaultBackCameraDeviceId: ${Et.defaultBackCameraDeviceId}`),vt.log(`Camera.defaultFrontCameraDeviceId: ${Et.defaultFrontCameraDeviceId}`),this.facingMode=n,"environment"===this.facingMode&&(this.deviceId=Et.defaultBackCameraDeviceId,kt()&&(this.facingMode=null,r=null),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.flipX=!1)),"user"===this.facingMode&&null!==Et.defaultFrontCameraDeviceId&&bt()&&(this.deviceId=Et.defaultFrontCameraDeviceId);this.initMediaSourceIfNeeded(e,t,r,o,a).then((e=>i(e))).catch((()=>{this.isRunning=!1,s()}))}))}stop(){this.isRunning&&(vt.log("stopping camera"),this.animation.cancel(),this.mediaSource.pause(),this.isRunning=!1)}releaseStream(){this.mediaSource&&this.mediaSource.destroy()}destroy(){this.mediaSource=null,Et.totalInstances=0,this.releaseStream(),this.animation.cancel(),this.onFrame=null,this.frameListeners=[],this.animation.onFrame=null}addFrameListener(e){const t=new Lt(e);t.listener=e,t.active=!0,this.frameListeners.push(t);const r=this;return t.remove=()=>{for(let e=0;e<r.frameListeners.length;e+=1)if(r.frameListeners[e]===this){r.frameListeners.splice(e,1);break}},t}restartMediaSource(e,t,r,n,o){const a=this;return a.iframeWidth=e,a.iframeHeight=t,this.lastFrameUpdateTime=0,new Promise(((i,s)=>{this.mediaSource.getStream(e,t,r,n,o).then((()=>{a.resolveMediaSource(),i({width:e,height:t})})).catch(s)}))}hasStream(){return!!this.mediaSource&&this.mediaSource.hasStream()}initMediaSourceIfNeeded(e,t,r,n,o=null){return new Promise(((a,i)=>{if(null!==this.mediaSource)return void this.restartMediaSource(e,t,r,n,o).then((e=>a(e))).catch(i);this.mediaSource=new wt;const s=this;s.iframeWidth=e,s.iframeHeight=t;const u={width:e,height:t,mode:"live",resizeModeConstraint:n,frameRateConstraint:r,facingMode:s.facingMode,deviceId:s.deviceId,cameraInfo:o};this.mediaSource.create(u).then((()=>{s.resolveMediaSource(),a({width:e,height:t})})).catch(i)}))}resizeMainimContainer(){let e=this.mediaSource.getWidth(),t=this.mediaSource.getHeight();if(90!==this.rotate&&270!==this.rotate||(e=this.mediaSource.getHeight(),t=this.mediaSource.getWidth()),this.canvas.width===this.iframeWidth&&this.canvas.height===this.iframeHeight&&this.prevVideoWidth===e&&this.prevVideoHeight===t)return;this.prevVideoWidth=e,this.prevVideoHeight=t,this.canvas.width=this.iframeWidth,this.canvas.height=this.iframeHeight;const r=this.canvas.width/e,n=this.canvas.height/t;this.context.resetTransform(),this.canvas.width/this.canvas.height>e/t?(this.context.translate(0,-(r/n-1)*this.canvas.height/2),this.context.scale(1,r/n)):(this.context.translate(-(n/r-1)*this.canvas.width/2,0),this.context.scale(n/r,1));let o=1,a=1,i=0,s=0,u=this.rotate;this.flipX&&(o=-1,i=this.canvas.width,u=(-1*u+360)%360),this.flipY&&(a=-1,s=this.canvas.height,u=(-1*u+360)%360),(this.flipX||this.flipY)&&(this.context.translate(i,s),this.context.scale(o,a));if(![90,180,270].includes(u))return;let l=this.canvas.width/2,c=this.canvas.height/2;90===u?c=l:270===u&&(l=c),this.context.translate(l,c),this.context.rotate(u*Math.PI/180),this.context.translate(-1*l,-1*c)}resolveMediaSource(){this.canvas=function(e,t){const r=document.createElement("canvas");return r.width=e,r.height=t,r.style.background="rgb(255,255,255)",r}(100,100),this.context=this.canvas.getContext("2d"),this.resizeMainimContainer(),this.manuallyRetrieveFrames||this._onFrame()}getCurrentFrame(){return this.resizeMainimContainer(),this.updateCanvas(),this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height)}_onFrame(){if(this.resizeMainimContainer(),!this.isRunning||!this.updateCanvas())return void this.animation.requestAnimationFrame();const e=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height);this.frameListeners.forEach((t=>{t.active&&t.listener(e)})),this.onFrame&&this.onFrame(e),this.animation.requestAnimationFrame()}updateCanvas(){const e=this.mediaSource.getSource();return!(e.currentTime<=this.lastFrameUpdateTime)&&(90===this.rotate||270===this.rotate?this.context.drawImage(e,0,0,this.canvas.height,this.canvas.width):this.context.drawImage(e,0,0,this.canvas.width,this.canvas.height),this.lastFrameUpdateTime=e.currentTime,!0)}}Et.totalInstances=0,Et.hasCamCheckDone=!1,Et.cameraCheckListeners=[],Et.addCameraCheckListener=e=>{Et.hasCamCheckDone?e():Et.cameraCheckListeners.push(e)},function(){let e=!1;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=e=>{navigator.mediaDevices.enumerateDevices().then(e)});let t=[];const r="https:"===window.location.protocol;let n=!1;("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(n=!0);let o=!1,a=!1,i=!1,s=!1,u=!1,l=null,c=null;var h;h=()=>{"boolean"!=typeof i&&(i=!0),Et.hasWebCam=i,yt.ios(),Et.hasMicrophone=o,Et.hasSpeakers=a,Et.isWebCamInUse=u,Et.defaultBackCameraDeviceId=l,Et.defaultFrontCameraDeviceId=c,Et.hasCamCheckDone=!0,Et.canTakePhoto=yt.mobile()||yt.tablet()||i,n&&!i&&(Et.canTakePhoto=!1),Et.isEnumerateDevicesFinished=e,vt.log(`hasWebCam: ${i}`),vt.log(`hasMicrophone: ${o}`),vt.log(`isMicrophoneAlreadyCaptured: ${s}`),vt.log(`isWebcamAlreadyCaptured: ${u}`),vt.log(`defaultBackCameraDeviceId: ${l}`),vt.log(`defaultFrontCameraDeviceId: ${c}`);for(let e=0;e<Et.cameraCheckListeners.length;e+=1)Et.cameraCheckListeners[e]();Et.cameraCheckListeners=null},yt.safari(10)&&(n=!1),n?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(t=[],navigator.enumerateDevices((n=>{vt.log("all devices"),vt.log(JSON.stringify(n)),n.forEach((e=>{const n={};for(const t in e)n[t]=e[t];let h;"audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),t.forEach((e=>{e.id===n.id&&e.kind===n.kind&&(h=!0)})),h||(n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),kt()&&"videoinput"===n.kind&&null===l&&(l=n.id),n.label?("videoinput"!==n.kind||u||(u=!0),"audioinput"!==n.kind||s||(s=!0),kt()||-1===n.label.indexOf("back")||-1===n.label.indexOf("0")||(l=n.id),bt()&&"videoinput"===n.kind&&-1!==n.label.indexOf("camera2 1")&&-1!==n.label.indexOf("front")&&null===c&&(c=n.id)):(n.label="Please invoke getUserMedia once.",r||(n.label=`HTTPs is required to get label of this ${n.kind} device.`)),"audioinput"===n.kind&&(o=!0),"audiooutput"===n.kind&&(a=!0),"videoinput"===n.kind&&(i=!0),t.push(n))})),e=!0,h&&h()}))):(e=!0,h&&h())):(e=!0,h()&&h())}();var Ct=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;a(this,e),this.width=null,this.height=null,this.flipY=t,this.rotate=o,this.cameraInfo=i,this.setResizeMode(n),this.camera=null!==r?r:new Et(this.flipY,this.rotate),this.camera.manuallyRetrieveFrames=!0}return s(e,[{key:"hasStream",value:function(){return this.camera.hasStream()}},{key:"start",value:function(e,t){return this.width=e,this.height=t,this.play()}},{key:"setResizeMode",value:function(e){this.resizeModeConstraint=e}},{key:"isRunning",value:function(){return this.camera.isRunning}},{key:"getVideoSource",value:function(){return this.camera.getVideoSource()}},{key:"getCurrentFrame",value:function(){return this.camera.getCurrentFrame()}},{key:"addFrameListener",value:function(e){this.camera.addFrameListener(e)}},{key:"requestStream",value:function(){return this.play()}},{key:"pause",value:function(){this.camera.stop()}},{key:"play",value:function(){return this.camera.start(this.width,this.height,void 0,void 0,this.resizeModeConstraint,this.cameraInfo)}},{key:"releaseStream",value:function(){this.camera.releaseStream()}},{key:"destroy",value:function(){this.camera.destroy()}},{key:"getSource",value:function(){return this}},{key:"getWidth",value:function(){return this.camera.getWidth()}},{key:"getHeight",value:function(){return this.camera.getHeight()}}]),e}(),Dt=function(){function e(){a(this,e),this.onCreationComplete=null,this.onResetComplete=null,this.width=0,this.height=0,this.maxFaces=1,this.mainTracker=null,this.trackerLoaded=!1,this.trackerWaiting=!1,this.allowDownscaling=!0,this.enableLightingCheck=!0,this.lightingCheckThreshold=.3,this.detectFaceMasks=!1,this.performanceData={reset:function(){this.trackTime=new pt},getAverages:function(){return{avgTrackTime:this.trackTime.getAverageTime()}}},this.performanceData.reset(),this.reset()}var t;return s(e,[{key:"setAllowDownscaling",value:function(e){this.allowDownscaling=!!e}},{key:"getDetectionResult",value:function(){return this.detectionResult}},{key:"setEnableLightingCheck",value:function(e){this.enableLightingCheck=e,this.mainTracker&&(this.mainTracker.enableLightingCheck=e)}},{key:"getEnableLightingCheck",value:function(){return this.enableLightingCheck}},{key:"setLightingCheckThreshold",value:function(e){this.lightingCheckThreshold=e,this.mainTracker&&(this.mainTracker.lightingCheckThreshold=e)}},{key:"getLightingCheckThreshold",value:function(){return this.lightingCheckThreshold}},{key:"reset",value:function(){return this.stopTracker=!1,this.performanceData.reset(),this.trackerLoaded&&this.mainTracker.reset(),Promise.resolve()}},{key:"create",value:function(){var t=this;return e.loadFaceTrackerLibrary().then((function(){return t.mainTracker=new MFEFaceTracker.FaceTracker,t.mainTracker.maxFaces=t.maxFaces,t.mainTracker.licenceKey=trackerLicenceKey,t.mainTracker.enableLightingCheck=t.enableLightingCheck,t.mainTracker.lightingCheckThreshold=t.lightingCheckThreshold,t.mainTracker.lightingCheckingInterval=25,t.mainTracker.detectFaceMasks=t.detectFaceMasks,t.mainTracker.instantiateWasmOverride=function(t,r){return WebAssembly.instantiate(e.faceTrackerData.faceTrackerEMWasmModule,t).then((function(e){r(e)})),{}},t.mainTracker.load(e.faceTrackerData,!0)})).then((function(){t.trackerLoaded=!0}))}},{key:"destroy",value:function(){this.mainTracker&&(this.mainTracker.destroy(),this.mainTracker=null,this.trackerLoaded=!1)}},{key:"stop",value:function(){this.stopTracker=!0}},{key:"warmup",value:function(){return this.mainTracker?this.mainTracker.warmup():Promise.reject(new Error("tracker warmup called, but tracker does not exist"))}},{key:"setMaxFaces",value:function(e){this.maxFaces=e,this.mainTracker&&(this.mainTracker.maxFaces=e)}},{key:"getMaxFaces",value:function(){return this.maxFaces}},{key:"setDetectFaceMasks",value:function(e){this.detectFaceMasks=e,this.mainTracker&&(this.mainTracker.detectFaceMasks=this.detectFaceMasks)}},{key:"track",value:(t=o(v.mark((function e(t){var r,n,o,a,i;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.stopTracker&&!this.trackerWaiting&&this.trackerLoaded){e.next=2;break}return e.abrupt("return",null);case 2:return this.width=t.width,this.height=t.height,this.trackerWaiting=!0,r=new Uint8Array(t.data),n=new MFEFaceTracker.PixelData(r,t.width,t.height),this.performanceData.trackTime.begin(),e.next=10,this.mainTracker.detectMulti(n);case 10:return o=e.sent,this.performanceData.trackTime.end(),a=o.faces.length>0,this.trackerWaiting=!1,this.detectionResult=o,i=a?this.detectionResult:null,a&&(this.detectionResult.faces.forEach((function(e){e.isBadLighting=!!e.isBadLighting})),this.detectionResult.isBadLighting=this.detectionResult.faces.some((function(e){return e.isBadLighting}))),e.abrupt("return",{detectionResult:i,imageData:t});case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"loadFaceTrackerLibrary",value:function(){if("undefined"==typeof MFEFaceTracker){var t,r,n=MF_MODULE_LOADER,o=n.dataPromises,a=n.wasmModulePromises,i=o.faceTrackerSourceMain,s=o.faceBoxModelJSON,u=o.faceBoxModelData,l=o.facePointModelJSON,c=o.facePointModelData,h=a.faceTrackerEMWasmModule,f=null!==(t=o.faceMaskModelJSON)&&void 0!==t?t:Promise.resolve(),d=null!==(r=o.faceMaskModelData)&&void 0!==r?r:Promise.resolve();return Promise.all([i,s,u,l,c,f,d,h]).then((function(t){var r=Ye(t,8),n=r[0],o=r[1],a=r[2],i=r[3],s=r[4],u=r[5],l=r[6],c=r[7];eval.call(window,n),e.faceTrackerData={faceBoxModelJSON:o,faceBoxWeightArray:a,facePointModelJSON:i,facePointWeightArray:s,tfWASMBackendPath:MF_MODULE_LOADER.trackerResourcesFolderUrl,faceTrackerEMWasmModule:c},u&&(e.faceTrackerData.faceMaskModelJSON=u),l&&(e.faceTrackerData.faceMaskWeightArray=l)}))}return Promise.resolve()}}]),e}(),Mt=function(){function e(t){a(this,e),this.source=null,this.tracker=t||new Dt,this.trackingCompleteResolves=[],this.trackingCompleteRejects=[],this.sendInitialTrackingMessageRequested=!1,this.width=null,this.height=null,this.sourceWidth=0,this.sourceHeight=0,this.spareCanvas=null}return s(e,[{key:"create",value:function(){return this.loadTracker()}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setExtractorWidth",value:function(e){this.width=e}},{key:"setExtractorHeight",value:function(e){this.height=e}},{key:"setMaxFaces",value:function(e){this.tracker.setMaxFaces(e)}},{key:"getMaxFaces",value:function(){return this.tracker.getMaxFaces()}},{key:"setDetectFaceMasks",value:function(e){this.tracker.setDetectFaceMasks(e)}},{key:"loadTracker",value:function(){var e=this;return this.tracker.create().then((function(){e.sendInitialTrackingMessageRequested&&(e.sendInitialTrackingMessageRequested=!1,e.sendInitialTrackingMessage())}))}},{key:"getDetectionResult",value:function(){return this.tracker.getDetectionResult()}},{key:"getSingleDetectionResult",value:function(){var e=this.tracker.getDetectionResult();return e?e.faces[0]:null}},{key:"track",value:function(){return this.tracker.detectionResult}},{key:"sendInitialTrackingMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.tracker.trackerLoaded){this.updateCanvasFromSource(this.spareCanvas);var r=F(this.spareCanvas);this.tracker.reset(),this.tracker.track(r).then((function(r){e.handleTrackerResponse(r,t)}))}else this.sendInitialTrackingMessageRequested=!0}},{key:"updateCanvasFromSource",value:function(e){this.source||O("source needs to be set first"),e.getContext("2d").drawImage(this.source,0,0,e.width,e.height)}},{key:"destroy",value:function(){this.renderer=null,this.source=null,this.tracker.destroy(),this.tracker=null,this.sendInitialTrackingMessageRequested=!1}},{key:"handleTrackerResponse",value:function(){O("implement please")}},{key:"callRejects",value:function(e){for(var t=0;t<this.trackingCompleteRejects.length;t+=1)"function"==typeof this.trackingCompleteRejects[t]&&this.trackingCompleteRejects[t](e);this.trackingCompleteRejects=[],this.trackingCompleteResolves=[]}},{key:"callResolves",value:function(e){for(var t=0;t<this.trackingCompleteResolves.length;t+=1)"function"==typeof this.trackingCompleteResolves[t]&&this.trackingCompleteResolves[t](e);this.trackingCompleteRejects=[],this.trackingCompleteResolves=[]}}]),e}();function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var o=u(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}var Pt=function(e){f(r,e);var t=St(r);function r(e){var n,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return a(this,r),(n=t.call(this,e)).flipX=o,n.canvasInitialized=!1,n.imageData=null,n}return s(r,[{key:"updateCanvasFromSource",value:function(e){this.source||O("source needs to be set first");var t=e.getContext("2d");A(1),t.putImageData(this.imageData,0,0)}},{key:"updateWithCurrentFrame",value:function(){this.imageData=this.source.getCurrentFrame(),A(1),this.updateCanvasFromSource(this.spareCanvas)}},{key:"getOutputAsync",value:function(){var e=this;this.updateWithCurrentFrame();var t=this.imageData;return this.tracker.track(t).then((function(r){return new je(r.detectionResult,t,e.spareCanvas)}))}},{key:"awaitTrackingComplete",value:function(){var e=this;return new Promise((function(t,r){e.trackingCompleteResolves.push(t),e.trackingCompleteRejects.push(r)}))}},{key:"setSource",value:function(e){return e instanceof Ct||O("source must be a VideoSource class"),e===this.source||(this.source=e,this.canvasInitialized||(this.spareCanvas=I(1,1),this.canvasInitialized=!0),this.onResize()),Promise.resolve()}},{key:"getPerformanceData",value:function(){return this.tracker.performanceData.getAverages()}},{key:"onResize",value:function(){if(this.source&&(this.sourceWidth!==this.source.getWidth()||this.sourceHeight!==this.source.getHeight())&&(this.sourceWidth=this.source.getWidth(),this.sourceHeight=this.source.getHeight(),"number"!=typeof this.width&&(this.width=this.sourceWidth),"number"!=typeof this.height&&(this.height=this.sourceHeight),this.spareCanvas.width=this.width,this.spareCanvas.height=this.height,this.flipX)){var e=this.spareCanvas.getContext("2d");e.translate(this.width,0),e.scale(-1,1)}}}]),r}(Mt);function At(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var o=u(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}var Ot=function(e){f(n,e);var t,r=Ft(n);function n(){var e;return a(this,n),(e=r.call(this)).videoSource=null,e.videoDataExtractor=null,e.liveProcessId=-1,e.renderLoopActive=!1,e.boundOnOrientationChange=null,e.lightingThreshold=.3,e.flipY=!1,e.rotate=0,e.resizeMode="none",e}return s(n,[{key:"onOrientationChange",value:function(){var e=this;this.eventQueue.orientationChange||(this.eventQueue.orientationChange=Promise.resolve()),this.eventQueue.orientationChange=this.eventQueue.orientationChange.then((function(){return new Promise((function(t){e.fireEventListener("orientationChangeStart");var r=e.isPaused();r||e.pause(),e.videoSource.releaseStream(),setTimeout((function(){e.videoSource=new Ct(e.flipY,e.videoSource.camera,e.resizeMode,e.rotate),e.videoDataExtractor=new Pt(e.videoDataExtractor.tracker),e.videoDataExtractor.setMaxFaces(e.maxFaces),e.videoDataExtractor.setDetectFaceMasks(e.detectFaceMasks),r?(e.releaseStream(),e.fireEventListener("orientationChangeEnd"),t()):e.play().then((function(){e.fireEventListener("orientationChangeEnd"),t()}))}),10)}))}))}},{key:"destroy",value:function(){this.releaseStream(),this.videoSource.destroy(),c(u(n.prototype),"destroy",this).call(this),this.videoDataExtractor.destroy(),this.videoSource=null,this.videoDataExtractor=null,this.renderLoopActive=!1,window.removeEventListener("orientationchange",this.boundOnOrientationChange)}},{key:"create",value:function(e){var t=this,r=e.width,o=void 0===r?640:r,a=e.height,i=void 0===a?480:a,s=e.lightingThreshold,l=void 0===s?.3:s,h=e.flipY,f=void 0!==h&&h,d=e.resourceResolver,p=void 0===d?null:d,m=e.camera,g=void 0===m?null:m,y=e.rotate,v=void 0===y?0:y,_=e.cameraInfo,w=void 0===_?null:_,k=[c(u(n.prototype),"create",this).call(this,{resourceResolver:p})];this.mode="live",this.targetWidth=o,this.targetHeight=i,this.flipY=f,this.rotate=v,this.videoSource=new Ct(this.flipY,g,this.resizeMode,this.rotate,w),this.lightingThreshold=l;var b=this;return this.boundOnOrientationChange=function(e){b.onOrientationChange(e)},window.addEventListener("orientationchange",this.boundOnOrientationChange),this.videoDataExtractor=new Pt,this.videoDataExtractor.setMaxFaces(this.maxFaces),this.videoDataExtractor.setDetectFaceMasks(this.detectFaceMasks),k.push(this.videoDataExtractor.create().then((function(){return t.videoDataExtractor.tracker.warmup(),Promise.resolve()}))),Promise.all(k)}},{key:"isPaused",value:function(){return!this.videoSource.isRunning()}},{key:"play",value:function(){var e=this;return(this.videoSource.hasStream()?Promise.resolve():this.requestStream()).then((function(){return e.videoSource.play()})).then((function(){var t;null!==(t=e.tutorialRenderer)&&void 0!==t&&t.getHasTutorial()&&e.tutorialRenderer.resumeTutorial()})).then((function(){return e.processVideo()}))}},{key:"pause",value:function(){var e;this.videoSource.hasStream()&&(null!==(e=this.tutorialRenderer)&&void 0!==e&&e.getHasTutorial()&&this.tutorialRenderer.pauseTutorial(),this.videoSource.pause());this.stopProcessingVideo()}},{key:"requestStream",value:function(){var e=this;return this.videoSource.start(this.targetWidth,this.targetHeight).then((function(t){var r;e.trueWidth=t.width,e.trueHeight=t.height,e.makeupRenderer.resize(e.trueWidth,e.trueHeight),null===(r=e.tutorialRenderer)||void 0===r||r.resize(e.trueWidth,e.trueHeight)}))}},{key:"releaseStream",value:function(){this.pause(),this.videoSource.hasStream()&&this.videoSource.releaseStream()}},{key:"getDetectionResult",value:function(){return this.videoDataExtractor.getSingleDetectionResult()}},{key:"setResizeMode",value:function(e){this.resizeMode=e}},{key:"getMediaSource",value:function(){return this.videoSource}},{key:"setMaxFaces",value:function(e){c(u(n.prototype),"setMaxFaces",this).call(this,e),this.videoDataExtractor&&this.videoDataExtractor.setMaxFaces(e)}},{key:"renderLoopAsync",value:(t=o(v.mark((function e(){var t,r,n,o,a,i,s=this;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.videoSource||O("Requires a VideoSource"),e.next=3,this.videoDataExtractor.getOutputAsync();case 3:if(t=e.sent,this.renderLoopActive){e.next=6;break}return e.abrupt("return");case 6:if(!t){e.next=18;break}return this.videoDataExtractor.tracker.setLightingCheckThreshold(this.lightingThreshold),this.mediaData=t,e.next=11,this.render(this.mediaData);case 11:if(this.renderLoopActive){e.next=13;break}return e.abrupt("return");case 13:this.mediaData=null,!!(n=(null===(r=t.detectionResult)||void 0===r||null===(r=r.faces)||void 0===r?void 0:r.length)>0)&&!!t.detectionResult.faces[0].isBadLighting&&(this.eventQueue.badLighting||(this.eventQueue.badLighting=Promise.resolve()),this.eventQueue.badLighting=this.eventQueue.badLighting.then((function(){s.fireEventListener("badLighting")}))),this.detectFaceMasks&&n&&(o=!!t.detectionResult.faces[0].hasFaceMask,this.eventQueue.hasFaceMask||(this.eventQueue.hasFaceMask=Promise.resolve()),this.eventQueue.hasFaceMask=this.eventQueue.hasFaceMask.then((function(){s.fireEventListener("hasFaceMask",o)})));case 18:a=Tt(Tt({},this.videoDataExtractor.getPerformanceData()),this.performanceData.getAverages()),this.fireEventListener("performanceUpdate",a),i=this.renderLoopAsync.bind(this),this.liveProcessId=setTimeout(i,1);case 22:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"processVideo",value:function(){var e=this;return this.renderLoopActive?Promise.reject(new Error("A processVideo loop is already active")):this.videoDataExtractor.setSource(this.getSource()).then((function(){var t,r=e.videoDataExtractor.getWidth(),n=e.videoDataExtractor.getHeight();return e.makeupRenderer.resize(r,n),null===(t=e.tutorialRenderer)||void 0===t||t.resize(r,n),e.renderLoopActive=!0,e.renderLoopAsync()}))}},{key:"stopProcessingVideo",value:function(){window.clearTimeout(this.liveProcessId),this.liveProcessId=-1,this.renderLoopActive=!1}},{key:"getVideoSource",value:function(){return this.videoSource.getVideoSource()}},{key:"pauseTutorial",value:function(){this.videoSource.hasStream()&&c(u(n.prototype),"pauseTutorial",this).call(this)}},{key:"resumeTutorial",value:function(){this.videoSource.hasStream()&&c(u(n.prototype),"resumeTutorial",this).call(this)}},{key:"stopTutorial",value:function(){c(u(n.prototype),"stopTutorial",this).call(this),this.stopProcessingVideo()}}]),n}(mt),It=function(){function e(t,r){a(this,e),this.module=null,this.image=new Image,this.canvas=I(t,r),this.context=this.canvas.getContext("2d")}return s(e,[{key:"getSource",value:function(){return this.canvas}},{key:"getWidth",value:function(){return this.canvas.width}},{key:"getHeight",value:function(){return this.canvas.height}},{key:"checkMemorySize",value:function(e,t){return"undefined"==typeof Module||!Module||void 0===Module.TOTAL_MEMORY||e*t*4*8<=Module.TOTAL_MEMORY}},{key:"setImage",value:function(e,t){var r=this;return new Promise((function(n){var o=new Image;"data"!==e.split(":")[0]&&(o.crossOrigin="anonymous"),o.onload=function(){var e=o.naturalWidth,a=o.naturalHeight;t||r.checkMemorySize(e,a)?(r.image=o,r.canvas.width=e,r.canvas.height=a,r.updateCanvHelper(r.canvas,r.context),n({width:e,height:a})):O("memory_size")},o.onerror=function(){O("Error loading source:".concat(e))},o.src=e}))}},{key:"updateCanvHelper",value:function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var r=e.width/this.image.width,n=e.height/this.image.height,o=Math.max(r,n),a=this.image.width*o,i=this.image.height*o,s=e.width/2-a/2,u=e.height/2-i/2;t.drawImage(this.image,s,u,a,i)}},{key:"destroy",value:function(){this.module=null,this.image=null,this.canvas=null,this.context=null}}]),e}();function Rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var o=u(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}var Bt=function(e){f(r,e);var t=jt(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).presetDetectionResult=null,n.currentOutput=null,n.waitingForTracker=!1,n.tracker.setAllowDownscaling(!1),n.isPresetDetectionResultComplete=!1,n}return s(r,[{key:"awaitOutput",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.currentOutput)return Promise.resolve(this.currentOutput);var n=new Promise((function(t,r){e.trackingCompleteResolves.push(t),e.trackingCompleteRejects.push(r)}));if(!this.waitingForTracker)if(this.isPresetDetectionResultComplete){var o=r.convertToMultiFaceDetectionResult(this.presetDetectionResult);this.handleTrackerResponse({detectionResult:o,imageData:F(this.spareCanvas)},t)}else this.waitingForTracker=!0,this.sendInitialTrackingMessage(t);return n.then((function(){return e.currentOutput}))}},{key:"setSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e instanceof HTMLCanvasElement||O("source must be an HTMLCanvasElement"),this.source=e,this.onResize(),this.updateCanvasFromSource(this.spareCanvas),this.imageData=F(this.source),this.currentOutput=null,t?Promise.resolve():this.tracker.reset()}},{key:"setPresetDetectionResult",value:function(e,t){this.presetDetectionResult=r.processPresetDetectionResult(e,t),this.isPresetDetectionResultComplete=t}},{key:"handleTrackerResponse",value:function(e){var t,r=this;e||O("Cannot handle an empty facetracker response.");var n=e.detectionResult,o=e.imageData;if((null==n||null===(t=n.faces)||void 0===t?void 0:t.length)>0&&this.presetDetectionResult){var a=n.faces[0];["allPoints","facebox","origFacebox","targetOrigFacebox"].forEach((function(e){r.presetDetectionResult[e]&&(a[e]=r.presetDetectionResult[e])})),this.presetDetectionResult.facePoints&&Object.assign(a.facePoints,this.presetDetectionResult.facePoints)}this.currentOutput=new je(n,o,this.spareCanvas),this.waitingForTracker=!1,this.callResolves(this.currentOutput)}},{key:"onResize",value:function(){this.source&&(this.width=this.source.width,this.height=this.source.height,this.spareCanvas=I(this.width,this.height))}}],[{key:"convertToMultiFaceDetectionResult",value:function(e){return{faces:[e],timings:e.timings,isBadLighting:e.isBadLighting}}},{key:"processPresetDetectionResult",value:function(e,t){if(!t)return e;var r,n=e.facePoints,o={rightEyeInnerCorner3D:{x:32.6,y:27.1,z:196.5},leftEyeInnerCorner3D:{x:-32.6,y:27.1,z:196.5},rightEyeOuterCorner3D:{x:105.64,y:26.87,z:185.49},leftEyeOuterCorner3D:{x:-105.638,y:26.87,z:185.49},rightNose3D:{x:32.56,y:-20.73,z:206.17},leftNose3D:{x:-32.56,y:-20.73,z:206.17},modelViewProjectionMatrix:function(e,t){var r=e,n=t,o=function(e,t){return r[4*e]*n[t]+r[4*e+1]*n[t+4]+r[4*e+2]*n[t+8]+r[4*e+3]*n[t+12]};return[o(0,0),o(0,1),o(0,2),o(0,3),o(1,0),o(1,1),o(1,2),o(1,3),o(2,0),o(2,1),o(2,2),o(2,3)]}(n.projectionViewMatrix,n.modelMatrix),faceTranslation:{x:0,y:0,z:0}};if(Object.keys(o).some((function(e){return!n[e]}))){r="Warning: the passed in points were generated with an older version of the face tracker. For best results please re-run the face tracker on the image.",console.warn(r);var a=Nt({},n);Object.keys(o).forEach((function(e){a[e]||(a[e]=o[e])}));var i=Nt({},e);return i.facePoints=a,i}return e}}]),r}(Mt);function zt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var o=u(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}var Wt=function(e){f(d,e);var t,r,n,i,l,h=zt(d);function d(){var e;return a(this,d),(e=h.call(this)).imageSource=null,e.canvasDataExtractor=null,e.tutorialAnimationRequest=null,e.tutorialLoopPromise=null,e}return s(d,[{key:"destroy",value:function(){c(u(d.prototype),"destroy",this).call(this),this.imageSource.destroy(),this.canvasDataExtractor.destroy(),this.imageSource=null,this.canvasDataExtractor=null,this.stopTutorialRenderLoop()}},{key:"create",value:function(e){var t=e.resourceResolver,r=void 0===t?null:t,n=[c(u(d.prototype),"create",this).call(this,{resourceResolver:r})];return this.mode="photo",this.imageSource=new It,this.canvasDataExtractor=new Bt,this.canvasDataExtractor.setMaxFaces(this.maxFaces),this.canvasDataExtractor.setDetectFaceMasks(this.detectFaceMasks),n.push(this.canvasDataExtractor.create()),Promise.all(n)}},{key:"setImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this;o.unsetMouthOpen(),this.makeupRenderer.resetTrackerData();var a=o.imageSource.image.src;return new Promise((function(i,s){o.canvasDataExtractor.setPresetDetectionResult({},!1),o.imageSource.setImage(e).then((function(){return void 0!==t&&o.canvasDataExtractor.setPresetDetectionResult(t,r),o.processImage({requireFace:n}).then((function(){var e=r?t:o.getDetectionResult();i(e)}))})).catch((function(e){console.error("setImage: ".concat(e)),a&&o.hasValidFace&&o.setImage(a).then((function(){return s(e)})),s(e)}))}))}},{key:"setImageNativeLive",value:function(e){var t=this;return t.unsetMouthOpen(),t.imageSource.setImage(e).then((function(){return t.processImage({isNativeLive:!0}).catch((function(e){return Promise.reject(e)}))}))}},{key:"setDetectionResult",value:function(e){return this.canvasDataExtractor.setPresetDetectionResult(e),this.processImage()}},{key:"getDetectionResult",value:function(){return this.canvasDataExtractor.getSingleDetectionResult()}},{key:"getMediaSource",value:function(){return this.imageSource}},{key:"setMaxFaces",value:function(e){c(u(d.prototype),"setMaxFaces",this).call(this,e),this.canvasDataExtractor&&this.canvasDataExtractor.setMaxFaces(e)}},{key:"processImage",value:(l=o(v.mark((function e(){var t,r,n,o,a,i,s=this,u=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>0&&void 0!==u[0]?u[0]:{isNativeLive:!1,requireFace:!0},e.next=3,this.canvasDataExtractor.setSource(this.getSource(),n.isNativeLive);case 3:return this.makeupRenderer.resize(this.canvasDataExtractor.getWidth(),this.canvasDataExtractor.getHeight()),null===(t=this.tutorialRenderer)||void 0===t||t.resize(this.canvasDataExtractor.getWidth(),this.canvasDataExtractor.getHeight()),e.next=7,this.canvasDataExtractor.awaitOutput(n.isNativeLive);case 7:if(o=e.sent,this.hasValidFace=null!==o.detectionResult,!n.requireFace||this.hasValidFace){e.next=11;break}return e.abrupt("return",Promise.reject(new Error("Unable to detect face in photo")));case 11:return this.mediaData=o,this.makeupRenderer.setMediaData(o),null===(r=this.tutorialRenderer)||void 0===r||r.setMediaData(o),e.next=16,this.render(this.mediaData);case 16:return a=this.getDetectionResult(),this.detectFaceMasks&&null!=a&&(i=a.hasFaceMask,this.eventQueue.hasFaceMask||(this.eventQueue.hasFaceMask=Promise.resolve()),this.eventQueue.hasFaceMask=this.eventQueue.hasFaceMask.then((function(){s.fireEventListener("hasFaceMask",i)}))),e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"createLook",value:(i=o(v.mark((function e(t,r,n,o){var a,i=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(i.length>4&&void 0!==i[4])||i[4],e.next=3,this.stopTutorialRenderLoop();case 3:return e.abrupt("return",c(u(d.prototype),"createLook",this).call(this,t,r,n,o,a));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"createTutorial",value:(n=o(v.mark((function e(t,r){var n,o,a=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:null,o=a.length>3&&void 0!==a[3]&&a[3],e.next=4,this.stopTutorialRenderLoop();case 4:return e.abrupt("return",c(u(d.prototype),"createTutorial",this).call(this,t,r,n,o));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"canvasDidChangeLook",value:function(){this.updateRenderLoop()}},{key:"updateRenderLoop",value:function(){var e=this;Object.values(this.canvasIdToLookId).some((function(t){return"tutorial"===e.lookIdType[t]}))?this.startTutorialRenderLoop():this.stopTutorialRenderLoop()}},{key:"startTutorialRenderLoop",value:function(){this.tutorialAnimationRequest||this.tutorialRenderLoop(this.mediaData)}},{key:"stopTutorialRenderLoop",value:(r=o(v.mark((function e(){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tutorialAnimationRequest&&(cancelAnimationFrame(this.tutorialAnimationRequest),this.tutorialAnimationRequest=null),e.next=3,this.tutorialLoopPromise;case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"tutorialRenderLoop",value:(t=o(v.mark((function e(t){return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tutorialLoopPromise=this.render(t),e.next=3,this.tutorialLoopPromise;case 3:this.tutorialAnimationRequest=requestAnimationFrame(this.tutorialRenderLoop.bind(this,t));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),d}(mt);function Ht(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var o=u(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}!function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,r,n;try{t=Map}catch(e){t=function(){}}try{r=Set}catch(e){r=function(){}}try{n=Promise}catch(e){n=function(){}}function o(a,s,u,l,c){"object"==typeof s&&(u=s.depth,l=s.prototype,c=s.includeNonEnumerable,s=s.circular);var h=[],f=[],d="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===u&&(u=1/0),function a(u,p){if(null===u)return null;if(0===p)return u;var m,g;if("object"!=typeof u)return u;if(e(u,t))m=new t;else if(e(u,r))m=new r;else if(e(u,n))m=new n((function(e,t){u.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(o.__isArray(u))m=[];else if(o.__isRegExp(u))m=new RegExp(u.source,i(u)),u.lastIndex&&(m.lastIndex=u.lastIndex);else if(o.__isDate(u))m=new Date(u.getTime());else{if(d&&Buffer.isBuffer(u))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(m),m;e(u,Error)?m=Object.create(u):void 0===l?(g=Object.getPrototypeOf(u),m=Object.create(g)):(m=Object.create(l),g=l)}if(s){var y=h.indexOf(u);if(-1!=y)return f[y];h.push(u),f.push(m)}for(var v in e(u,t)&&u.forEach((function(e,t){var r=a(t,p-1),n=a(e,p-1);m.set(r,n)})),e(u,r)&&u.forEach((function(e){var t=a(e,p-1);m.add(t)})),u){var _;g&&(_=Object.getOwnPropertyDescriptor(g,v)),_&&null==_.set||(m[v]=a(u[v],p-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(u);for(v=0;v<w.length;v++){var k=w[v];(!(x=Object.getOwnPropertyDescriptor(u,k))||x.enumerable||c)&&(m[k]=a(u[k],p-1),x.enumerable||Object.defineProperty(m,k,{enumerable:!1}))}}if(c){var b=Object.getOwnPropertyNames(u);for(v=0;v<b.length;v++){var x,L=b[v];(x=Object.getOwnPropertyDescriptor(u,L))&&x.enumerable||(m[L]=a(u[L],p-1),Object.defineProperty(m,L,{enumerable:!1}))}}return m}(a,u)}function a(e){return Object.prototype.toString.call(e)}function i(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return o.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},o.__objToStr=a,o.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},o.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},o.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},o.__getRegExpFlags=i,o}();e.exports&&(e.exports=t)}({exports:{}});var Vt=function(){function e(t){a(this,e),this.propName=t.propName,this.defaultValue=t.default,this.strictMode=!!t.strictMode}return s(e,[{key:"getValidated",value:function(e){var t=this.getValidatedHelper(e);return null!=t?t:(this.strictMode&&O("Invalid value of ".concat(e)),this.defaultValue)}},{key:"getValidatedHelper",value:function(){O("Override please")}}]),e}(),Ut=function(e){f(r,e);var t=Ht(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).allowed=new Set(e.allowed),n}return s(r,[{key:"getValidatedHelper",value:function(e){return this.allowed.has(e)?e:null}}]),r}(Vt),Gt=function(e){f(r,e);var t=Ht(r);function r(e){var n;return a(this,r),n=t.call(this,e),e.min>e.max&&O("min should be <= max"),n.min=e.min,n.max=e.max,n}return s(r,[{key:"getValidatedHelper",value:function(e){return"number"!=typeof(t=Number(e))||Number.isNaN(t)?null:Math.max(this.min,Math.min(e,this.max));var t}}]),r}(Vt),qt=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(a(this,e),!t)throw new Error("baseResourceLocation must be specified");this.tutorialAssetsPath=r,this.baseResourceLocation=t,this.embeddedAssets={"white.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQI12P4DwABAQEAG7buVgAAAABJRU5ErkJggg=="}}return s(e,[{key:"resolveImageLocation",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.isAbsoluteURL(t)||!r)return t;if(t in this.embeddedAssets)return this.embeddedAssets[t];var o=null;return o=n?this.tutorialAssetsPath:this.baseResourceLocation,e.concatPaths(o,t)}},{key:"resolveJsonLocation",value:function(t,r){return e.isAbsoluteURL(t)||!r?t:e.concatPaths(this.baseResourceLocation,t)}}],[{key:"isAbsoluteURL",value:function(e){return e.startsWith("http://")||e.startsWith("https://")}},{key:"concatPaths",value:function(e,t){return e.endsWith("/")||t.startsWith("/")?e+t:"".concat(e,"/").concat(t)}}]),e}();window.VideoMakeupModule=Ot,window.PhotoMakeupModule=Wt,window.SetValidator=Ut,window.RangeValidator=Gt,window.MakeupResourceResolver=qt}();